/*! cryptii v4.0.8+master.fbb86f6 - (c) Fränz Friederes 2026 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("crypto")):"function"==typeof define&&define.amd?define("cryptii",["exports","crypto"],t):t((e=e||self).cryptii={},e.crypto)}(this,function(e,t){t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;const i={role:"role",ariaHidden:"aria-hidden",ariaLabel:"aria-label"};class s{static createElement(e,t={},s=null){const n=document.createElement(e);if(Object.keys(t).forEach(e=>{const s=t[e];if(void 0===i[e]){const t=0===e.indexOf("on")?e.toLowerCase():e;n[t]=s}else n.setAttribute(i[e],s)}),null!==s)switch(Object.prototype.toString.call(s)){case"[object String]":n.innerText=s;break;case"[object Array]":s.forEach(e=>e&&n.appendChild(e));break;default:n.appendChild(s)}return n}constructor(){this._$root=null,this._superview=null,this._subviews=[],this._model=null,this._focus=!1,this._needsUpdate=!1}getElement(){return null===this._$root&&(this.willRender(),this._$root=this.render(),this.didRender()),this._$root}refresh(){const e=this._$root;return null===e||(this._$root=null,this.willRender(),this._$root=this.render(),this.didRender(),this.getSubviews().forEach(this.appendSubviewElement),e&&e.parentNode&&e.parentNode.replaceChild(this._$root,e)),this}render(){return s.createElement("div")}setNeedsUpdate(){return this._needsUpdate||(this._needsUpdate=!0,window.requestAnimationFrame(()=>{this._needsUpdate=!1,this.update()})),this}update(){}willRender(){}didRender(){this.update()}layout(){return this._subviews.forEach(e=>e.layout()),this}addSubview(e){e.removeFromSuperview(),this.appendSubviewElement(e),e.setSuperview(this),this._subviews.push(e)}getSubviews(){return this._subviews}appendSubviewElement(e){return e.getElement().parentNode!==this.getElement()&&this.getElement().appendChild(e.getElement()),this}removeSubview(e){const t=this._subviews.indexOf(e);-1!==t&&(this._subviews.splice(t,1),e.setSuperview(null),this.removeSubviewElement(e))}removeSubviewElement(e){const t=e.getElement();return null!==t.parentNode&&t.parentNode.removeChild(e.getElement()),this}removeFromSuperview(){return null!==this._superview&&this._superview.removeSubview(this),this}getSuperview(){return this._superview}setSuperview(e){return this._superview=e,this}focus(){return this.setFocus(!0)}blur(){return this.setFocus(!1)}setFocus(e){return e!==this._focus&&(this._focus=e,e?(null!==this._superview&&this._superview.subviewDidFocus(this),this.didFocus()):(this._subviews.forEach(e=>e.blur()),this.didBlur())),this}hasFocus(){return this._focus}subviewDidFocus(e){this.hasFocus()?this._subviews.filter(t=>t!==e).forEach(e=>e.blur()):this.focus()}didFocus(){}didBlur(){}getModel(){return this._model}hasModel(){return null!==this._model}setModel(e){return this._model=e,this}}class n extends s{render(){const e=document.querySelector(".app");return window.addEventListener("resize",this.windowDidResize.bind(this),!1),e}windowDidResize(e){this.layout()}}class r{constructor(){this._identifiers=[],this._invokables=[]}getIdentifiers(){return this._identifiers}getInvokable(e){const t=this._identifiers.indexOf(e);if(-1===t)throw new Error(`Invokable for '${e}' has not been registered yet.`);return this._invokables[t]}register(e,t){if(this.exists(e))throw new Error(`Invokable can't be registered. Identifier ${e} already exists.`);return this._identifiers.push(e),this._invokables.push(t),this}exists(e){return-1!==this._identifiers.indexOf(e)}create(e,...t){if(!this.exists(e))throw new Error(`Can't create '${e}', invokable has not been registered.`);const i=this._identifiers.indexOf(e),s=this._invokables[i];return t.splice(0,0,s),new(Function.prototype.bind.apply(s,t))}static getInstance(){}}let a=null;class l{constructor(e=null){this._seed=e,this._crypto="undefined"!=typeof window&&(window.crypto||window.msCrypto)||null}next(){if(this._crypto){const e=new Uint32Array(1);return this._crypto.getRandomValues(e),e/4294967296}return Math.random()}nextFloat(e,t){return this.next()*(t-e)+e}nextInteger(e,t){return Math.floor(this.next()*(t-e+1))+e}nextBytes(e){const t=new Uint8Array(e);if(this._crypto)this._crypto.getRandomValues(t);else for(let i=0;i<e;i++)t[i]=this.nextInteger(0,255);return t}nextBoolean(){return this.next()>=.5}nextChoice(e){return e[this.nextInteger(0,e.length-1)]}static getInstance(){return null===a&&(a=new l),a}}class o{static isEqual(e,t){if(e===t)return!0;if(null===e&&null===t)return!0;if(null===e||null===t)return!1;if(typeof e!=typeof t)return!1;if(e instanceof Array){if(e.length!==t.length)return!1;let i=-1,s=!0;for(;s&&++i<e.length;)s=o.isEqual(e[i],t[i]);return s}if(e instanceof Object){if("function"==typeof e.isEqualTo)return e.isEqualTo(t);if("function"==typeof t.isEqualTo)return t.isEqualTo(e);const i=o.unique(Object.keys(e).concat(Object.keys(t)));let s=-1,n=!0;for(;n&&++s<i.length;){let r=i[s];n=o.isEqual(e[r],t[r])}return n}return e instanceof Date&&e.getTime()===t.getTime()}static isUnique(e){return-1===e.findIndex((t,i)=>e.indexOf(t)!==i)}static unique(e){return e.filter((t,i)=>e.indexOf(t)===i)}static shuffle(e,t=null){t=t||l.getInstance();const i=e.slice();let s,n;for(s=i.length-1;s>0;s--)n=t.nextInteger(0,s),[i[s],i[n]]=[i[n],i[s]];return i}static chunk(e,t){const i=Math.ceil(e.length/t),s=new Array(i);for(let n=0;n<i;n++)s[n]=e.slice(n*t,(n+1)*t);return s}static joinSlices(e,t=[]){const i=e.length,s=t.length;let n=[];for(let r=0;r<i;r++)s>0&&r>0&&(n=n.concat(t)),n=n.concat(e[r]);return n}static indexOfSlice(e,t,i=0){if(0===t.length)return-1;let s=-1,n=i-1;for(;-1===s&&-1!==(n=e.indexOf(t[0],n+1));)this.isEqual(e.slice(n,n+t.length),t)&&(s=n);return s}static replaceSlice(e,t,i=[]){let s=0,n=-1,r=[];for(;-1!==(n=this.indexOfSlice(e,t,n+1));)r=r.concat(e.slice(s,n)),r=r.concat(i),s=n+t.length;return r=r.concat(e.slice(s)),r}static resizeBitSizedArray(e,t,i,s=!1){const n=Math.ceil(e.length*t/i),r=8===i?new Uint8Array(n):new Array(n).fill(0),a=(1<<i)-1;let l,o,h,c,d,u,g,p;for(let s=0;s<e.length;s++)for(l=e[s],o=s*t,h=(s+1)*t,c=Math.floor(o/i),d=Math.floor(h/i),u=i-h%i,r[d]|=l<<u&a,g=l>>i-u,p=d;--p>=c&&g>0;)r[p]|=g&a,g>>=i;if(s){let e=r.length-1;for(;0===r[e];)e--;return r.slice(0,e+1)}return r}}let h=0;class c{static camelCaseToRegular(e){return e.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/\b([A-Z]+)([A-Z])([a-z])/,"$1 $2$3").replace(/^./,e=>e.toUpperCase())}static uniqueId(){return"u"+(++h).toString(16)}static chunk(e,t){return""!==e?e.match(new RegExp(`.{1,${t}}`,"g")):[]}static isWhitespace(e,t=0){const i=e[t];return!!i&&null!==i.match(/\s/)}static removeWhitespaces(e){return this.replaceWhitespaces(e,"",!0)}static normalizeWhitespaces(e,t=!1){return this.replaceWhitespaces(e," ",t)}static replaceWhitespaces(e,t,i=!1){return i?e.replace(/\s+/g,t):e.replace(/\s/g,t)}}class d extends Error{constructor(e){super(e),this.name=this.constructor.name,"function"==typeof Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error(e).stack}}class u extends d{}class g extends u{constructor(e,t=null){super(e),this.index=t}}const p={alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",padding:"=",paddingOptional:!1,foreignCharacters:!1,maxLineLength:null,lineSeparator:"\r\n"};class m{static hexStringFromBytes(e){return Array.from(e).map(e=>("0"+e.toString(16)).slice(-2)).join("")}static bytesFromHexString(e){(e=c.removeWhitespaces(e)).length%2==1&&(e+="0");const t=c.chunk(e,2).map((e,t)=>{const i=parseInt(e,16);if(null===e.match(/[0-9a-f]{2}/i)||isNaN(i))throw new g(`Invalid hex encoded byte '${e}'`);return i});return new Uint8Array(t)}static binaryStringFromBytes(e){return Array.from(e).map(e=>("0000000"+e.toString(2)).slice(-8)).join("")}static bytesFromBinaryString(e){(e=c.removeWhitespaces(e)).length%8>0&&(e=e.padEnd(e.length-e.length%8+8,"0"));const t=c.chunk(e,8).map((e,t)=>{const i=parseInt(e,2);if(null===e.match(/[0-1]{8}/)||isNaN(i))throw new g(`Invalid binary encoded byte '${e}'`);return i});return new Uint8Array(t)}static base64StringFromBytes(e,t={}){const{alphabet:i,padding:s,paddingOptional:n,maxLineLength:r,lineSeparator:a}=Object.assign({},p,t),l=!n&&s?s:"";let o,h,c,d,u,g,m,b="";for(let t=0;t<e.length;t+=3)o=e[t],h=t+1<e.length?e[t+1]:NaN,c=t+2<e.length?e[t+2]:NaN,d=o>>2,u=(3&o)<<4|h>>4,g=(15&h)<<2|c>>6,m=63&c,b+=i[d]+i[u]+(isNaN(h)?l:i[g])+(isNaN(c)?l:i[m]);if(r){let e="";for(let t=0;t<b.length;t+=r)e+=(""!==e?a:"")+b.substr(t,r);b=e}return b}static bytesFromBase64String(e,t={}){const{alphabet:i,padding:s,paddingOptional:n,foreignCharacters:r,maxLineLength:a,lineSeparator:l}=Object.assign({},p,t),o=e.length,h=[];let c,d,u=-1;for(;++u<o;)if(c=e[u],null!==a&&l&&c===l[0]&&e.substr(u,l.length)===l)u=u+l.length-1;else if(c===s);else if(d=i.indexOf(c),-1!==d)h.push(d);else if(!r)throw new g(`Forbidden character '${c}' at index ${u}`);const m=(4-h.length%4)%4;if(3===m)throw new g("A single remaining encoded character in the last quadruple or a padding of 3 characters is not allowed");for(u=0;u<m;u++)h.push(0);const b=h.length/4*3,f=new Uint8Array(b);let y;for(u=0;u<h.length;u+=4)y=u/4*3,f[y]=h[u]<<2|h[u+1]>>4,f[y+1]=(15&h[u+1])<<4|h[u+2]>>2,f[y+2]=(3&h[u+2])<<6|h[u+3];return f.slice(0,b-m)}}class b extends u{constructor(e,t=null){super(e),this.byteIndex=t}}class f{static validateCodePoint(e){return isFinite(e)&&e>=0&&e<=1114111&&Math.floor(e)===e}static validateCodePoints(e){let t=!0,i=0;for(;t&&i<e.length;)t=f.validateCodePoint(e[i]),i++;return t}static stringFromCodePoints(e){const t=new Array(2*e.length);let i,s,n=0;for(i=0;i<e.length;i++)s=e[i],s<65536?t[n++]=String.fromCharCode(s):(s-=65536,t[n++]=String.fromCharCode(55296+(s>>10)),t[n++]=String.fromCharCode(s%1024+56320));return t.slice(0,n).join("")}static codePointsFromString(e){const t=e.length,i=new Array(t);let s,n,r=0,a=0;for(;a<t;)s=e.charCodeAt(a++),s>=55296&&s<=56319&&a<t?(n=e.charCodeAt(a++),56320==(64512&n)?i[r++]=((1023&s)<<10)+(1023&n)+65536:(i[r++]=s,a--)):i[r++]=s;return i.slice(0,r)}static bytesFromCodePoints(e,t="utf8"){if("utf8"===t)return f._encodeCodePointsToUTF8Bytes(e);throw new Error(`Encoding to '${t}' is currently not supported.`)}static codePointsFromBytes(e,t="utf8"){if("utf8"===t)return f._decodeCodePointsFromUTF8Bytes(e);throw new Error(`Decoding from '${t}' is currently not supported.`)}static _encodeCodePointsToUTF8Bytes(e){const t=new Uint8Array(4*e.length);let i,s,n=0;for(i=0;i<e.length;i++)s=e[i],s<=127?t[n++]=s:s<=2047?(t[n++]=192|s>>6,t[n++]=128|63&s):s<=65535?(t[n++]=224|s>>12,t[n++]=128|(4095&s)>>6,t[n++]=128|63&s):(t[n++]=240|s>>18,t[n++]=128|(262143&s)>>12,t[n++]=128|(4095&s)>>6,t[n++]=128|63&s);return t.slice(0,n)}static _decodeCodePointsFromUTF8Bytes(e){const t=e.length,i=new Array(t);let s,n,r=0,a=-1,l=0;for(;++a<t;)if(s=e[a],s>127&&s<=191){if(--r<0)throw new b(`Invalid UTF-8 encoded text: Unexpected continuation byte at 0x${a.toString(16)}`,a);n=n<<6|63&s,0===r&&(i[l++]=n)}else{if(r>0)throw new b(`Invalid UTF-8 encoded text: Continuation byte expected at 0x${a.toString(16)}`,a);if(s<=127)i[l++]=s;else if(s<=223)n=31&s,r=1;else if(s<=239)n=15&s,r=2;else{if(!(s<=247))throw new b(`Invalid UTF-8 encoded text: Invalid byte ${s} at 0x${a.toString(16)}`,a);n=7&s,r=3}}if(0!==r)throw new b("Invalid UTF-8 encoded text: Unexpected end of bytes");return i.slice(0,l)}}let _=null;class w{constructor(e=null,t="utf8"){if(this._codePoints=null,this._string=null,this._bytes=null,this._encoding=t,null===e)this._codePoints=[],this._string="",this._bytes=new Uint8Array(0);else{const t=Object.prototype.toString.call(e);switch(t){case"[object Array]":if(!f.validateCodePoints(e))throw new Error("Chain constructor expects a valid array of code points.");this._codePoints=e;break;case"[object String]":this._string=e;break;case"[object Uint8Array]":this._bytes=e;break;default:throw new Error(`Chain constructor expects one optional parameter of type Array, String or Uint8Array. Received unexpected ${t}.`)}}}getCodePoints(){return null===this._codePoints&&(null!==this._string?this._codePoints=f.codePointsFromString(this._string):this._codePoints=f.codePointsFromBytes(this._bytes,this._encoding)),this._codePoints}getChars(){return this.getCodePoints().map(e=>f.stringFromCodePoints([e]))}[Symbol.iterator](){return this.getCodePoints().values}getCodePointAt(e){return this.getCodePoints()[e]}getCharAt(e){return f.stringFromCodePoints([this.getCodePointAt(e)])}getCharBytesAt(e){return f.bytesFromCodePoints([this.getCodePointAt(e)])}getLength(){return this.getCodePoints().length}getString(){return null===this._string&&(this._string=f.stringFromCodePoints(this.getCodePoints())),this._string}toString(){return this.getString()}toLowerCase(){return w.wrap(this.getString().toLowerCase(),this._encoding)}toUpperCase(){return w.wrap(this.getString().toUpperCase(),this._encoding)}split(e=void 0,t=void 0){return e=e instanceof w?e.toString():e,this.getString().split(e,t).map(e=>w.wrap(e,this._encoding))}substr(e,t=void 0){if(t<=0||e>=this.getLength())return w.empty();e<0&&(e=Math.max(this.getLength()+e,0));const i=this.getCodePoints().slice(e,t?e+t:void 0);return w.wrap(i,this._encoding)}truncate(e){return this.getLength()>e?w.wrap(this.substr(0,e).getString()+"…",this._encoding):this}extend(e){const t=this.getCodePoints(),i=w.wrap(e).getCodePoints(),s=t.slice();let n,r=0;for(;s.length<i.length&&r<i.length;)n=i[r++],-1===t.indexOf(n)&&s.push(n);return w.wrap(s)}match(e){return this.getString().match(e)}getDescription(){return null!==this._string?`String(${this._string})`:null!==this._codePoints?`CodePoints(${this._codePoints.join(", ")})`:`Bytes(${m.hexStringFromBytes(this._bytes)})`}contains(e){return-1!==this.getString().indexOf(e.toString())}indexOfCodePoint(e,t=void 0){return this.getCodePoints().indexOf(e,t)}indexOf(e,t=void 0){const i=this.getString(),s=i.indexOf(e.toString(),t);if(-1===s)return-1;{const e=i.substr(0,s);return f.codePointsFromString(e).length}}getBytes(){return null===this._bytes&&(this._bytes=f.bytesFromCodePoints(this.getCodePoints(),this._encoding)),this._bytes}getByteAt(e){return this.getBytes()[e]}getSize(){return this.getBytes().length}needsTextEncoding(){return null===this._codePoints&&null===this._string}needsByteEncoding(){return null===this._bytes}isEmpty(){return this===_||null!==this._codePoints&&0===this._codePoints.length||null!==this._string&&""===this._string||null!==this._bytes&&0===this._bytes.length}isEqualTo(e){if(e===this)return!0;if(!(e instanceof w))return!1;if(this.isEmpty()&&e.isEmpty())return!0;if(e.getEncoding()!==this._encoding)return!1;if(null!==this._string&&this._string===e._string)return!0;if(null!==this._bytes&&null!==e._bytes)return o.isEqual(this._bytes,e._bytes);try{return o.isEqual(this.getCodePoints(),e.getCodePoints())}catch(e){if(e instanceof b)return!1;throw e}}getEncoding(){return this._encoding}static isEqual(...e){if(e.length<2)return!0;const t=e[0];if(!(t instanceof w))return!1;let i=!0,s=0;for(;i&&++s<e.length;)i=t.isEqualTo(e[s]);return i}static wrap(e,t="utf8"){return e instanceof w?e:null===e||0===e.length?w.empty():new w(e,t)}static join(e,t=void 0){return w.wrap(e.map(e=>e.toString()).join(t))}static empty(){return null===_&&(_=new w),_}}class v extends s{constructor(){super(),this._$message=null,this._message=null,this._id=c.uniqueId(),this._first=!1}isFirst(){return this._first}setFirst(e){return this._first!==e&&(this._first=e,e?this.getElement().classList.add("field--first"):this.getElement().classList.remove("field--first")),this}getMessage(){return this._message}setMessage(e){return this._message=e,this.update()}clearMessage(){return this.setMessage(null)}getId(){return this._id}render(){return s.createElement("div",{className:"field"+(this._first?" field--first":"")},[this.renderLabel(),this.renderField()])}renderLabel(){return s.createElement("label",{className:"field__label",htmlFor:this.getId()},this.getModel().getLabel())}renderField(){return s.createElement("div",{className:"field__field"})}renderMessage(){return null!==this.getMessage()?s.createElement("div",{className:"field__message"},this.getMessage()):null}didRender(){super.didRender(),this.updateValue()}update(){const e=this.getElement();return e.dataset.width=this.getModel().getWidth(),this.hasFocus()?e.classList.add("field--focus"):e.classList.remove("field--focus"),this.getModel().isValid()&&null===this.getMessage()?e.classList.remove("field--invalid"):e.classList.add("field--invalid"),null!==this._$message&&null!==this._$message.parentNode&&this._$message.parentNode.removeChild(this._$message),this._$message=null,this._$message=this.renderMessage(),null!==this._$message&&this.getElement().appendChild(this._$message),this}didFocus(){this.getElement().classList.add("field--focus")}didBlur(){this.getElement().classList.remove("field--focus")}updateValue(){return this}}class S extends s{render(){return s.createElement("div",{className:"form"})}appendSubviewElement(e){if(e instanceof v){this.getElement();const t=this.getSubviews().filter(e=>e instanceof v);t.push(e);const i=this.getModel().getFields();t.sort((e,t)=>i.indexOf(e.getModel())-i.indexOf(t.getModel()));const s=t.indexOf(e),n=s<t.length-1?t[s+1].getElement():null;this.getElement().insertBefore(e.getElement(),n);let r=0;return t.forEach(e=>{const t=e.getModel().getWidth();r+=t,r===t||r>12?(r=t,e.setFirst(!0)):e.setFirst(!1)}),this}return super.appendSubviewElement(e)}}var C='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M16 7H3.83l3.58-3.59L6 2 0 8l6 6 1.41-1.41L3.83 9H16z"/></svg>';const V={forward:C,backward:C,error:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M15 2.41L13.59 1 8 6.59 2.41 1 1 2.41 6.59 8 1 13.59 2.41 15 8 9.41 13.59 15 15 13.59 9.41 8z"/></svg>'};class k extends s{constructor(){super(),this._$menu=null,this._$body=null,this._$settings=null,this._$header=null,this._$status=null,this._$statusIcon=null,this._$statusMessage=null,this._menuVisible=!1,this._menuHideHandler=this.toggleMenu.bind(this)}render(){this._$settings=this.renderSettings(),this._$header=this.renderHeader();const e=this.getModel().getMeta();return s.createElement("div",{className:"brick",role:"region",ariaLabel:`${e.title} ${e.type}`},[this._$header,this._$settings,this.renderContent(),this.renderStatus()])}renderHeader(){this._$menu=this.renderMenu();const e=s.createElement("button",{className:"brick__btn-menu",onClick:e=>{e.preventDefault(),this.toggleMenu()}});e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><circle cx="8" cy="2" r="1.5"/><circle cx="8" cy="8" r="1.5"/><circle cx="8" cy="14" r="1.5"/></svg>';const t=s.createElement("div",{className:"brick__title-caret"});return t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M3 6l5 5 5-5z"/></svg>',s.createElement("header",{className:"brick__header"},[s.createElement("button",{className:"brick__title",onClick:e=>{e.preventDefault(),this.getModel().viewReplaceButtonDidClick(this)}},[s.createElement("h3",{className:"brick__title-inner"},this.getModel().getTitle()),t]),e])}renderMenu(){const e=[];return this.getModel().hasPipe()&&(e.push({label:"Remove",name:"remove"}),e.push({label:"Hide",name:"hide"}),e.push({label:"Duplicate",name:"duplicate"})),this.getModel().isRandomizable()&&e.push({label:"Randomize",name:"randomize"}),s.createElement("div",{className:"brick__menu menu"},[s.createElement("ul",{className:"menu__list"},e.map(e=>s.createElement("li",{className:"menu__item"},[s.createElement("button",{className:"menu__button",onClick:t=>{t.preventDefault(),this.getModel().viewMenuItemDidClick(this,e.name)}},e.label)])))])}renderSettings(){return s.createElement("div",{className:"brick__settings"})}renderContent(){return s.createElement("div",{className:"brick__content"})}renderStatus(){return this._$statusIcon=s.createElement("div",{className:"brick__status-icon"}),this._$statusMessage=s.createElement("div",{className:"brick__status-message"}),this._$status=s.createElement("footer",{className:"brick__status brick__status--hidden"},[this._$statusIcon,this._$statusMessage]),this._$status}appendSubviewElement(e){return e instanceof S?(this.getElement(),this._$settings.appendChild(e.getElement()),this):super.appendSubviewElement(e)}didFocus(){this.getElement().classList.add("brick--focus")}didBlur(){this.getElement().classList.remove("brick--focus")}toggleMenu(){this._menuVisible=!this._menuVisible,this._menuVisible?(this._$header.appendChild(this._$menu),this._$menu.getBoundingClientRect(),this._$menu.classList.add("menu--visible"),window.requestAnimationFrame(()=>{window.addEventListener("click",this._menuHideHandler)})):(this._$header.removeChild(this._$menu),window.removeEventListener("click",this._menuHideHandler))}updateStatus(e,t=null){return null===e?(this._$status.classList.add("brick__status--hidden"),this._$statusIcon.innerHTML=null,this._$statusMessage.innerText=null):(this._$status.className=`brick__status brick__status--${e}`,this._$statusIcon.innerHTML=V[e]||"",this._$statusMessage.innerText=t||"","forward"!==e&&"backward"!==e||(this._$status.classList.add("brick__status--flash"),this._$status.getBoundingClientRect(),this._$status.classList.remove("brick__status--flash"))),this}}let x=null;class I{constructor(){this._observerNames=[],this._observerCallbacks=[]}trigger(e,t=null){let i=0;for(;-1!==(i=this._observerNames.indexOf(e,i));)this._observerCallbacks[i](e,t),i++;return this}subscribe(e,t){return this._observerNames.push(e),this._observerCallbacks.push(t),this}unsubscribe(e,t){let i=0;for(;-1!==(i=this._observerNames.indexOf(e,i));)this._observerCallbacks[i]===t?(this._observerNames.splice(i,1),this._observerCallbacks.splice(i,1)):i++;return this}static getSharedInstance(){return null===x&&(x=new I),x}static trigger(e,t=null){return I.getSharedInstance().trigger(e,t)}}class E{constructor(){this._view=null,this._viewPrototype=s}hasView(){return null!==this._view}getView(){return null===this._view&&(this._view=new this._viewPrototype,this._view.setModel(this),this.didCreateView(this._view)),this._view}updateView(){return this.hasView()&&this.getView().setNeedsUpdate(),this}didCreateView(e){}}class M extends E{constructor(e,t={}){super(),this._viewPrototype=v,this._name=e,this._value=void 0!==t.value?t.value:null,this._delegate=t.delegate||null,this._randomizable=!1!==t.randomizable,this._valid=!0,this._message=null,this._messageKey=null,this._validateValueCallback=t.validateValue||null,this._filterValueCallback=t.filterValue||null,this._randomizeValueCallback=t.randomizeValue||null,this._label=t.label||c.camelCaseToRegular(e),this._visible=!1!==t.visible,this._priority=void 0!==t.priority?t.priority:0,this._width=t.width||12}getName(){return this._name}getLabel(){return this._label}isVisible(){return this._visible}setVisible(e){return this._visible=e,this._delegate&&this._delegate.fieldNeedsLayout&&this._delegate.fieldNeedsLayout(this),this}getPriority(){return this._priority}setPriority(e){return this._priority=e,this._delegate&&this._delegate.fieldPriorityDidChange&&this._delegate.fieldPriorityDidChange(this,e),this._delegate&&this._delegate.fieldNeedsLayout&&this._delegate.fieldNeedsLayout(this),this}getWidth(){return this._width}setWidth(e){return this._width=e,this.updateView(),this._delegate&&this._delegate.fieldNeedsLayout&&this._delegate.fieldNeedsLayout(this),this}getDelegate(){return this._delegate}setDelegate(e){return this._delegate=e,this}unsetDelegate(){return this._delegate=null,this}isValid(){return this._valid}getMessage(){return this._message}getMessageKey(){return this._messageKey}getValue(){return this._value}setValue(e,t=null){const i=this.validateValue(e);if(this._valid=!0===i,this._valid?(this._message=null,this._messageKey=null):"object"==typeof i?(this._message=i.message,this._messageKey=i.key):(this._message="The value is invalid",this._messageKey="invalid"),this.hasView()&&this.getView().setMessage(this.getMessage()),!this._valid)return this._value=e,this;const s=this.filterValue(e);return(s instanceof w?s.isEqualTo(this._value):this._value===s)||(this._value=s,this.hasView()&&this.getView()!==t&&this.getView().updateValue(),this._delegate&&this._delegate!==t&&void 0!==this._delegate.fieldValueDidChange&&this.getDelegate().fieldValueDidChange(this,s)),this}revalidateValue(){return this.setValue(this.getValue())}validateValue(e){return null===this._validateValueCallback||this._validateValueCallback(e,this)}filterValue(e){return null!==this._filterValueCallback?this._filterValueCallback(e,this):e}isRandomizable(){return this._randomizable}randomize(e=null){if(!this.isRandomizable())return this;const t=this.randomizeValue(e||new l);return null!==t?this.setValue(t):this}randomizeValue(e){return this.randomizeValueWithCallback(e)}randomizeValueWithCallback(e){return null!==this._randomizeValueCallback?this._randomizeValueCallback(e,this):null}isCustomRandomizationSet(){return null!==this._randomizeValueCallback}serializeValue(){if(!this.isValid())throw new Error("Invalid field values can't be serialized.");const e=this.getValue();if("boolean"!=typeof e&&"number"!=typeof e&&"string"!=typeof e&&null!==e)throw new Error(`Field value serialization is not possible. Generic fields can only serialize boolean, number, string or null values safely. Received value type '${typeof e}'.`);return e}extract(e){return this.setValue(this.extractValue(e)),this}extractValue(e){return e}didCreateView(e){this.getView().setMessage(this.getMessage())}}class B extends v{constructor(){super(),this._$input=null}updateValue(){return this._$input.checked=this.getModel().getValue(),this}render(){const e=super.render();return e.classList.add("field-boolean"),e}renderField(){this._$input=s.createElement("input",{className:"field-boolean__input",type:"checkbox",id:this.getId(),onChange:this.inputValueDidChange.bind(this),checked:this.getModel().getValue(),onFocus:e=>this.focus(),onBlur:e=>this.blur()});const e=s.createElement("label",{className:"field-boolean__toggle",htmlFor:this.getId()},[s.createElement("span",{className:"field-boolean__choice"},this.getModel().getTrueLabel()),s.createElement("span",{className:"field-boolean__choice"},this.getModel().getFalseLabel())]),t=super.renderField();return t.appendChild(this._$input),t.appendChild(e),t}inputValueDidChange(e){this.getModel().viewValueDidChange(this,this._$input.checked)}}const z=[!0,1,"1","true"],L=[!1,0,"0","false"];class T extends M{constructor(e,t={}){super(e,t),this._viewPrototype=B,this._trueLabel=t.trueLabel||"Yes",this._falseLabel=t.falseLabel||"No"}getTrueLabel(){return this._trueLabel}getFalseLabel(){return this._falseLabel}validateValue(e){return-1===z.indexOf(e)&&-1===L.indexOf(e)?{key:"booleanInvalid",message:"The value is not a boolean"}:super.validateValue(e)}filterValue(e){return super.filterValue(-1!==z.indexOf(e))}randomizeValue(e){const t=super.randomizeValue(e);return null!==t?t:e.nextBoolean()}viewValueDidChange(e,t){this.setValue(t,e)}}class A extends v{constructor(){super(),this._$input=null}updateValue(){const e=this.getModel().getValue();let t=m.hexStringFromBytes(e);return t=c.chunk(t,2).join(" "),this._$input.value=t,this}render(){const e=super.render();return e.classList.add("field-byte"),e}renderField(){this._$input=s.createElement("input",{className:"field-byte__input",id:this.getId(),type:"text",spellcheck:!1,onInput:this.inputValueDidChange.bind(this),onFocus:e=>this.focus(),onBlur:e=>this.blur()});const e=super.renderField();return e.classList.remove("field__field"),e.classList.add("field-byte__field"),e.appendChild(this._$input),e}inputValueDidChange(e){const t=c.removeWhitespaces(this._$input.value);if(null===t.match(/^[0-9a-f]+$/gi))return this.setMessage("The value contains non-hexadecimal characters");this.clearMessage();const i=m.bytesFromHexString(t);this.getModel().viewValueDidChange(this,i)}}class P extends M{constructor(e,t={}){super(e,t),this._viewPrototype=A,this._value=t.value||new Uint8Array,this._minSize=null,this._maxSize=null,this._randomizeSize=t.randomizeSize||null,this.setMinSize(t.minSize||null,!1),this.setMaxSize(t.maxSize||null,!1)}getMinSize(){return this._minSize}setMinSize(e,t=!0){return this._minSize===e?this:(this._minSize=null!==e?parseInt(e):null,t?this.revalidateValue():this)}getMaxSize(){return this._maxSize}setMaxSize(e,t=!0){return this._maxSize===e?this:(this._maxSize=null!==e?parseInt(e):null,t?this.revalidateValue():this)}validateValue(e){return e instanceof Uint8Array?null!==this._minSize&&e.length<this._minSize?{key:"byteSizeTooShort",message:`The value must be at least ${this._minSize} `+(1===this._minSize?"byte":"bytes")+" long, "+`found ${e.length} ${1===e.length?"byte":"bytes"}`}:null!==this._maxSize&&e.length>this._maxSize?{key:"byteSizeTooLong",message:`The value must not exceed ${this._maxSize} `+(1===this._maxSize?"byte":"bytes")+" in length, "+`found ${e.length} ${1===e.length?"byte":"bytes"}`}:super.validateValue(e):{key:"byteUnexpectedType",message:"The value is expected to be of type Uint8Array"}}randomizeValue(e){const t=super.randomizeValue(e);return null!==t?t:null!==this._randomizeSize?e.nextBytes(this._randomizeSize):null!==this.getMinSize()?e.nextBytes(this.getMinSize()):this.isValid()?e.nextBytes(this.getValue().length):null}serializeValue(){return m.base64StringFromBytes(this.getValue())}extractValue(e){if("string"!=typeof e)throw new Error(`Value of field '${this.getName()}' is expected to be a valid base64 string.`);return m.bytesFromBase64String(e)}viewValueDidChange(e,t){this.setValue(t,e)}}class N extends v{constructor(){super(),this._style="default",this._$select=null,this._$$radio=[]}getStyle(){return this._style}setStyle(e){return this._style!==e&&(this._style=e,this.refresh()),this}updateValue(){const e=this.getModel().getSelectedIndex();return"radio"===this.getStyle()?this._$$radio.forEach((t,i)=>{t.checked=i===e}):this._$select.value=e,this}render(){const e=super.render();return e.className+=` field-enum field-enum--${this.getStyle()}`,e}renderField(){const e=this.getModel().getElementLabels(),t=this.getModel().getElementDescriptions(),i=super.renderField();if(i.classList.remove("field__field"),i.classList.add("field-enum__field"),"radio"===this.getStyle()){this._$$radio=[];const t=s.createElement("div",{className:"field-enum__options",role:"radiogroup",id:this.getId()});i.appendChild(t),e.map((e,i)=>{const n=`${this.getId()}-${i+1}`,r=s.createElement("input",{type:"radio",className:"field-enum__option-radio",id:n,onChange:this.valueDidChange.bind(this),name:this.getId()}),a=s.createElement("div",{className:"field-enum__option"},[r,s.createElement("label",{htmlFor:n,className:"field-enum__option-label"},e)]);this._$$radio.push(r),t.appendChild(a)})}else{const n=e.map((e,i)=>s.createElement("option",{value:i,title:t[i]||""},e));this._$select=s.createElement("select",{className:"field-enum__select",id:this.getId(),onChange:this.valueDidChange.bind(this),onFocus:e=>this.focus(),onBlur:e=>this.blur()},n),i.appendChild(this._$select)}return i}valueDidChange(e){const t="radio"===this.getStyle()?this._$$radio.findIndex(e=>e.checked):parseInt(this._$select.value),i=this.getModel().getElementAt(t);this.getModel().viewValueDidChange(this,i)}}class $ extends M{constructor(e,t){super(e,t),this._viewPrototype=N,this._elements=[],this._labels=[],this._descriptions=[],this._style=t.style||"default",this._blackChoiceList=t.blackChoiceList||[],this.setElements(t.elements,t.labels||null,t.descriptions||null,!1)}getElements(){return this._elements}getElementLabels(){return this._labels}getElementDescriptions(){return this._descriptions}setElements(e,t=null,i=null,s=!0){if(0===e.length)throw new Error("Array of elements can't be empty.");if(null!==t&&e.length!==t.length)throw new Error("Element and label arrays require the same length.");if(null!==i&&e.length!==i.length)throw new Error("Element and description arrays require the same length.");return this._elements=e,this._labels=null!==t?t:e,this._descriptions=null!==i?i:e.map(()=>null),null===this._value&&(this._value=this._elements[0]),this.hasView()&&this.getView().refresh(),s?this.revalidateValue():this}getElementAt(e){return e<this._elements.length?this._elements[e]:null}getSelectedIndex(){return this._elements.indexOf(this.getValue())}setSelectedIndex(e){const t=this._elements[e];return this.setValue(t)}getStyle(){return this._style}setStyle(e){return this._style=e,this.hasView()&&this.getView().setStyle(e),this}getBlackChoiceList(){return this._blackChoiceList}setBlackChoiceList(e,t=!0){return this._blackChoiceList=e,t?this.revalidateValue():this}validateValue(e){return-1===this._elements.indexOf(e)?{key:"enumNotInHaystack",message:"The value must be occur in the list of elements"}:this._blackChoiceList.includes(e)?{key:this.name,message:"Chosen option is not compatible with other settings"}:super.validateValue(e)}randomizeValue(e){const t=super.randomizeValue(e);return null!==t?t:e.nextChoice(this._elements)}viewValueDidChange(e,t){this.setValue(t,e)}didCreateView(e){super.didCreateView(e),this.getView().setStyle(this.getStyle())}}class D extends v{constructor(){super(),this._$input=null,this._displayEnabled=!1,this._$display=null,this._$displayValue=null,this._$displayDescription=null}updateValue(){const e=this.getModel().getValue();return this._$input.value=e,this._updateValueDisplay(),this}_updateValueDisplay(){const e=this.getModel().getValue(),t=this.getModel().getValueDescription(),i=null!==t;return this._displayEnabled!==i&&(this._displayEnabled=i,i?this._$display.classList.add("field-number__display--enabled"):(this._$display.classList.remove("field-number__display--enabled"),this._$displayValue.innerText="",this._$displayDescription.innerText="")),i&&(this._$displayValue.innerText=e,this._$displayDescription.innerText=t),this}render(){const e=super.render();return e.classList.add("field-number"),e}renderField(){this._$input=s.createElement("input",{className:"field-number__input",id:this.getId(),type:"number",onInput:this.inputValueDidChange.bind(this),onFocus:e=>this.focus(),onBlur:e=>this.blur()}),this._$displayValue=s.createElement("span",{className:"field-number__display-value"}),this._$displayDescription=s.createElement("span",{className:"field-number__display-description"}),this._$display=s.createElement("div",{className:"field-number__display"},[this._$displayValue,this._$displayDescription]);const e=s.createElement("button",{className:"field-number__btn-step-down",onClick:this.stepDownButtonDidClick.bind(this)},"Step Down"),t=s.createElement("div",{className:"field-number__value"},[this._$input,this._$display]),i=s.createElement("button",{className:"field-number__btn-step-up",onClick:this.stepUpButtonDidClick.bind(this)},"Step Up"),n=super.renderField();return n.classList.remove("field__field"),n.classList.add("field-number__field"),n.appendChild(e),n.appendChild(t),n.appendChild(i),n}inputValueDidChange(e){this.getModel().viewValueDidChange(this,this._$input.value),this._updateValueDisplay()}stepDownButtonDidClick(e){return this.getModel().stepDown(),e.preventDefault(),!1}stepUpButtonDidClick(e){return this.getModel().stepUp(),e.preventDefault(),!1}}class F extends M{constructor(e,t){super(e,t),this._viewPrototype=D,this._integer=t.integer||!1,this._step=t.step||1,this._min=void 0!==t.min?t.min:null,this._max=void 0!==t.max?t.max:null,this._rotate=void 0!==t.rotate?t.rotate:null!==this._min&&null!==this._max,this._describeValueCallback=t.describeValue||null}isInteger(){return this._integer}setInteger(e){return this._integer=e,this.revalidateValue()}getStep(){return this._step}setStep(e){return this._step=e,this}stepValue(e,t=100){let i=this.getValue(),s=0,n=!1;for(;!n&&s++<t&&(this._rotate||e>0||i!==this._min)&&(this._rotate||e<0||i!==this._max);)i+=e,this._rotate&&i>this._max&&this._rotate?i=this._min:this._rotate&&i<this._min&&this._rotate&&(i=this._max+e),n=!0===this.validateValue(i);return n?i:null}stepUp(){const e=this.stepValue(this._step);return null!==e?this.setValue(e):this}stepDown(){const e=this.stepValue(-this._step);return null!==e?this.setValue(e):this}getMin(){return this._min}setMin(e){return this._min=e,this.revalidateValue()}getMax(){return this._max}setMax(e){return this._max=e,this.revalidateValue()}isRotate(){return this._rotate}setRotate(e){return this._rotate=e&&null!==this._min&&null!==this._max,this}getValueDescription(){return this.isValid()&&null!==this._describeValueCallback?this._describeValueCallback(this.getValue(),this):null}setNeedsValueDescriptionUpdate(){this.hasView()&&this.getView().updateValue()}validateValue(e){const t=this.filterValue(e);return isNaN(t)||!isFinite(t)?{key:"numberNotNumeric",message:"The value is not numeric"}:null!==this._min&&t<this._min?{key:"numberTooSmall",message:`The value must be greater than or equal to ${this._min}`}:null!==this._max&&t>=this._max?{key:"numberTooLarge",message:`The value must be less than ${this._max}`}:super.validateValue(t)}filterValue(e){return e=this.isInteger()?parseInt(e):parseFloat(e),super.filterValue(e)}randomizeValue(e){const t=super.randomizeValue(e);return null!==t?t:null!==this.getMin()&&null!==this.getMax()?this.isInteger()?e.nextInteger(this.getMin(),Math.ceil(this.getMax())-1):e.nextFloat(this.getMin(),this.getMax()):null}viewValueDidChange(e,t){this.setValue(t,e)}}class O extends v{constructor(){super(),this._$input=null}updateValue(){return this._$input.value=this.getModel().getValue().getString(),this}render(){const e=super.render();return e.classList.add("field-text"),e}renderField(){this._$input=s.createElement("input",{className:"field-text__input",id:this.getId(),type:"text",spellcheck:!1,onInput:this.inputValueDidChange.bind(this),onFocus:e=>this.focus(),onBlur:e=>this.blur()});const e=super.renderField();return e.classList.remove("field__field"),e.classList.add("field-text__field"),e.appendChild(this._$input),e}inputValueDidChange(e){this.getModel().viewValueDidChange(this,this._$input.value)}}class R extends M{constructor(e,t={}){super(e,t),this._viewPrototype=O,this._value=w.wrap(t.value||null),this._minLength=null,this._maxLength=null,this._whitelistChars=null,this._blacklistChars=null,this._uniqueChars=!1,this._caseSensitivity=null,this.setMinLength(void 0!==t.minLength?t.minLength:null,!1),this.setMaxLength(void 0!==t.maxLength?t.maxLength:null,!1),this.setWhitelistChars(t.whitelistChars||null,!1),this.setBlacklistChars(t.blacklistChars||null,!1),this.setUniqueChars(t.uniqueChars||!1,!1),this.setCaseSensitivity(!1!==t.caseSensitivity,!1)}getMinLength(){return this._minLength}setMinLength(e,t=!0){return this._minLength===e?this:(this._minLength=null!==e?parseInt(e):null,t?this.revalidateValue():this)}getMaxLength(){return this._maxLength}setMaxLength(e,t=!0){return this._maxLength===e?this:(this._maxLength=null!==e?parseInt(e):null,t?this.revalidateValue():this)}getWhitelistChars(){return this._whitelistChars}setWhitelistChars(e,t=!0){return this._whitelistChars=null!==e?w.wrap(e).getCodePoints():null,t?this.revalidateValue():this}getBlacklistChars(){return this._blacklistChars}setBlacklistChars(e,t=!0){return this._blacklistChars=null!==e?w.wrap(e).getCodePoints():null,t?this.revalidateValue():this}isUniqueChars(){return this._uniqueChars}setUniqueChars(e,t=!0){return this._uniqueChars===e?this:(this._uniqueChars=e,t?this.revalidateValue():this)}isCaseSensitive(){return this._caseSensitivity}setCaseSensitivity(e,t=!0){return this._caseSensitivity===e?this:(this._caseSensitivity=e,t?this.revalidateValue():this)}validateValue(e){if("function"!=typeof e.toString)return{key:"textInvalidString",message:"The value can't be casted to a string"};const t=this.filterValue(e);if(null!==this._minLength&&t.getLength()<this._minLength)return{key:"textLengthTooShort",message:`The value must be at least ${this._minLength} `+(1===this._minLength?"character":"characters")+" long"};if(null!==this._maxLength&&t.getLength()>this._maxLength)return{key:"textLengthTooLong",message:`The value must not exceed ${this._maxLength} `+(1===this._maxLength?"character":"characters")+" in length"};if(this._uniqueChars&&!o.isUnique(t.getCodePoints()))return{key:"textCharactersNotUnique",message:"The value must not contain duplicate characters"};if(null!==this._whitelistChars||null!==this._blacklistChars){let e,i=this._whitelistChars,s=this._blacklistChars,n=[];for(let r=0;r<t.getLength();r++)e=t.getCodePointAt(r),(null!==i&&-1===i.indexOf(e)||null!==s&&-1!==s.indexOf(e))&&n.push(t.getCharAt(r));if(n.length>0)return n=o.unique(n),{key:"textForbiddenCharacter",message:`The value contains forbidden characters: '${n.join("")}'`}}return super.validateValue(t)}filterValue(e){return e=w.wrap(e),!1===this._caseSensitivity&&(e=e.toLowerCase()),w.wrap(super.filterValue(e))}randomizeValue(e){const t=super.randomizeValue(e);if(null!==t)return t;if(this.isValid()){if(this.isUniqueChars()){const t=this.getValue().getCodePoints();return w.wrap(o.shuffle(t,e))}if(null!==this.getWhitelistChars()){const t=this.getValue().getLength(),i=[];for(let s=0;s<t;s++)i.push(e.nextChoice(this.getWhitelistChars()));return w.wrap(i)}}return null}serializeValue(){return this.getValue().getString()}extractValue(e){if("string"!=typeof e)throw new Error(`Value of field '${this.getName()}' is expected to be a string.`);return w.wrap(e)}viewValueDidChange(e,t){this.setValue(t,e)}}let q=null;class U extends r{constructor(){super();const e={boolean:T,bytes:P,enum:$,number:F,text:R};for(let t in e)this.register(t,e[t])}create(e){if(!e.name)throw new Error("Field specification requires a 'name' field.");if(!e.type)throw new Error("Field specification requires a 'type' field.");if(!this.exists(e.type))throw new Error(`Unknown Field type '${e.type}'.`);return super.create(e.type,e.name,e)}static getInstance(){return null===q&&(q=new U),q}}class j extends E{constructor(e=[],t=null){super(),this._viewPrototype=S,this._delegate=null,this._fieldFactory=t,this._fields=[],this.addFields(e)}getFields(){return this._fields.slice()}getInvalidFields(){return this._fields.filter(e=>!e.isValid())}getVisibleFields(){return this._fields.filter(e=>e.isVisible())}addFields(e){return e.forEach(this.addField.bind(this)),this}removeFields(e){return e.forEach(this.removeField.bind(this)),this}getField(e){return this._fields.find(t=>t.getName()===e)||null}addField(e){let t=e;if(!(e instanceof M)){const i=e;void 0===i.priority&&(i.priority=this._calculateDefaultPriority()),t=this.getFieldFactory().create(i)}if(this.getField(t.getName()))throw new Error(`Name '${t.getName()}' is already assigned to a field.`);return this._fields.push(t),t.setDelegate(this),this._sortFields(),t.isVisible()&&this.hasView()&&this.getView().addSubview(t.getView()),this}removeField(e){let t=e;if(!(e instanceof M)){const i=e;void 0===i.priority&&(i.priority=this._calculateDefaultPriority()),t=this.getFieldFactory().create(i)}if(!this.getField(t.getName()))throw new Error(`Field '${t.getName()}' is not assigned to the field.`);let i=this._fields.indexOf(t);return this._fields.splice(i,1),t.unsetDelegate(),this._sortFields(),t.isVisible()&&this.hasView()&&this.getView().removeSubview(t.getView()),this}getFieldValue(e){const t=this.getField(e);if(null===t)throw new Error(`There is no field assigned to the name '${e}'.`);return t.getValue()}setFieldValue(e,t){const i=this.getField(e);if(null===i)throw new Error(`There is no field assigned to the name '${e}'.`);return i.setValue(t),this}getFieldValues(){const e={};return this.getVisibleFields().forEach(t=>{e[t.getName()]=t.getValue()}),e}setFieldValues(e){for(let t in e)this.setFieldValue(t,e[t]);return this}getFieldFactory(){return null===this._fieldFactory&&(this._fieldFactory=U.getInstance()),this._fieldFactory}setFieldFactory(e){return this._fieldFactory=e,this}isValid(){return 0===this.getInvalidFields().length}isRandomizable(){return void 0!==this._fields.find(e=>e.isRandomizable())}randomize(){return this._fields.filter(e=>e.isVisible()&&e.isRandomizable()).forEach(e=>e.randomize()),this}getDelegate(){return this._delegate}setDelegate(e){return this._delegate=e,this}serializeValues(){const e={};return this.getVisibleFields().forEach(t=>{e[t.getName()]=t.serializeValue()}),e}extract(e){return this.setFieldValues(this.extractValues(e))}extractValues(e){if("object"!=typeof e)throw new Error(`Serialized form values is expected to be an object mapping field names to their respective serialized values. Received value type '${typeof e}'.`);const t={};for(let i in e){if("string"!=typeof i)throw new Error(`Field name is expected to be a string. Received type '${typeof i}'.`);const s=this.getField(i);if(null===s)throw new Error(`There is no field assigned to the name '${i}'.`);t[i]=s.extractValue(e[i])}return t}_calculateDefaultPriority(){if(0===this._fields.length)return 0;let e=this._fields[0].getPriority();for(let t=1;t<this._fields.length;t++)e=Math.min(e,this._fields[t].getPriority());return e-1}_sortFields(){this._fields.sort((e,t)=>t.getPriority()-e.getPriority())}didCreateView(e){this._fields.forEach(e=>this.fieldNeedsLayout(e))}fieldPriorityDidChange(e,t){this._sortFields()}fieldNeedsLayout(e){this.hasView()&&(e.getView().removeFromSuperview(),e.isVisible()&&this.getView().addSubview(e.getView()))}fieldValueDidChange(e,t){this._delegate&&this._delegate.formValueDidChange&&this.getDelegate().formValueDidChange(this,e,t)}}class W extends E{static getMeta(){throw new Error("Brick static method 'getMeta' has not been overridden.")}constructor(){super(),this._pipe=null,this._viewPrototype=k,this._settingsForm=new j,this._settingsForm.setDelegate(this),this._title=null,this._hidden=!1}getPipe(){return this._pipe}hasPipe(){return null!==this._pipe}setPipe(e){return this._pipe=e,this}getMeta(){return this.constructor.getMeta()}getName(){return this.getMeta().name}getTitle(){return null===this._title?this.getMeta().title:this._title}setTitle(e){return this._title=e&&e!==this.getMeta().title?e:null,this}isHidden(){return this._hidden}setHidden(e=!0){return this._hidden!==e&&(this._hidden=e,this.hasPipe()&&this.getPipe().brickVisibilityDidChange(this,e)),this}getSettingsForm(){return this._settingsForm}getSettings(){return this._settingsForm.getFields()}addSettings(e){return this._settingsForm.addFields(e),this}removeSettings(e){return this._settingsForm.removeFields(e),this}getSetting(e){return this._settingsForm.getField(e)}addSetting(e){return this._settingsForm.addField(e),this}removeSetting(e){return this._settingsForm.removeField(e),this}getSettingValue(e){return this._settingsForm.getFieldValue(e)}setSettingValue(e,t){return this._settingsForm.setFieldValue(e,t),this}getSettingValues(){return this._settingsForm.getFieldValues()}setSettingValues(e){return this._settingsForm.setFieldValues(e),this}isValid(){return this._settingsForm.isValid()}isSettingValid(...e){return void 0===e.find(e=>!this.getSetting(e).isValid())}isRandomizable(){return this._settingsForm.isRandomizable()}randomize(){return this._settingsForm.randomize(),this}formValueDidChange(e,t,i){e===this._settingsForm&&(this.settingValueDidChange(t,i),this.hasPipe()&&this.getPipe().brickSettingDidChange(this))}settingValueDidChange(e,t){}didCreateView(e){e.addSubview(this._settingsForm.getView())}viewMenuItemDidClick(e,t){switch(I.trigger("brickMenuItemClick",{brick:this,menuItem:t}),t){case"remove":this.getPipe().removeBrick(this);break;case"hide":this.setHidden(!0);break;case"duplicate":this.isValid()&&this.getPipe().duplicateBrick(this);break;case"randomize":this.randomize()}}viewReplaceButtonDidClick(e){this.hasPipe()&&(I.trigger("brickReplaceButtonClick",{brick:this}),this.getPipe().brickReplaceButtonDidClick(this))}serialize(){const e={};e.name=this.getName(),null!==this._title&&(e.title=this._title),this.isHidden()&&(e.hidden=!0);const t=this._settingsForm.serializeValues();return Object.keys(t).length>0&&(e.settings=t),e}copy(){if(!this.isValid())throw new Error("Invalid bricks can't be copied.");const e=new this.constructor;return e.setTitle(this.getTitle()),e.setHidden(this.isHidden()),e.setSettingValues(this.getSettingValues()),e}static extract(e,t){if("string"!=typeof e.name)throw new Error("Brick property 'name' is expected to be of type 'string'");const i=e.name;if(!t.exists(i))throw new Error(`Brick property 'name' refers to an unknown brick '${i}'`);const s=t.create(i);if(void 0!==e.title){if("string"!=typeof e.title)throw new Error("Optional brick property 'title' is expected to be of type 'string'");s.setTitle(e.title)}if(void 0!==e.hidden){if("boolean"!=typeof e.hidden)throw new Error("Optional brick property 'hidden' is expected to be of type 'boolean'");s.setHidden(e.hidden)}if(void 0!==e.reverse){if("function"!=typeof s.setReverse)throw new Error("Optional brick property 'reverse' can only be set on encoder bricks");if("boolean"!=typeof e.reverse)throw new Error("Optional brick property 'reverse' is expected to be of type 'boolean'");s.setReverse(e.reverse)}return void 0!==e.settings&&s.getSettingsForm().extract(e.settings),s}}class H extends k{constructor(){super(),this._$encodeAction=null,this._$decodeAction=null}render(){const e=super.render();return e.classList.add("encoder"),e}renderHeader(){this._$encodeAction=s.createElement("a",{className:"brick__action brick__action--active",href:"#",onClick:this.actionDidClick.bind(this,"encode"),draggable:!1},"Encode"),this._$decodeAction=s.createElement("a",{className:"brick__action",href:"#",onClick:this.actionDidClick.bind(this,"decode"),draggable:!1},"Decode");const e=s.createElement("ul",{className:"brick__actions"},[s.createElement("li",{className:"brick__action-item"},this._$encodeAction),s.createElement("li",{className:"brick__action-item"},this._$decodeAction)]),t=super.renderHeader();return t.insertBefore(e,t.firstChild),t}renderContent(){return null}actionDidClick(e,t){t.preventDefault();const i="decode"===e;this.getModel().isReverse()!==i&&this.getModel().viewDidReverse(this)}update(){const e=this.getModel().isReverse();e?(this._$encodeAction.classList.remove("brick__action--active"),this._$decodeAction&&this._$decodeAction.classList.add("brick__action--active")):(this._$encodeAction.classList.add("brick__action--active"),this._$decodeAction&&this._$decodeAction.classList.remove("brick__action--active"));const t=this.getModel().getLastError(),i=this.getModel().getLastTranslationMeta();if(null!==i){const t=i.isEncode?"forward":"backward";let s=(i.isEncode!==e?"Encoded":"Decoded")+" ";return null!==i.charCount?s+=`${i.charCount} `+(1===i.charCount?"char":"chars"):s+=`${i.byteCount} `+(1===i.byteCount?"byte":"bytes"),this.updateStatus(t,s)}return null!==t?this.updateStatus("error",t.message):this}}class G{static mod(e,t){let i=e%(t=t<0?-t:t);return i<0?i+t:i}static div(e,t){return Math.floor(e/t)}static isCoprime(e,t){return 1===G.gcd(e,t)}static gcd(e,t){for(;0!==t;){let i=e%t;e=t,t=i}return e}static xgcd(e,t){if(0===t)return[1,0,e];{let[i,s,n]=G.xgcd(t,e%t);return[s,i-s*G.div(e,t),n]}}static time(){return"undefined"!=typeof window&&void 0!==window.performance?window.performance.now():"undefined"!=typeof process?process.hrtime()[1]/1e6:parseFloat((new Date).getTime())}}class K extends W{constructor(){super(),this._viewPrototype=H,this._reverse=!1,this._encodeOnly=!1,this._lastError=null,this._lastTranslationMeta=null}async encode(e){return this.translate(e,!0)}async decode(e){return this.translate(e,!1)}async translate(e,t){try{const i=G.time();if(t===this._reverse&&this.isEncodeOnly())throw new u(`Decoding is not defined in brick '${this.getMeta().title}'`);const s=this.getSettingsForm().getInvalidFields();if(s.length>0)throw new u(`Can't ${t?"encode":"decode"} with invalid settings: `+s.map(e=>e.getLabel()+" ("+(e.getMessage()||"none")+")").join(", "));return e=w.wrap(e),t!==this._reverse?(e=w.wrap(await this.willEncode(e)),e=w.wrap(await this.performEncode(e)),e=w.wrap(await this.didEncode(e))):(e=w.wrap(await this.willDecode(e)),e=w.wrap(await this.performDecode(e)),e=w.wrap(await this.didDecode(e))),this._lastError=null,this._lastTranslationMeta={isEncode:t,duration:G.time()-i,byteCount:e.needsByteEncoding()?null:e.getSize(),charCount:e.needsTextEncoding()?null:e.getLength()},this.updateView(),e}catch(e){throw this._lastError=e,this._lastTranslationMeta=null,this.updateView(),e}}isReverse(){return this._reverse}setReverse(e){return this._reverse!==e&&(this._reverse=e,this.updateView(),this.hasPipe()&&this.getPipe().encoderDidReverse(this,e)),this}isEncodeOnly(){return this._encodeOnly}setEncodeOnly(e){return this._encodeOnly=e,this}getLastError(){return this._lastError}getLastTranslationMeta(){return this._lastTranslationMeta}serialize(){const e=super.serialize();return this.isReverse()&&(e.reverse=!0),e}copy(){const e=super.copy();return e.setReverse(this.isReverse()),e}willEncode(e){return this.willTranslate(e,!0)}performEncode(e){return this.performTranslate(e,!0)}didEncode(e){return this.didTranslate(e,!0)}willDecode(e){return this.willTranslate(e,!1)}performDecode(e){return this.performTranslate(e,!1)}didDecode(e){return this.didTranslate(e,!1)}willTranslate(e,t){return e}performTranslate(e,t){return e}didTranslate(e,t){return e}viewDidReverse(e){this.setReverse(!this.isReverse()),I.trigger("encoderReverse",{encoder:this,reverse:this.isReverse()})}}class Z extends K{constructor(){super(),this._mode=0,this.registerSeparatorSetting()}setCharacterToBlockMode(){return this._mode=0,this}setBlockToCharacterMode(){return this._mode=1,this}registerSeparatorSetting(){return this.addSetting({name:"separator",type:"text",value:" ",minLength:1,randomizable:!1,priority:-10})}getSeparator(){return this.getSettingValue("separator")}performEncode(e){switch(this._mode){case 0:const t=e.getCodePoints().map((t,i)=>this.performCharEncodeToBlock(t,i,e)).filter(e=>null!==e).map(w.wrap);return w.join(t,this.getSeparator());case 1:return e.split(this.getSeparator()).map((t,i,s)=>this.performBlockEncodeToChar(t,i,s,e)).filter(e=>null!==e)}}performDecode(e){switch(this._mode){case 0:return e.split(this.getSeparator()).map((t,i,s)=>this.performBlockDecodeToChar(t,i,s,e)).filter(e=>null!==e);case 1:const t=e.getCodePoints().map((t,i)=>this.performCharDecodeToBlock(t,i,e)).filter(e=>null!==e).map(w.wrap);return w.join(t,this.getSeparator())}}performCharEncodeToBlock(e,t,i){}performBlockEncodeToChar(e,t,i,s){}performCharDecodeToBlock(e,t,i){}performBlockDecodeToChar(e,t,i,s){}}const X={name:"a1z26",title:"A1Z26",category:"Ciphers",type:"encoder"},Y="abcdefghijklmnopqrstuvwxyz",J="abcdefghilmnopqrstuvz";class Q extends Z{static getMeta(){return X}constructor(){super(),this.addSettings([{name:"language",type:"enum",value:"english",elements:["english","italian","other"],labels:["English","Italian","Other"],width:6,randomizable:!1},{name:"alphabet",type:"text",value:"abcdefghijklmnopqrstuvwxyz",uniqueChars:!0,minLength:2},{name:"caseSensitivity",type:"boolean",value:!1,randomizable:!1}])}settingValueDidChange(e,t){switch(e.getName()){case"alphabet":t!=Y&&t!=J&&this.getSetting("language").setValue("other");break;case"language":"english"==t?this.getSetting("alphabet").setValue(Y):"italian"==t&&(console.log("italian"),this.getSetting("alphabet").setValue(J))}}willEncode(e){return this.getSettingValue("caseSensitivity")?e:e.toLowerCase()}performCharEncodeToBlock(e,t,i){const s=this.getSettingValue("caseSensitivity");let n=this.getSettingValue("alphabet");s||(n=n.toLowerCase());let r=n.indexOfCodePoint(e);return-1===r?null:(r+=1,r.toString())}performBlockDecodeToChar(e,t,i,s){const n=this.getSettingValue("caseSensitivity");let r=this.getSettingValue("alphabet");n||(r=r.toLowerCase());const a=parseInt(e);if(isNaN(a)||a<1||a>r.getLength())return null;return r.getCodePointAt(a-1)}}const ee={name:"polybius-square",title:"Polybius square",category:"Polybius square ciphers",type:"encoder"};class te extends K{static getMeta(){return ee}constructor(){super(),this.addSettings([{name:"alphabet",type:"text",value:"abcdefghiklmnopqrstuvwxyz",uniqueChars:!0,minLength:2,validateValue:this.validateAlphabetValue.bind(this),caseSensitivity:!1},{name:"rows",type:"text",value:"12345",uniqueChars:!0,minLength:2,width:6,randomizable:!1,caseSensitivity:!1},{name:"columns",type:"text",value:"12345",uniqueChars:!0,minLength:2,width:6,randomizable:!1,caseSensitivity:!1},{name:"separator",type:"text",value:"",randomizable:!1,caseSensitivity:!1,validateValue:this.validateSeparatorValue.bind(this)},{name:"caseSensitivity",type:"boolean",width:6,value:!1,randomizable:!1},{name:"includeForeignChars",type:"boolean",label:"Foreign Chars",width:6,value:!1,randomizable:!1,trueLabel:"Include",falseLabel:"Ignore"}])}willTranslate(e,t){return this.getSettingValue("caseSensitivity")?e:e.toLowerCase()}performEncode(e){const t=this.getSettingValue("alphabet").getCodePoints(),i=this.getSettingValue("separator").getCodePoints(),s=this.getSettingValue("includeForeignChars"),n=this.getSettingValue("rows").getCodePoints(),r=this.getSettingValue("columns").getCodePoints(),a=r.length,l=e.getCodePoints(),o=i.length,h=l.length,c=new Array(h*(o+2));let d,u,g,p=0,m=!1;for(let e=0;e<h;e++){if(d=l[e],u=t.indexOf(d),p>0&&(-1!==u||s&&!m))for(g=0;g<o;g++)c[p++]=i[g];m=!1,-1!==u?(c[p++]=n[Math.floor(u/a)],c[p++]=r[u%a]):s&&(c[p++]=d,m=!0)}return c.slice(0,p)}performDecode(e){const t=this.getSettingValue("alphabet").getCodePoints(),i=this.getSettingValue("separator").getCodePoints(),s=this.getSettingValue("includeForeignChars"),n=this.getSettingValue("rows").getCodePoints(),r=this.getSettingValue("columns").getCodePoints(),a=o.replaceSlice(e.getCodePoints(),i),l=t.length,h=r.length,c=a.length,d=new Array(c);let g,p,m,b=0,f=0;for(;b<c;){for(g=null;null===g&&b<c;)m=n.indexOf(a[b]),-1!==m?g=m:s&&(d[f++]=a[b]),b++;for(p=null;null===p&&b<c;)m=n.indexOf(a[b]),-1!==m?p=m:s&&(d[f++]=a[b]),b++;if(null!==g&&null!==p){if(m=g*h+p,m>=l)throw new u(`Polybius square cell at coordinates ${g},${p} are not defined by the alphabet.`);d[f++]=t[m]}else if(null!==g||null!==p)throw new u("Reached unexpected end of content. The last set of Polybius square coordinates is incomplete.")}return d.slice(0,f)}settingValueDidChange(e,t){switch(e.getName()){case"caseSensitivity":this.getSetting("alphabet").setCaseSensitivity(t),this.getSetting("rows").setCaseSensitivity(t),this.getSetting("columns").setCaseSensitivity(t),this.getSetting("separator").setCaseSensitivity(t);break;case"columns":case"rows":this.getSetting("alphabet").revalidateValue()}}validateAlphabetValue(e,t){const i=e.getLength(),s=this.getSettingValue("columns").getLength(),n=this.getSettingValue("rows").getLength();return i>n*s?{key:"polybiusSquareAlphabetTooLong",message:`The alphabet size ${i} is too big for the given ${n}×${s} Polybius square defined by the settings 'columns' and 'rows'.`}:!(i<=(n-1)*s)||{key:"polybiusSquareAlphabetTooShort",message:`The alphabet size ${i} is too short for the given ${n}×${s} Polybius square defined by the settings 'columns' and 'rows'.`}}validateSeparatorValue(e,t){const i=this.getSettingValue("rows").getCodePoints();i.concat(this.getSettingValue("columns").getCodePoints());return!(void 0!==e.getCodePoints().find(e=>-1!==i.indexOf(e)))||{key:"polybiusSquareSeparatorInvalid",message:"The separator shall not contain characters from the Polybius square rows or columns"}}}const ie={name:"adfgx-cipher",title:"ADFGX cipher",category:"Polybius square ciphers",type:"encoder"},se="adfgx",ne=[{name:"adfgx",label:"ADFGX",squarePositions:"adfgx",alphabet:"zyxwvutsrqponmlkihgfedcba"},{name:"adfgvx",label:"ADFGVX",squarePositions:"adfgvx",alphabet:"9876543210zyxwvutsrqponmlkjihgfedcba"}],re="abcdefghiklmnopqrstuvwxyz";class ae extends K{static getMeta(){return ie}constructor(){super(),this.addSettings([{name:"variant",type:"enum",value:se,elements:ne.map(e=>e.name),labels:ne.map(e=>e.label),randomizable:!1},{name:"alphabet",type:"text",value:re,uniqueChars:!0,blacklistChars:" ",minLength:0,maxLength:25,caseSensitivity:!1},{name:"key",type:"text",value:"cargo",minLength:2,maxLength:24,caseSensitivity:!1}]);const e=this.constructor.getVariant(se);this._polybiusSquare=new te,this._polybiusSquare.setSettingValues({alphabet:re,rows:e.squarePositions,columns:e.squarePositions,separator:"",caseSensitivity:!1,includeForeignChars:!1})}async performEncode(e){let t=e.getString();"adfgx"===this.getSettingValue("variant")&&(t=t.replace(/j/gi,"i"));const i=this.getSettingValue("key"),s=i.getLength(),n=this.mapElementsToSortedPosition(i.getChars()),r=await this._polybiusSquare.encode(t),a=r.getLength(),l=new Array(a+s);let h,c,d,u,g=0;for(h=0;h<s;h++)for(c=n[h],d=0;d*s+c<a;d++)u=d*s+c,l[g++]=r.getCodePointAt(u);return o.joinSlices(o.chunk(l.slice(0,g),5),[32])}performDecode(e){const t=this.getSettingValue("variant"),i=this.constructor.getVariant(t),s=w.wrap(i.squarePositions).getCodePoints(),n=e.getCodePoints().filter(e=>-1!==s.indexOf(e)),r=n.length,a=this.getSettingValue("key"),l=a.getLength(),o=this.mapElementsToSortedPosition(a.getChars());let h=r%l||l,c=Math.ceil(r/l);const d=new Array(r);let u,g,p,m,b=0;for(u=0;u<l;u++)for(g=o[u],m=g>=h?c-1:c,p=0;p<m;p++)d[p*l+g]=n[b++];return this._polybiusSquare.decode(d)}mapElementsToSortedPosition(e){const t=e.length,i=new Array(t);let s,n=e.slice(),r=e.slice().sort();for(let e=0;e<t;e++)s=n.indexOf(r[e]),i[e]=s,delete n[s];return i}settingValueDidChange(e,t){switch(e.getName()){case"variant":{const e=this.constructor.getVariant(t);this._polybiusSquare.setSettingValues({rows:e.squarePositions,columns:e.squarePositions});const i=this.getSetting("alphabet");i.isValid()&&this._polybiusSquare.setSettingValue("alphabet",i.getValue().extend(e.alphabet)),this.getSetting("alphabet").setMaxLength(e.alphabet.length),this.getSetting("key").setMaxLength(e.alphabet.length-1);break}case"alphabet":{const e=this.constructor.getVariant(this.getSettingValue("variant"));this._polybiusSquare.setSettingValue("alphabet",t.extend(e.alphabet));break}}}static getVariant(e){return ne.find(t=>t.name===e)||null}}const le={name:"affine-cipher",title:"Affine cipher",category:"Ciphers",type:"encoder"},oe="abcdefghijklmnopqrstuvwxyz",he="abcdefghilmnopqrstuvz",ce=oe;class de extends K{static getMeta(){return le}constructor(){super(),this.addSettings([{name:"a",type:"number",label:"Slope / a",value:5,integer:!0,min:1,validateValue:this.validateSlopeValue.bind(this),randomizeValue:this.randomizeSlopeValue.bind(this),width:6},{name:"b",type:"number",label:"Intercept / b",value:8,integer:!0,min:1,randomizeValue:this.randomizeInterceptValue.bind(this),width:6},{name:"language",type:"enum",value:"english",elements:["english","italian","other"],labels:["English","Italian","Other"],width:6,randomizable:!1},{name:"alphabet",type:"text",value:ce,uniqueChars:!0,minLength:2,randomizable:!1,caseSensitivity:!1},{name:"caseStrategy",type:"enum",value:"maintain",elements:["maintain","ignore","strict"],labels:["Maintain case","Ignore case","Strict (A ≠ a)"],width:6,randomizable:!1},{name:"includeForeignChars",type:"boolean",label:"Foreign Chars",value:!0,width:6,trueLabel:"Include",falseLabel:"Ignore",randomizable:!1}])}performTranslate(e,t){const{a:i,b:s,caseStrategy:n,includeForeignChars:r}=this.getSettingValues();let a,l=this.getSettingValue("alphabet");"strict"!==n&&(l=l.toLowerCase(),a=l.toUpperCase());const o=l.getLength(),h=e.getLength(),c=new Array(h).fill(0);let d,u,g,p,m,b,f=0;for(g=0;g<h;g++)d=e.getCodePointAt(g),m=l.indexOfCodePoint(d),u=!1,-1===m&&"strict"!==n&&(m=a.indexOfCodePoint(d),u=!0),-1===m?r&&(c[f++]=d):(t?b=G.mod(i*m+s,o):(p=G.xgcd(i,o)[0],b=G.mod(p*(m-s),o)),c[f++]="maintain"===n&&u?a.getCodePointAt(b):l.getCodePointAt(b));return c.slice(0,f)}settingValueDidChange(e,t){switch(e.getName()){case"alphabet":this.getSetting("a").revalidateValue(),t!=oe&&t!=he&&this.getSetting("language").setValue("other");break;case"caseStrategy":this.getSetting("alphabet").setCaseSensitivity("strict"===t);break;case"language":"english"==t?this.getSetting("alphabet").setValue(oe):"italian"==t&&(console.log("italian"),this.getSetting("alphabet").setValue(he))}}validateSlopeValue(e){const t=this.getSetting("alphabet");if(!t.isValid())return!1;const i=t.getValue().getLength();return!!G.isCoprime(e,i)||{key:"affineCipherFunctionInvalid",message:`The value must be chosen such that it is coprime to the size of the alphabet (${i})`}}randomizeSlopeValue(e,t){const i=this.getSetting("alphabet");if(i.isValid()){const t=i.getValue(),s=t.getLength(),n=t.getCodePoints().map((e,t)=>t+1).filter(e=>e>1&&G.isCoprime(e,s));return n.length>0?e.nextChoice(n):1}return null}randomizeInterceptValue(e,t){if(this.getSetting("alphabet").isValid()){const t=this.getSetting("alphabet").getValue().getLength();return e.nextInteger(1,t-1)}return null}}const ue={name:"alphabetical-substitution",title:"Atbash/Generic substitution",category:"Ciphers",type:"encoder"},ge="abcdefghijklmnopqrstuvwxyz",pe="abcdefghilmnopqrstuvz",me=ge;class be extends K{static getMeta(){return ue}constructor(){super(),this.addSettings([{name:"plaintextLanguage",type:"enum",value:"english",elements:["english","italian","other"],labels:["English","Italian","Other"],randomizable:!1},{name:"plaintextAlphabet",type:"text",value:me,uniqueChars:!0,minLength:2,caseSensitivity:!1,randomizable:!1},{name:"ciphertextAlphabet",type:"text",value:"zyxwvutsrqponmlkjihgfedcba",uniqueChars:!0,minLength:0,caseSensitivity:!1,validateValue:this.validateCiphertextValue.bind(this),randomizeValue:this.randomizeCiphertextValue.bind(this)},{name:"caseStrategy",type:"enum",value:"maintain",elements:["maintain","ignore","strict"],labels:["Maintain case","Ignore case","Strict (A ≠ a)"],width:6,randomizable:!1},{name:"includeForeignChars",type:"boolean",label:"Foreign Chars",value:!0,trueLabel:"Include",falseLabel:"Ignore",width:6,randomizable:!1}])}performTranslate(e,t){const i=this.getSettingValue("caseStrategy"),s=this.getSettingValue("includeForeignChars");let n,r,a=this.getSettingValue("plaintextAlphabet"),l=this.getSettingValue("ciphertextAlphabet").extend(a);t||([l,a]=[a,l]),"strict"!==i&&(a=a.toLowerCase(),l=l.toLowerCase(),n=a.toUpperCase(),r=l.toUpperCase());const o=e.getCodePoints(),h=new Array(o.length).fill(0);let c,d,u,g=0;for(let e=0;e<o.length;e++)c=o[e],d=a.indexOfCodePoint(c),u=!1,-1===d&&"strict"!==i&&(d=n.indexOfCodePoint(c),u=!0),-1!==d?h[g++]="maintain"===i&&u?r.getCodePointAt(d):l.getCodePointAt(d):s&&(h[g++]=c);return h.slice(0,g)}settingValueDidChange(e,t){switch(e.getName()){case"plaintextAlphabet":t!=ge&&t!=pe&&this.getSetting("plaintextLanguage").setValue("other"),this.getSetting("ciphertextAlphabet").setValue(t.split("").reverse().join(""));break;case"plaintextLanguage":"english"==t?this.getSetting("plaintextAlphabet").setValue(ge):"italian"==t&&this.getSetting("plaintextAlphabet").setValue(pe);break;case"caseStrategy":this.getSetting("plaintextAlphabet").setCaseSensitivity("strict"===t),this.getSetting("ciphertextAlphabet").setCaseSensitivity("strict"===t)}}validateCiphertextValue(e,t){if(!this.isSettingValid("plaintextAlphabet"))return!1;const i=this.getSettingValue("plaintextAlphabet");return!(e.getLength()>i.getLength())||{key:"alphabetContainsUnusedCharacters",message:"The ciphertext alphabet is longer than the plaintext alphabet"}}randomizeCiphertextValue(e,t){if(!this.getSetting("plaintextAlphabet").isValid())return null;const i=this.getSettingValue("plaintextAlphabet");return w.wrap(o.shuffle(i.getCodePoints()))}}const fe={name:"ascii85",title:"Ascii85",category:"Encoding",type:"encoder"},ye=[{name:"original",label:"Original",alphabet:null,zeroTupleChar:"z"},{name:"Z85",label:"Z85 (ZeroMQ)",alphabet:"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ.-:+=^!/*?&<>()[]{}@%$#",zeroTupleChar:null}];class _e extends K{static getMeta(){return fe}constructor(){super(),this.addSetting({name:"variant",type:"enum",label:"Variant",value:"original",elements:ye.map(e=>e.name),labels:ye.map(e=>e.label),randomizable:!1})}performEncode(e){const t=e.getBytes(),i=ye.find(e=>e.name===this.getSettingValue("variant")),s=t.length;let n,r,a,l="";for(let e=0;e<s;e+=4)if(a=(t[e]<<24)+((t[e+1]||0)<<16)+((t[e+2]||0)<<8)+(t[e+3]||0)>>>0,null===i.zeroTupleChar||a>0){for(n=[],r=0;r<5;r++)n.push(a%85),a=Math.floor(a/85);n=n.reverse(),s<e+4&&n.splice(s-(e+4),4),l+=n.map(e=>null===i.alphabet?String.fromCharCode(e+33):i.alphabet[e]).join("")}else l+=i.zeroTupleChar;return l}willDecode(e){const t=e.getString().match(/<~(.+?)~>/);return null!==t?t[1]:e}performDecode(e){const t=c.removeWhitespaces(e.getString()),i=ye.find(e=>e.name===this.getSettingValue("variant")),s=t.length,n=[];let r,a,l,o=0;for(;o<s;)t[o]===i.zeroTupleChar?(n.push(0,0,0,0),o++):(r=t.substr(o,5).split("").map((e,t)=>{const s=null===i.alphabet?e.charCodeAt(0)-33:i.alphabet.indexOf(e);if(s<0||s>84)throw new u(`Invalid character '${e}' at index ${t}`);return s}),a=52200625*r[0]+614125*r[1]+7225*(o+2<s?r[2]:84)+85*(o+3<s?r[3]:84)+(o+4<s?r[4]:84),l=[a>>24&255,a>>16&255,a>>8&255,255&a],s<o+5&&l.splice(s-(o+5),5),n.push.apply(n,l),o+=5);return new Uint8Array(n)}}const we={name:"bacon-cipher",title:"Bacon cipher",category:"Ciphers",type:"encoder"},ve=[{name:"original",label:"Original",alphabet:"abcdefghijklmnopqrstuvwxyz",codeAlphabet:"aaaaaaaaabaaabaaaabbaabaaaababaabbaaabbbabaaaabaaaabaabababaababbabbaaabbababbbaabbbbbaaaabaaabbaababaabbbaabbbabaabababbabbababbb"},{name:"unique",label:"Unique codes for each letter",alphabet:"abcdefghijklmnopqrstuvwxyz",codeAlphabet:"aaaaaaaaabaaabaaaabbaabaaaababaabbaaabbbabaaaabaabababaababbabbaaabbababbbaabbbbbaaaabaaabbaababaabbbabaabababbabbababbbbbaaabbaab"}];class Se extends K{static getMeta(){return we}constructor(){super(),this.addSettings([{name:"variant",type:"enum",label:"Variant",value:"original",elements:ve.map(e=>e.name),labels:ve.map(e=>e.label),randomizable:!1},{name:"aMark",label:"Letter 1",type:"text",width:6,value:"a",minLength:1,maxLength:1,randomizable:!1,validateValue:this.validateLetterSettingValue.bind(this)},{name:"bMark",label:"Letter 2",type:"text",width:6,value:"b",minLength:1,maxLength:1,randomizable:!1,validateValue:this.validateLetterSettingValue.bind(this)}])}validateLetterSettingValue(e,t){const i=this.getSetting("aMark"===t.getName()?"bMark":"aMark");return i.isValid()&&!e.isEqualTo(i.getValue())}performEncode(e){const{alphabet:t,codes:i,codeLength:s}=this._getVariant(),n=this.getSettingValue("aMark").getCharAt(0),r=this.getSettingValue("bMark").getCharAt(0),a=e.toLowerCase();let l,h="";for(let e=0;e<a.getLength();e++)l=t.indexOf(a.getCharAt(e)),-1!==l&&(h+=i[l]);return"a"===n&&"b"===r||(h=h.split("").map(e=>"a"===e?n:r).join("")),o.chunk(w.wrap(h).getChars(),s).map(e=>e.join("")).join(" ")}performDecode(e){const{alphabet:t,codes:i,codeLength:s}=this._getVariant(),n=this.getSettingValue("aMark").getCodePointAt(0),r=this.getSettingValue("bMark").getCodePointAt(0),a=e.getCodePoints();let l,o="";for(l=0;l<a.length;l++)switch(a[l]){case n:o+="a";break;case r:o+="b"}const h=c.chunk(o,s);let d,u="";for(l=0;l<h.length;l++)d=i.indexOf(h[l]),-1!==d&&(u+=t[d]);return u}_getVariant(){const e=this.getSettingValue("variant"),{alphabet:t,codeAlphabet:i}=ve.find(t=>t.name===e),s=i.length/t.length;return{alphabet:t,codes:c.chunk(i,s),codeLength:s}}}const Ce={name:"base32",title:"Base32",category:"Encoding",type:"encoder"},Ve=[{name:"base32",label:"Base32 (RFC 3548, RFC 4648)",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",padding:61,decodeMap:{48:14,49:8}},{name:"base32hex",label:"Base32hex (RFC 4648)",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",padding:61},{name:"z-base-32",label:"z-base-32",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",padding:null},{name:"crockford-base32",label:"Crockford's Base32",alphabet:"0123456789ABCDEFGHJKMNPQRSTVWXYZ",padding:null,decodeContentFilter:"uppercase",decodeMap:{79:0,73:1,76:1}},{name:"custom",label:"Custom"}];class ke extends K{static getMeta(){return Ce}constructor(){super(),this.addSettings([{name:"variant",type:"enum",value:Ve[0].name,elements:Ve.map(e=>e.name),labels:Ve.map(e=>e.label),randomizable:!1},{name:"alphabet",type:"text",value:Ve[0].alphabet,uniqueChars:!0,minLength:32,maxLength:32,caseSensitivity:!0,visible:!1},{name:"padding",type:"text",value:"=",blacklistChars:Ve[0].alphabet,minLength:0,maxLength:1,randomizable:!1,visible:!1}])}performEncode(e){const{alphabet:t,padding:i}=this.getVariantOptions(),s=t.getCodePoints(),n=e.getBytes(),r=n.length,a=8*Math.ceil(r/5),l=new Array(a);let o,h,c=0,d=3,u=0;for(let e=0;e<r;e++)o=n[e],h=u|o>>d,l[c++]=s[31&h],d>5&&(d-=5,h=o>>d,l[c++]=s[31&h]),d=5-d,u=o<<d,d=8-d;if(3!==d&&(l[c++]=s[31&u]),null!==i){for(;c<a;)l[c++]=i;return l}return l.slice(0,c)}performDecode(e){const{alphabet:t,decodeMap:i,padding:s,decodeContentFilter:n}=this.getVariantOptions();"uppercase"===n&&(e=e.toUpperCase());for(let e=0;e<t.getLength();e++)i[t.getCodePointAt(e)]=e;const r=e.getCodePoints(),a=r.length,l=5*Math.ceil(a/8),o=new Uint8Array(l);let h,c,d=0,g=8,p=0;for(let e=0;e<a;e++)if(h=r[e],h===s);else{if(void 0===i[h])throw new u(`Unexpected code point at index ${e}`);c=255&i[h],g-=5,g>0?p|=c<<g:g<0?(o[d++]=p|c>>-g,g+=8,p=c<<g&255):(o[d++]=p|c,g=8,p=0)}return o.slice(0,d)}settingValueDidChange(e,t){switch(e.getName()){case"variant":this.getSetting("alphabet").setVisible("custom"===t),this.getSetting("padding").setVisible("custom"===t);break;case"alphabet":this.getSetting("padding").setBlacklistChars(t)}}getVariantOptions(){const e=this.getSettingValue("variant");if("custom"===e){const e=this.getSettingValue("padding");return{alphabet:this.getSettingValue("alphabet"),padding:1===e.getLength()?e.getCodePointAt(0):null,decodeContentFilter:null,decodeMap:{}}}const t=Ve.find(t=>t.name===e);return t.alphabet=w.wrap(t.alphabet),t.decodeMap=t.decodeMap||{},t}}const xe={name:"base64",title:"Base64",category:"Encoding",type:"encoder"},Ie="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",Ee=[{name:"base64",label:"Base64 (RFC 3548, RFC 4648)",description:null,alphabet:`${Ie}+/`},{name:"base64url",label:"Base64url (RFC 4648 §5)",description:"URL and Filename Safe Alphabet",alphabet:`${Ie}-_`,paddingOptional:!0},{name:"rfc2045",label:"Transfer encoding for MIME (RFC 2045)",description:null,alphabet:`${Ie}+/`,foreignCharacters:!0,maxLineLength:76},{name:"rfc1421",label:"Original Base64 (RFC 1421)",description:"Privacy-Enhanced Mail (PEM)",alphabet:`${Ie}+/`,maxLineLength:64},{name:"custom",label:"Custom"}];class Me extends K{static getMeta(){return xe}constructor(){super(),this.addSettings([{name:"variant",type:"enum",value:Ee[0].name,elements:Ee.map(e=>e.name),labels:Ee.map(e=>e.label),descriptions:Ee.map(e=>e.description),randomizable:!1},{name:"alphabet",type:"text",value:Ee[0].alphabet,uniqueChars:!0,minLength:64,maxLength:64,caseSensitivity:!0,visible:!1},{name:"padding",type:"text",value:"=",blacklistChars:Ee[0].alphabet,minLength:1,maxLength:1,randomizable:!1,visible:!1,width:6},{name:"paddingOptional",type:"boolean",value:!1,randomizable:!1,visible:!1,width:6}])}performEncode(e){return m.base64StringFromBytes(e.getBytes(),this.getVariantOptions())}performDecode(e){return m.bytesFromBase64String(e.getString(),this.getVariantOptions())}settingValueDidChange(e,t){switch(e.getName()){case"variant":this.getSetting("alphabet").setVisible("custom"===t),this.getSetting("padding").setVisible("custom"===t),this.getSetting("paddingOptional").setVisible("custom"===t);break;case"alphabet":this.getSetting("padding").setBlacklistChars(t)}}getVariantOptions(){const e=this.getSettingValue("variant");return"custom"===e?{alphabet:this.getSettingValue("alphabet").getString(),padding:this.getSettingValue("padding").getCharAt(0),paddingOptional:this.getSettingValue("paddingOptional")}:Ee.find(t=>t.name===e)}}const Be={name:"baudot-code",title:"Baudot code",category:"Encoding",type:"encoder"},ze=[{name:"ita1",label:"Original Baudot - ITA 1",characterSet:[0,"A","E","\r","Y","U","I","O","FS","J","G","H","B","C","F","D"," ","\n","X","Z","S","T","W","V",127,"K","M","L","R","Q","N","P",0,"1","2","\r","3","4",null,"5"," ","6","7","+","8","9",null,"0","LS","\n",",",":",".",null,"?","'",127,"(",")","=","-","/",null,"%"]},{name:"original-eu",label:"Original Baudot - Continental European",extends:"ita1",overrides:{3:"É",17:"T",35:"&",38:"º",43:"h",46:"f",49:".",52:";",53:"!",62:"№"}},{name:"original-uk",label:"Original Baudot - Domestic UK",extends:"ita1",overrides:{3:"/",18:"-",35:"⅟",38:"³",43:"¹",46:"⁵",49:".",50:"⁹",52:"⁷",53:"²",62:"£",63:"+"}},{name:"ita2",label:"Baudot-Murray - ITA 2",characterSet:[0,"E","\n","A"," ","S","I","U","\r","D","R","J","N","F","C","K","T","Z","L","W","H","Y","P","Q","O","B","G","FS","M","X","V",15,0,"3","\n","-"," ","'","8","7","\r",5,"4",7,",","!",":","(","5","+",")","2","£","6","0","1","9","?","&",14,".","/","=","LS"]},{name:"us-tty",label:"Baudot-Murray - US-TTY",extends:"ita2",overrides:{37:"'",41:5,43:7,49:"+",52:"£",62:"="}},{name:"murray-code",label:"Baudot-Murray - Murray Code",extends:"ita2",overrides:{0:" ",2:null,4:15,8:"\n",31:"*",32:" ",34:null,35:null,36:"LS",40:"\n",41:"²",43:"⁷",44:"-",45:"⅟",46:"(",47:"⁹",49:".",50:"/",52:"⁵",58:"³",60:",",61:"£",62:")",63:"*"}}];class Le extends K{static getMeta(){return Be}constructor(){super(),this._variantCharacterSet=[],this.addSetting({name:"variant",type:"enum",value:"ita2",elements:ze.map(e=>e.name),labels:ze.map(e=>e.label),randomizable:!1})}performEncode(e){const t=this.getSettingValue("variant"),i=this.getVariantCharacterSet(t),s=i.indexOf("FS")%32,n=i.indexOf("LS")%32,r=e.getCodePoints(),a=r.length;let l,h,c=[],d=!1;for(let e=0;e<a;e++)h=r[e],l=i.indexOf(h),-1===l&&h>=97&&h<=122&&(l=i.indexOf(h-32)),l>=0&&l<32?(d&&(c.push(n),d=!1),c.push(l)):l>=32&&(d||(c.push(s),d=!0),c.push(l-32));return o.resizeBitSizedArray(c,5,8)}performDecode(e){const t=this.getSettingValue("variant"),i=this.getVariantCharacterSet(t),s=i.indexOf("FS")%32,n=i.indexOf("LS")%32,r=o.resizeBitSizedArray(e.getBytes(),8,5,!0);let a,l,h=new Array(r.length),c=!1,d=0;for(let e=0;e<r.length;e++)a=r[e],c||a!==s?c&&a===n?c=!1:(l=i[a+(c?32:0)],null!==l&&(h[d++]=l)):c=!0;return h.slice(0,d)}getVariantCharacterSet(e){if(void 0!==this._variantCharacterSet[e])return this._variantCharacterSet[e];const t=ze.find(t=>t.name===e);if(void 0===t)return null;let i=(t.characterSet||[]).slice();if(t.extends){const e=this.getVariantCharacterSet(t.extends);null!==e&&(i=e.slice())}if(t.overrides)for(let e in t.overrides)i[e]=t.overrides[e];for(let e=0;e<i.length;e++){let t=i[e];"FS"!==t&&"LS"!==t&&null!==t&&(i[e]="string"==typeof t?f.codePointsFromString(t)[0]:t)}return this._variantCharacterSet[e]=i,i}}const Te={name:"bifid-cipher",title:"Bifid cipher",category:"Polybius square ciphers",type:"encoder"},Ae="abcdefghiklmnopqrstuvwxyz";class Pe extends K{static getMeta(){return Te}constructor(){super(),this.addSetting({name:"key",type:"text",value:"",uniqueChars:!0,minLength:0,caseSensitivity:!1}),this._polybiusSquare=new te,this._polybiusSquare.setSettingValues({alphabet:Ae,rows:"12345",columns:"12345",separator:"",caseSensitivity:!1,includeForeignChars:!1})}async performEncode(e){const t=await this._polybiusSquare.encode(e.getString().replace(/j/gi,"i")),i=t.getLength(),s=new Array(i);for(let e=0;e<i/2;e++)s[e]=t.getCodePointAt(2*e),s[i/2+e]=t.getCodePointAt(2*e+1);return this._polybiusSquare.decode(s)}async performDecode(e){const t=await this._polybiusSquare.encode(e),i=t.getLength(),s=new Array(i);for(let e=0;e<i/2;e++)s[2*e]=t.getCodePointAt(e),s[2*e+1]=t.getCodePointAt(i/2+e);return this._polybiusSquare.decode(s)}settingValueDidChange(e,t){if("key"===e.getName())this._polybiusSquare.setSettingValue("alphabet",t.extend(Ae))}}const Ne={name:"bitwise-operation",title:"Bitwise operation",category:"Transform",type:"encoder"},$e={NOT:"NOT",AND:"NAND",OR:"NOR",XOR:"NXOR",NAND:"AND",NOR:"OR",NXOR:"XOR"};class De extends K{static getMeta(){return Ne}constructor(){super(),this.addSettings([{name:"operation",type:"enum",value:"NOT",elements:["NOT","AND","OR","XOR","NAND","NOR","NXOR"],labels:["NOT ~a","AND (a & b)","OR (a | b)","XOR (a ^ b)","NAND ~(a & b)","NOR ~(a | b)","NXOR ~(a ^ b)"],randomizable:!1,style:"radio"},{name:"operand",label:"Operand B (Repeating)",type:"bytes",value:new Uint8Array([15]),minSize:1,visible:!1}])}performTranslate(e,t){const i=e.getBytes(),s=this.getSettingValue("operand");let n=this.getSettingValue("operation");return t||(n=$e[n]),i.map((e,t)=>this.performByteOperation(e,n,s[t%s.length]))}performByteOperation(e,t,i=0){switch(t){case"NOT":return~e;case"AND":return e&i;case"OR":return e|i;case"XOR":return e^i;case"NAND":return~(e&i);case"NOR":return~(e|i);case"NXOR":return e^~i;default:return e}}settingValueDidChange(e,t){"operation"===e.getName()&&this.getSetting("operand").setVisible("NOT"!==t)}}var Fe="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var Oe,Re=function(e,t){return e(t={exports:{}},t.exports),t.exports}(function(e,t){var i=Fe&&Fe.__spreadArrays||function(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;var s=Array(e),n=0;for(t=0;t<i;t++)for(var r=arguments[t],a=0,l=r.length;a<l;a++,n++)s[n]=r[a];return s};Object.defineProperty(t,"__esModule",{value:!0});var s=function(e,t,i){this.name=e,this.version=t,this.os=i};t.BrowserInfo=s;var n=function(e){this.version=e,this.name="node",this.os=process.platform};t.NodeInfo=n;var r=function(){this.bot=!0,this.name="bot",this.version=null,this.os=null};t.BotInfo=r;var a=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["vivaldi",/Vivaldi\/([0-9\.]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/Edg\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FBAV\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],l=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/],["Search Bot",/(nuhk)|(Googlebot)|(Yammybot)|(Openbot)|(Slurp)|(MSNBot)|(Ask Jeeves\/Teoma)|(ia_archiver)/]];function o(e){var t=""!==e&&a.reduce(function(t,i){var s=i[0],n=i[1];if(t)return t;var r=n.exec(e);return!!r&&[s,r]},!1);if(!t)return null;var n=t[0],l=t[1];if("searchbot"===n)return new r;var o=l[1]&&l[1].split(/[._]/).slice(0,3);return o?o.length<3&&(o=i(o,function(e){for(var t=[],i=0;i<e;i++)t.push("0");return t}(3-o.length))):o=[],new s(n,o.join("."),h(e))}function h(e){for(var t=0,i=l.length;t<i;t++){var s=l[t],n=s[0];if(s[1].test(e))return n}return null}function c(){return"undefined"!=typeof process&&process.version?new n(process.version.slice(1)):null}t.detect=function(e){return e?o(e):"undefined"!=typeof navigator?o(navigator.userAgent):c()},t.parseUserAgent=o,t.detectOS=h,t.getNodeVersion=c});(Oe=Re)&&Oe.__esModule&&Object.prototype.hasOwnProperty.call(Oe,"default")&&Oe.default;Re.BrowserInfo,Re.NodeInfo,Re.BotInfo;var qe=Re.detect;Re.parseUserAgent,Re.detectOS,Re.getNodeVersion;let Ue=null;class je{static identify(){return null===Ue&&(Ue=qe()||!1),Ue}static match(...e){const t=je.identify();if(!1===t)return!1;const i=/([a-zA-Z0-9-]+)(?:([<>=]+)([0-9.]+))?/;return void 0!==e.find(e=>{const[,s,n,r]=e.match(i);return s===t.name&&(void 0===r||this.matchVersion(t.version,n,r))})}static matchVersion(e,t,i){const s=e.split("."),n=i.split("."),r=Math.min(s.length,n.length);let a="=",l=-1;for(;"="===a&&++l<r;)s[l]=parseInt(s[l],10),n[l]=parseInt(n[l],10),a=s[l]!==n[l]?s[l]<n[l]?"<":">":"=";return"="===a&&(a=s.length!==n.length?s.length<n.length?"<":">":"="),-1!==t.indexOf(a)}static isNode(){return this.match("node")}static isBrowser(){return"undefined"!=typeof window}static placeBrowserAttribute(){if(je.isBrowser()&&!1!==je.identify()){const{name:e,version:t}=je.identify();document.documentElement.dataset.browser=`${e}/${t}`}return this}}const We={name:"block-cipher",title:"Block Cipher",category:"Modern cryptography",type:"encoder"},He=[{name:"aes-128",label:"AES-128",blockSize:16,keySize:16,browserAlgorithm:"aes",nodeAlgorithm:"aes-128"},{name:"aes-192",label:"AES-192",blockSize:16,keySize:24,browserAlgorithm:!1,nodeAlgorithm:"aes-192"},{name:"aes-256",label:"AES-256",blockSize:16,keySize:32,browserAlgorithm:"aes",nodeAlgorithm:"aes-256"}],Ge=[{name:"ecb",label:"ECB (Electronic Code Book)",hasIV:!1,browserMode:!1,nodeMode:!0},{name:"cbc",label:"CBC (Cipher Block Chaining)",hasIV:!0,browserMode:!0,nodeMode:!0},{name:"ctr",label:"CTR (Counter)",hasIV:!0,browserMode:!0,nodeMode:!0}];class Ke extends K{static getMeta(){return We}constructor(){super();const e=Ke.getAlgorithms(),t=e[0],i=Ke.getModes(),s=Ke.isPaddingAvailable();this.addSettings([{name:"algorithm",type:"enum",value:t.name,elements:e.map(e=>e.name),labels:e.map(e=>e.label),randomizable:!1,width:s?8:12},{name:"padding",type:"boolean",value:!1,randomizable:!1,width:s?4:12,visible:s},{name:"mode",type:"enum",value:"cbc",elements:i.map(e=>e.name),labels:i.map(e=>e.label),randomizable:!1},{name:"key",type:"bytes",value:new Uint8Array([43,126,21,22,40,174,210,166,171,247,21,136,9,207,79,60]),minSize:t.keySize,maxSize:t.keySize},{name:"iv",label:"IV",type:"bytes",value:new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]),minSize:t.blockSize,maxSize:t.blockSize}])}settingValueDidChange(e,t){switch(e.getName()){case"algorithm":const{keySize:e}=Ke.getAlgorithm(t);this.getSetting("key").setMinSize(e).setMaxSize(e);break;case"mode":const i=this.getSettingValue("algorithm"),{blockSize:s}=Ke.getAlgorithm(i),{hasIV:n}=Ke.getMode(t);this.getSetting("iv").setVisible(n).setMinSize(s).setMaxSize(s)}}async performTranslate(e,t){const i=e.getBytes(),{algorithm:s,mode:n,key:r,padding:a,iv:l}=this.getSettingValues();try{return await this.createCipher(s,n,r,l,a,t,i)}catch(e){throw new u(t?`${s} encryption failed`:`${s} decryption failed, this may be due to malformed content`)}}async createCipher(e,i,s,n,r,a,l){const o=Ke.getAlgorithm(e),{hasIV:h}=Ke.getMode(i);if(h||(n=new Uint8Array([])),je.isNode()){const e=o.nodeAlgorithm+"-"+i;return n=global.Buffer.from(n),l=global.Buffer.from(l),new Promise((i,o)=>{const h=a?t.createCipheriv(e,s,n):t.createDecipheriv(e,s,n);h.setAutoPadding(r);const c=Buffer.concat([h.update(l),h.final()]);i(new Uint8Array(c))})}{const e=o.browserAlgorithm+"-"+i,t=window.crypto||window.msCrypto,r=t.subtle||t.webkitSubtle,h=await r.importKey("raw",s,{name:e},!1,["encrypt","decrypt"]),c={name:e,iv:n,counter:n,length:o.blockSize};let d=a?r.encrypt(c,h,l):r.decrypt(c,h,l);return void 0!==d.oncomplete&&(d=new Promise((e,t)=>{d.oncomplete=e.bind(this,d.result),d.onerror=t})),d.then(e=>new Uint8Array(e))}}static isPaddingAvailable(){return je.isNode()}static getAlgorithm(e){return He.find(t=>t.name===e)}static getAlgorithms(){const e=je.isNode();return He.filter(t=>t.browserAlgorithm&&!e||t.nodeAlgorithm&&e)}static getMode(e){return Ge.find(t=>t.name===e)}static getModes(){const e=je.isNode();return Ge.filter(t=>t.browserMode&&!e||t.nodeMode&&e)}}const Ze={name:"punctuation-deletion",title:"Punctuation Deletion",category:"Transform",type:"encoder"};class Xe extends K{static getMeta(){return Ze}constructor(){super(),this.addSettings([{name:"illegals",type:"text",label:"To Remove,",value:"<>|!\"£$%&/()=?^\\';:_,.-*[]@#°",uniqueChars:!0,minLength:1,caseSensitivity:!0,randomizable:!1}])}performTranslate(e,t){let i=e.getString(),s=this.getSettingValue("illegals")._string,n="";for(let e=0;e<i.length;e++){let t=!0;for(let n=0;n<s.length;n++)i[e]==s[n]&&(t=!1);t&&(n+=i[e])}return new w(n).getCodePoints()}settingValueDidChange(e,t){}}const Ye={name:"space-deletion",title:"Space Deletion",category:"Transform",type:"encoder"};class Je extends K{static getMeta(){return Ye}constructor(){super()}performTranslate(e,t){let i=e.getString().replace(/ /g,function(e){return""});return new w(i).getCodePoints()}settingValueDidChange(e,t){}}const Qe={name:"book-cipher",title:"Book Cipher",category:"Ciphers",type:"encoder"};class et extends K{static getMeta(){return Qe}constructor(){super(),this.addSettings([{name:"numbers",label:"Numbers (* for 1, 2, ...)",type:"text",value:"1 11 21 31 41",minLength:0,width:8},{name:"countIn",label:"Count In",type:"enum",value:"all",elements:["all","words","rows"],labels:["All text","Words","Rows"],width:4},{name:"removeSpaces",label:"Remove Spaces",type:"boolean",value:!0,trueLabel:"Yes",falseLabel:"No",width:5},{name:"removeSymbols",label:"Remove Punctuation",type:"boolean",value:!0,trueLabel:"Yes",falseLabel:"No",width:7},{name:"apostropheUnite",label:"Apostrophe unite words",type:"boolean",value:!1,trueLabel:"No",falseLabel:"Yes",width:7},{name:"mergeContigousSpaces",label:"Merge contiguous spaces",type:"boolean",value:!1,trueLabel:"Yes",falseLabel:"No",width:7},{name:"toCount",type:"enum",value:"letters",elements:["letters","words","rows"],labels:["Letters","Words","Rows"],width:4},{name:"toReturn",type:"enum",value:"letters",elements:["letters","words"],labels:["Letters","Words"],width:4},{name:"toTake",type:"enum",value:"all",elements:["all","first","last"],labels:["All","First","Last"],width:4},{name:"separator",label:"Separated by",type:"enum",value:" ",elements:[" ","\n",",",";","/"],labels:["Space","Newline","Comma","Semicolon","Slash"]}])}performTranslate(e,t){const{toReturn:i,toCount:s,toTake:n,separator:r,countIn:a}=this.getSettingValues();if(this.getSettingValue("apostropheUnite")){let t=e.getString();t=t.replace(/'/g," "),e=new w(t)}if(this.getSettingValue("removeSymbols")){let t=new Xe;e=new w(t.performTranslate(e,!0))}if(this.getSettingValue("mergeContigousSpaces")){let t=e.getString();t=t.replace(/\s+/g," ").replace(/^ +| +$/g,""),e=new w(t)}if(this.getSettingValue("removeSpaces")){if("words"==i)throw Error("Cannot return words after having removed spaces...");if("words"==s)throw Error("Cannot count words after having removed spaces...");let t=new Je;e=new w(t.performTranslate(e,!0))}let l,o,h=e.getString();if("all"==a)l=h;else if("words"==a){h=h.replace("\n"," ").replace(" +"," ");h.split(" ")}else"rows"==a&&(countArray=h.split("\n"));let d,u=this.getSettingValue("numbers")._string;"*"===u?(d="undefined"!=typeof countArray?countArray.length:l.length,o=[...Array(d).keys()].map(e=>e+1)):(o=[],u.replace(/(\d+)/g,(e,t,i)=>{(0===i||c.isWhitespace(u,i-1))&&(u.length===i+t.length||c.isWhitespace(u,i+t.length))&&o.push(parseInt(t))})),console.log(o);let g="";for(let e=0;e<o.length;e++){if("all"!==a){if(e>=countArray.length)break;l=countArray[e]}let t;"letters"==s?t=l:"words"==s?(l=l.replace("\n"," ").replace(" +"," "),t=l.split(" ")):"rows"==s&&(t=l.split("\n"));let h,c=o[e]-1;if(c>=t.length)break;h=t[c];let d={first:0,last:-1};if("all"!==n){let e;"letters"==i?e=h:"words"==i&&(e=h.split(" ")),g+=e.slice(d[n])[0]+r}else g+=h+r}return new w(g).getCodePoints()}settingValueDidChange(e,t){}}const tt={name:"bootstring",title:"Bootstring",category:"Encoding",type:"encoder"},it="Integer overflow: Input needs wider integers to process";class st extends K{static getMeta(){return tt}constructor(){super(),this.addSettings([{name:"basicRangeStart",label:"Basic Start",type:"number",value:0,integer:!0,rotate:!1,min:0,max:125,width:6,randomizable:!1},{name:"basicRangeEnd",label:"Basic End",type:"number",value:127,integer:!0,rotate:!1,min:2,max:1114111,width:6,randomizable:!1},{name:"digitMapping",type:"text",value:"abcdefghijklmnopqrstuvwxyz0123456789",uniqueChars:!0,minLength:2,caseSensitivity:!1,validateValue:this.validateDigitMappingValue.bind(this),randomizable:!1},{name:"delimiter",type:"text",value:"-",width:6,minLength:1,maxLength:1,caseSensitivity:!1,validateValue:this.validateDelimiterValue.bind(this),randomizable:!1},{name:"caseSensitivity",type:"boolean",value:!1,width:6,randomizable:!1},{name:"initialBias",type:"number",value:72,integer:!0,width:6,validateValue:this.validateInitialBiasValue.bind(this),randomizable:!1},{name:"initialN",type:"number",value:128,integer:!0,min:0,width:6,randomizable:!1},{name:"tmin",type:"number",value:1,integer:!0,rotate:!1,min:0,max:26,width:6,randomizable:!1},{name:"tmax",type:"number",value:26,integer:!0,rotate:!1,min:0,max:35,width:6,randomizable:!1},{name:"skew",type:"number",value:38,integer:!0,min:1,width:6,randomizable:!1},{name:"damp",type:"number",value:700,integer:!0,min:2,width:6,randomizable:!1}])}performEncode(e){const{initialBias:t,initialN:i,tmin:s,tmax:n,caseSensitivity:r}=this.getSettingValues(),a=this.getSettingValue("delimiter").getCodePointAt(0),l=this.getSettingValue("digitMapping").getLength();r||(e=e.toLowerCase());const o=e.getCodePoints(),h=o.length;let c=i,d=t,g=0;const p=[];for(let e=0;e<o.length;e++)if(this._isBasic(o[e]))p.push(o[e]);else if(o[e]<c)throw new u(`Unexpected code point at index ${e}, consider changing initial n to include this code point`);let m,b,f,y,_,w=p.length,v=p.length;for(v>0&&p.push(a);w<h;){for(_ of(m=Number.MAX_SAFE_INTEGER,o))_>=c&&_<m&&!this._isBasic(_)&&(m=_);if(m-c>G.div(Number.MAX_SAFE_INTEGER-g,w+1))throw new u(it);for(_ of(g+=(m-c)*(w+1),c=m,o)){if((_<c||this._isBasic(_))&&++g>Number.MAX_SAFE_INTEGER)throw new u(it);if(_===c){for(b=g,f=l;y=this._calcT(f,d,s,n),!(b<y);f+=l)p.push(this._basicCodePointFromDigit(y+G.mod(b-y,l-y))),b=G.div(b-y,l-y);p.push(this._basicCodePointFromDigit(b)),d=this._adaptBias(g,w+1,w===v),g=0,w++}}g++,c++}return p}performDecode(e){const{initialBias:t,initialN:i,tmin:s,tmax:n,caseSensitivity:r}=this.getSettingValues(),a=this.getSettingValue("delimiter").getCodePointAt(0),l=this.getSettingValue("digitMapping").getLength();r||(e=e.toLowerCase());const o=e.getCodePoints(),h=o.length;let c=i,d=t;const g=Math.max(o.lastIndexOf(a),0),p=[];for(let e=0;e<g;e++){if(!this._isBasic(o[e]))throw new u(`Found unexpected non-basic code point at ${e}`);p.push(o[e])}let m,b,f,y,_,w=0,v=g>0?g+1:0;for(;v<h;){for(m=w,b=1,f=l;;f+=l){if(v>=h)throw new u("The input ends unexpectedly");if(y=this._digitFromBasicCodePoint(o[v++]),-1===y)throw new u("Found unexpected non-basic code point at "+(v-1));if(y>G.div(Number.MAX_SAFE_INTEGER-w,b))throw new u(it);if(w+=y*b,_=this._calcT(f,d,s,n),y<_)break;if(b>G.div(Number.MAX_SAFE_INTEGER,l-_))throw new u(it);b*=l-_}if(d=this._adaptBias(w-m,p.length+1,0===m),G.div(w,p.length+1)>Number.MAX_SAFE_INTEGER-c)throw new u(it);if(c+=G.div(w,p.length+1),w=G.mod(w,p.length+1),this._isBasic(c))throw new u("Unexpectedly unwrapped basic code point");p.splice(w,0,c),w++}return p}_adaptBias(e,t,i){const{digitMapping:s,tmin:n,tmax:r,skew:a}=this.getSettingValues(),l=s.getLength();if(i){const t=this.getSettingValue("damp");e=G.div(e,t)}else e=G.div(e,2);e+=G.div(e,t);let o=0;for(;e>G.div((l-n)*r,2);)e=G.div(e,l-n),o+=l;return o+G.div((l-n+1)*e,e+a)}_calcT(e,t,i,s){return e<=t+i?i:e>=t+s?s:e-t}_isBasic(e){const{basicRangeStart:t,basicRangeEnd:i}=this.getSettingValues();return e>=t&&e<=i}_digitFromBasicCodePoint(e){return this.getSettingValue("digitMapping").indexOfCodePoint(e)}_basicCodePointFromDigit(e){return this.getSettingValue("digitMapping").getCodePointAt(e)}settingValueDidChange(e,t){switch(e.getName()){case"basicRangeStart":this.getSetting("basicRangeEnd").setMin(e.getValue()+2),this.getSetting("digitMapping").revalidateValue(),this.getSetting("delimiter").revalidateValue();break;case"basicRangeEnd":this.getSetting("basicRangeStart").setMax(e.getValue()-2),this.getSetting("digitMapping").revalidateValue(),this.getSetting("delimiter").revalidateValue();break;case"digitMapping":const i=e.getValue().getLength();this.getSetting("tmax").setMax(i-1),this.getSetting("delimiter").revalidateValue(),this.getSetting("initialBias").revalidateValue();break;case"tmin":this.getSetting("initialBias").revalidateValue();break;case"tmax":this.getSetting("tmin").setMax(e.getValue());break;case"caseSensitivity":this.getSetting("digitMapping").setCaseSensitivity(t),this.getSetting("delimiter").setCaseSensitivity(t)}}validateDigitMappingValue(e,t){if(!this.isSettingValid("basicRangeStart","basicRangeEnd"))return!1;const i=this.getSettingValue("basicRangeStart"),s=this.getSettingValue("basicRangeEnd"),n=e.getCodePoints().findIndex(e=>e<i||e>s);return-1===n||{key:"bootstringDigitMappingInvalid",message:`Character at index ${n} needs to be part of the given basic code point range`}}validateDelimiterValue(e,t){if(!this.isSettingValid("basicRangeStart","basicRangeEnd","digitMapping"))return!1;const{basicRangeStart:i,basicRangeEnd:s,digitMapping:n}=this.getSettingValues(),r=e.getCodePointAt(0);return!(r<i||r>s||-1!==n.indexOfCodePoint(r))||{key:"bootstringDelimiterInvalid",message:"The value must be part of the basic code point range while not having a digit mapped to it"}}validateInitialBiasValue(e,t){if(!this.isSettingValid("digitMapping","tmin"))return!1;const i=this.getSettingValue("digitMapping").getLength(),s=this.getSettingValue("tmin");return!(G.mod(e,i)>i-s)||{key:"bootstringInitialBiasInvalid",message:"The value must be chosen such that initial_bias mod base <= base - tmin"}}}class nt extends k{render(){const e=super.render();return e.classList.add("viewer"),e}renderHeader(){const e=s.createElement("ul",{className:"brick__actions"},[s.createElement("li",{className:"brick__action-item"},[s.createElement("span",{className:"brick__action brick__action--active"},"View")])]),t=super.renderHeader();return t.insertBefore(e,t.firstChild),t}}class rt extends nt{constructor(){super(),this._text="",this._disabled=!1,this._$textarea=null}getText(){return this._text}setText(e){return this._text!==e&&(this._text=e,null!==this._$textarea&&(this._$textarea.value=e,this.layoutTextarea())),this}isDisabled(){return this._disabled}setDisabled(e){return this._disabled=e,null!==this._$textarea&&(e?this._$textarea.disabled="disabled":this._$textarea.removeAttribute("disabled")),this}render(){const e=super.render();return e.classList.add("viewer-text"),e}renderContent(){this._$textarea=s.createElement("textarea",{className:"viewer-text__textarea",ariaLabel:"Content",spellcheck:!1,value:this._text,onInput:this.textareaValueDidChange.bind(this),onFocus:e=>this.focus(),onBlur:e=>this.blur()}),this.isDisabled()&&(this._$textarea.disabled="disabled");const e=super.renderContent();return e.appendChild(this._$textarea),e}textareaValueDidChange(e){if(this.isDisabled())return e.preventDefault(),!1;const t=this._$textarea.value;this._text!==t&&(this._text=t,this.getModel().viewTextDidChange(this,this._text),this.layoutTextarea())}layout(){return this.layoutTextarea(),super.layout()}layoutTextarea(){return this._$textarea.style.height="",this._$textarea.style.height=`${this._$textarea.scrollHeight}px`,this}update(){const e=this.getModel().getError();return null!==e?this.updateStatus("error","Binary content can't be interpreted as text. Try switching to the bytes view. "+e.message):this.updateStatus(null)}}class at extends W{constructor(){super(),this._queuedContent=null,this._error=null}async view(e){try{let t=this.getSettingsForm().getInvalidFields();if(t.length>0)throw new u("Can't view content with invalid settings: "+t.map(e=>e.getLabel()).join(", "));if(!this.hasView())return void(this._queuedContent=e);e=await this.willView(e),await this.performView(e),await this.didView(e),null!==this._error&&(this._error=null,this.updateView())}catch(e){throw this._error=e,this.updateView(),e}}async willView(e){return e}async performView(e){}async didView(e){}async dare(e,t=!1){try{await e(),null!==this._error&&(this._error=null,this.updateView())}catch(e){if(this._error=e,this.updateView(),t||!(e instanceof u))throw e}return this}getError(){return this._error}didCreateView(e){super.didCreateView(e),null!==this._queuedContent&&(this.view(this._queuedContent),this._queuedContent=null)}contentDidChange(e){this.hasPipe()&&this.getPipe().viewerContentDidChange(this,e)}}const lt={name:"bytes",title:"Bytes",category:"View",type:"viewer"};class ot extends at{static getMeta(){return lt}constructor(){super(),this._viewPrototype=rt,this.addSettings([{name:"format",type:"enum",width:6,value:"hexadecimal",elements:["hexadecimal","binary"],labels:["Hexadecimal","Binary"],randomizable:!1},{name:"groupBits",label:"Group by",type:"enum",width:6,value:8,elements:[null,4,5,6,8,16,24,32],labels:["None","4 Bits","5 Bits","6 Bits","Byte","2 Bytes","3 Bytes","4 Bytes"],randomizable:!1}])}async performView(e){const t=e.getBytes();let i,s;switch(this.getSettingValue("format")){case"hexadecimal":i=m.hexStringFromBytes(t),s=4;break;case"binary":i=m.binaryStringFromBytes(t),s=1}const n=this.getSettingValue("groupBits");if(null!==n){const e=n/s;i=c.chunk(i,e).join(" ")}this.getView().setText(i)}viewTextDidChange(e,t){this.dare(()=>{const e=this.getSettingValue("format");let i,s=t;switch(s=s.replace(/\s/g,""),e){case"hexadecimal":i=m.bytesFromHexString(s);break;case"binary":i=m.bytesFromBinaryString(s)}this.contentDidChange(w.wrap(i))})}settingValueDidChange(e,t){if("groupBits"===e.getName()){const e=this.getSetting("format"),i=["binary"],s=["Binary"];null!==t&&t%4!=0||(i.push("hexadecimal"),s.push("Hexadecimal")),-1===i.indexOf(e.getValue())&&e.setValue(i[0]),e.setElements(i,s)}}}function ht(e){let t="";for(var i=0;i<e.length;i++)t+=String.fromCharCode(e[i]);return t}function ct(e,t,i){for(var s=0;s<i.length;s++)e[s]=ht(e[s]);let n=function(e,t,i){for(var s=[],n=0;n<i.length;n++)s.push([n,gt(e[n],t)]);return s}(e,t,i);n.sort(function(e,t){return e[1]!=t[1]?e[1]-t[1]:e[0]-t[0]}),div=document.getElementById("crack-results"),div.innerHTML='\n\t<table>\n\t<thead>\n\t\t<tr>\n\t\t\t<th>Shift</th>\n\t\t\t<th colspan="2">Entropy per letter (bits) <span style="font-weight:normal">(lower is better)</span></th>\n\t\t\t<th colspan="2">Beginning of deciphered text </th>\n\t\t</tr>\n\t</thead>\n\t<tbody id="guesses"></tbody>\n\t</table>\n\t<table><tbody style="text-align: center"><tr><td>To change the shift, say \'No\' to Need Crack</td></tr></tbody></table>\n\t';var r=document.getElementById("guesses");return n.forEach(function(t,i){maxEntropy=n[n.length-1][1],minEntropy=n[0][1];var s=r.appendChild(document.createElement("tr"));0==i&&s.classList.add("active");var a=s.appendChild(document.createElement("td"));a.textContent=t[0].toString(),(a=s.appendChild(document.createElement("td"))).textContent=t[1].toFixed(3);var l=(a=s.appendChild(document.createElement("td"))).appendChild(document.createElement("div"));l.classList.add("bar"),l.style.width=(t[1]/maxEntropy*10+1).toFixed(6)+"em",(a=s.appendChild(document.createElement("td"))).textContent=e[t[0]]}),n[0][0]}var dt={a:.08167,b:.01492,c:.02782,d:.04253,e:.12702,f:.02228,g:.02015,h:.06094,i:.06966,j:.00153,k:.00772,l:.04025,m:.02406,n:.06749,o:.07507,p:.01929,q:95e-5,r:.05987,s:.06327,t:.09056,u:.02758,v:.00978,w:.0236,x:.0015,y:.01974,z:74e-5},ut={a:.1174,b:.0092,c:.045,d:.0373,e:.1179,f:.0095,g:.0164,h:.0154,i:.1128,l:.0651,m:.0251,n:.0688,o:.0983,p:.0305,q:.0051,r:.0637,s:.0498,t:.0562,u:.0301,v:.021,z:.0049};function gt(e,t,i){var s=0,n=0;if("english"==t)var r=dt;else if("italian"==t)r=ut;for(var a=0;a<e.length;a++){var l=r[e[a].toLowerCase()];void 0!==l?s+=Math.log(l):n++}return-s/Math.log(2)/(e.length-n)}const pt={name:"crackSetting",label:"Crack",type:"enum",value:"no",elements:["no","english","italian"],labels:["No","from english","from italian"],width:8,randomizable:!1},mt={name:"caesar-cipher",title:"Caesar cipher",category:"Ciphers",type:"encoder"},bt="abcdefghijklmnopqrstuvwxyz",ft="abcdefghilmnopqrstuvz",yt=7;class _t extends K{static getMeta(){return mt}constructor(){super(),this.addSettings([{name:"shift",type:"number",label:"Shift",priority:10,value:yt,integer:!0,describeValue:this.describeShiftValue.bind(this),randomizeValue:this.randomizeShiftValue.bind(this)},{name:"language",label:"Ciphertext Alphabet",type:"enum",value:"english",elements:["english","italian","other"],labels:["English","Italian","Other"],blackChoiceList:[],width:8,randomizable:!1},{name:"alphabet",type:"text",value:bt,uniqueChars:!0,minLength:2,caseSensitivity:!1,randomizable:!1},{name:"caseStrategy",type:"enum",value:"maintain",elements:["maintain","ignore","strict"],labels:["Maintain case","Ignore case","Strict (A ≠ a)"],width:6,randomizable:!1},{name:"includeForeignChars",type:"boolean",label:"Foreign Chars",width:6,value:!0,trueLabel:"Include",falseLabel:"Ignore",randomizable:!1}].concat(pt))}_performTranslate(e,t,i){const{caseStrategy:s,includeForeignChars:n}=this.getSettingValues();let r,a=this.getSettingValue("alphabet");var l;"strict"!==s&&(a=a.toLowerCase(),r=a.toUpperCase()),l=null==i?this.getSettingValue("shift"):i;const o=a.getLength(),h=e.getLength(),c=new Array(h);let d,u,g,p,m=0;for(let i=0;i<h;i++)d=e.getCodePointAt(i),u=a.indexOfCodePoint(d),p=!1,-1===u&&"strict"!==s&&(u=r.indexOfCodePoint(d),p=!0),-1===u?n&&(c[m++]=d):(g=G.mod(u+l*(t?1:-1),o),c[m++]="maintain"===s&&p?r.getCodePointAt(g):a.getCodePointAt(g));return c.slice(0,m)}performTranslate(e,t){let i=this.getSetting(pt.name);if(!t&null==i?this.addSetting(pt):t&null!==i&&this.removeSetting(i),t){if("undefined"!=typeof document){document.getElementById("crack-results").innerHTML="";let e=document.getElementById("bouncing-arrow");null!==e&&(e.style.visibility="hidden")}}else{let i=this.getSettingValue(pt.name);if("no"!=i){let n=i,r={},a=this.getSettingValue("alphabet")._string;for(var s=0;s<a.length;s++)r[s]=this._performTranslate(e,t,s).slice(0,40);let l=ct(r,n,a);this.setSettingValue("shift",l)}}return this._performTranslate(e,t)}settingValueDidChange(e,t){switch(e.getName()){case"caseStrategy":this.getSetting("alphabet").setCaseSensitivity("strict"===t);break;case"alphabet":this.getSetting("shift").setNeedsValueDescriptionUpdate(),t!=bt&&t!=ft&&this.setSettingValue("language","other");break;case"language":"english"==t?this.setSettingValue("alphabet",bt):"italian"==t&&this.setSettingValue("alphabet",ft),this.getSetting("shift").setNeedsValueDescriptionUpdate();break;case pt.name:if("no"!=t){let e=document.getElementById("bouncing-arrow");if(null==e){let t=document.getElementsByClassName("pipe__scrollable")[0];e=document.createElement("div"),e.classList.add("arrow","bounce"),e.id="bouncing-arrow",e.style.visibility="visible",t.appendChild(e)}else e.style.visibility="visible"}else{document.getElementById("crack-results").innerHTML="";let e=document.getElementById("bouncing-arrow");null!==e&&(e.style.visibility="hidden")}}}randomizeShiftValue(e,t){const i=this.getSetting("alphabet");return i.isValid()?e.nextInteger(1,i.getValue().getLength()-1):null}describeShiftValue(e,t){if(!this.getSetting("alphabet").isValid())return null;const{alphabet:i,shift:s}=this.getSettingValues(),n=i.getCharAt(0),r=G.mod(s,i.getLength());return`${n}→${i.getCharAt(r)}`}}const wt={name:"case-transform",title:"Case transform",category:"Transform",type:"encoder"};class vt extends K{static getMeta(){return wt}constructor(){super(),this.addSetting({name:"case",type:"enum",value:"lower",elements:["lower","upper","capitalize","alternating","inverse"],labels:["Lower case","Upper case","Capitalize","Alternating case","Inverse case"],randomizable:!1,style:"radio"})}performEncode(e){switch(this.getSettingValue("case")){case"lower":return e.toLowerCase();case"upper":return e.toUpperCase();case"capitalize":return w.wrap(e.getString().replace(/\w\S*/gu,e=>e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()));case"alternating":return w.wrap(e.getChars().map((e,t)=>t%2==0?e.toLowerCase():e.toUpperCase()).join(""));case"inverse":return this._inverseCase(e);default:return e}}performDecode(e){return"inverse"===this.getSettingValue("case")?this._inverseCase(e):e}_inverseCase(e){return w.wrap(e.getChars().map(e=>{let t=e.toLowerCase();return e!==t?t:e.toUpperCase()}).join(""))}}const St={name:"chemical-elements",title:"Chemical elements",category:"Encoding",type:"encoder"},Ct=["H","He","Li","Be","B","C","N","O","F","Ne","Na","Mg","Al","Si","P","S","Cl","Ar","K","Ca","Sc","Ti","V","Cr","Mn","Fe","Co","Ni","Cu","Zn","Ga","Ge","As","Se","Br","Kr","Rb","Sr","Y","Zr","Nb","Mo","Tc","Ru","Rh","Pd","Ag","Cd","In","Sn","Sb","Te","I","Xe","Cs","Ba","La","Ce","Pr","Nd","Pm","Sm","Eu","Gd","Tb","Dy","Ho","Er","Tm","Yb","Lu","Hf","Ta","W","Re","Os","Ir","Pt","Au","Hg","Tl","Pb","Bi","Po","At","Rn","Fr","Ra","Ac","Th","Pa","U","Np","Pu","Am","Cm","Bk","Cf","Es","Fm","Md","No","Lr","Rf","Db","Sg","Bh","Hs","Mt","Ds","Rg","Cn","Nh","Fl","Mc","Lv","Ts","Og"],Vt=["Hydrogen","Helium","Lithium","Beryllium","Boron","Carbon","Nitrogen","Oxygen","Fluorine","Neon","Sodium","Magnesium","Aluminium","Silicon","Phosphorus","Sulfur","Chlorine","Argon","Potassium","Calcium","Scandium","Titanium","Vanadium","Chromium","Manganese","Iron","Cobalt","Nickel","Copper","Zinc","Gallium","Germanium","Arsenic","Selenium","Bromine","Krypton","Rubidium","Strontium","Yttrium","Zirconium","Niobium","Molybdenum","Technetium","Ruthenium","Rhodium","Palladium","Silver","Cadmium","Indium","Tin","Antimony","Tellurium","Iodine","Xenon","Caesium","Barium","Lanthanum","Cerium","Praseodymium","Neodymium","Promethium","Samarium","Europium","Gadolinium","Terbium","Dysprosium","Holmium","Erbium","Thulium","Ytterbium","Lutetium","Hafnium","Tantalum","Tungsten","Rhenium","Osmium","Iridium","Platinum","Gold","Mercury","Thallium","Lead","Bismuth","Polonium","Astatine","Radon","Francium","Radium","Actinium","Thorium","Protactinium","Uranium","Neptunium","Plutonium","Americium","Curium","Berkelium","Californium","Einsteinium","Fermium","Mendelevium","Nobelium","Lawrencium","Rutherfordium","Dubnium","Seaborgium","Bohrium","Hassium","Meitnerium","Darmstadtium","Roentgenium","Copernicium","Nihonium","Flerovium","Moscovium","Livermorium","Tennessine","Oganesson"],kt=["Idrogeno","Elio","Litio","Berillio","Boro","Carbonio","Azoto","Ossigeno","Fluoro","Neon","Sodio","Magnesio","Alluminio","Silicio","Fosforo","Zolfo","Cloro","Argon","Potassio","Calcio","Scandio","Titanio","Vanadio","Cromo","Manganese","Ferro","Cobalto","Nichel","Rame","Zinco","Gallio","Germanio","Arsenico","Selenio","Bromo","Kripton","Rubidio","Stronzio","Ittrio","Zirconio","Niobio","Molibdeno","Tecnezio","Rutenio","Rodio","Palladio","Argento","Cadmio","Indio","Stagno","Antimonio","Tellurio","Iodio","Xeno","Cesio","Bario","Lantanio","Cerio","Praseodimio","Neodimio","Promezio","Samario","Europio","Gadolinio","Terbio","Disprosio","Olmio","Erbio","Tulio","Itterbio","Lutezio","Afnio","Tantalio","Tungsteno","Renio","Osmio","Iridio","Platino","Oro","Mercurio","Tallio","Piombo","Bismuto","Polonio","Astato","Radon","Francio","Radio","Attinio","Torio","Protoattinio","Uranio","Nettunio","Plutonio","Americio","Curio","Berkelio","Californio","Einsteinio","Fermio","Mendelevio","Nobelio","Laurenzio","Rutherfordio","Dubnio","Seaborgio","Bohrio","Hassio","Meitnerio","Darmstadtio","Roentgenio","Copernicio","Nihonio","Flerovio","Moscovio","Livermorio","Tennesso","Oganesson"];class xt extends K{static getMeta(){return St}constructor(){super(),this.addSettings([{name:"toReturn",label:"return",type:"enum",value:"symbols",elements:["numbers","symbols","englishNames","italianNames"],labels:["Numbers","Symbols","English names","Italian names"],width:8,randomizable:!1},{name:"toStart",label:"start",type:"enum",value:"numbers",elements:["numbers","symbols","englishNames","italianNames"],labels:["Numbers","Symbols","English names","Italian names"],width:8,randomizable:!1},{name:"separator",label:"separator",type:"enum",value:"",elements:[""," ",",","/"],labels:["Nothing","Space","Comma","Slash"],width:8,randomizable:!1}])}performTranslate(e,t){const{toStart:i,toReturn:s,separator:n}=this.getSettingValues(),r=e.getString(),a=t?i:s,l=t?s:i;const o=r.split(n).map(function(e){let t=-1;return"numbers"===a?t=parseInt(e)-1:"symbols"===a?t=Ct.indexOf(e):"englishNames"===a?t=Vt.indexOf(e):"italianNames"===a&&(t=kt.indexOf(e)),t<0?e:"numbers"===l?(t+1).toString():"symbols"===l?Ct[t]:"englishNames"===l?Vt[t]:"italianNames"===l?kt[t]:e});return new w(o.join(n)).getCodePoints()}}const It={name:"enigma",title:"Enigma machine",category:"Ciphers",type:"encoder"},Et="abcdefghijklmnopqrstuvwxyz",Mt=[{name:"I",label:"Enigma I",description:"German Army & Air Force",characterGroupSize:5,plugboard:!0,entryRotor:"ETW-ABCDEF",reflectorRotors:["UKW-A","UKW-B","UKW-C"],reflectorThumbwheel:!1,slots:[{rotors:["I","II","III","IV","V"]},{rotors:["I","II","III","IV","V"]},{rotors:["I","II","III","IV","V"]}]},{name:"N",label:'Enigma I "Norenigma"',description:"Norwegian Police Security Service",characterGroupSize:5,plugboard:!0,entryRotor:"ETW-ABCDEF",reflectorRotors:["UKW-N"],reflectorThumbwheel:!1,slots:[{rotors:["I-N","II-N","III-N","IV-N","V-N"]},{rotors:["I-N","II-N","III-N","IV-N","V-N"]},{rotors:["I-N","II-N","III-N","IV-N","V-N"]}]},{name:"S",label:'Enigma I "Sondermaschine"',description:"German Intelligence",characterGroupSize:5,plugboard:!0,entryRotor:"ETW-ABCDEF",reflectorRotors:["UKW-S"],reflectorThumbwheel:!1,slots:[{rotors:["I-S","II-S","III-S"]},{rotors:["I-S","II-S","III-S"]},{rotors:["I-S","II-S","III-S"]}]},{name:"M3",label:"Enigma M3",description:"German Army & Navy",characterGroupSize:5,plugboard:!0,entryRotor:"ETW-ABCDEF",reflectorRotors:["UKW-B","UKW-C"],reflectorThumbwheel:!1,slots:[{rotors:["I","II","III","IV","V","VI","VII","VIII"]},{rotors:["I","II","III","IV","V","VI","VII","VIII"]},{rotors:["I","II","III","IV","V","VI","VII","VIII"]}]},{name:"M4",label:'Enigma M4 "Shark"',description:"German Submarines",characterGroupSize:4,plugboard:!0,entryRotor:"ETW-ABCDEF",reflectorRotors:["UKW-B-thin","UKW-C-thin"],reflectorThumbwheel:!1,slots:[{rotors:["beta","gamma"],rotating:!1},{rotors:["I","II","III","IV","V","VI","VII","VIII"]},{rotors:["I","II","III","IV","V","VI","VII","VIII"]},{rotors:["I","II","III","IV","V","VI","VII","VIII"]}]},{name:"D",label:"Enigma D / K",description:"Commercial Enigma",characterGroupSize:5,plugboard:!1,entryRotor:"ETW-QWERTZ",reflectorRotors:["UKW-COM"],reflectorThumbwheel:!0,slots:[{rotors:["I-D","II-D","III-D"]},{rotors:["I-D","II-D","III-D"]},{rotors:["I-D","II-D","III-D"]}]},{name:"T",label:'Enigma T "Tirpitz"',description:"Japanese Army",characterGroupSize:5,plugboard:!1,entryRotor:"ETW-T",reflectorRotors:["UKW-T"],reflectorThumbwheel:!0,slots:[{rotors:["I-T","II-T","III-T","IV-T","V-T","VI-T","VII-T","VIII-T"]},{rotors:["I-T","II-T","III-T","IV-T","V-T","VI-T","VII-T","VIII-T"]},{rotors:["I-T","II-T","III-T","IV-T","V-T","VI-T","VII-T","VIII-T"]}]},{name:"KS",label:"Swiss-K",description:"Swiss Army & Air Force",characterGroupSize:5,plugboard:!1,entryRotor:"ETW-QWERTZ",reflectorRotors:["UKW-COM"],reflectorThumbwheel:!0,slots:[{rotors:["I-KS","II-KS","III-KS"]},{rotors:["I-KS","II-KS","III-KS"]},{rotors:["I-KS","II-KS","III-KS"]}]},{name:"KR",label:'Railway Enigma "Rocket I"',description:"German Railway",characterGroupSize:5,plugboard:!1,entryRotor:"ETW-QWERTZ",reflectorRotors:["UKW-KR"],reflectorThumbwheel:!0,slots:[{rotors:["I-KR","II-KR","III-KR"]},{rotors:["I-KR","II-KR","III-KR"]},{rotors:["I-KR","II-KR","III-KR"]}]},{name:"Z",label:"Zählwerk Enigma A-865",description:null,characterGroupSize:5,plugboard:!1,entryRotor:"ETW-QWERTZ",reflectorRotors:["UKW-COM"],reflectorThumbwheel:!0,reflectorRotating:!0,turnoverMechanism:"cog",slots:[{rotors:["I-Z","II-Z","III-Z"]},{rotors:["I-Z","II-Z","III-Z"]},{rotors:["I-Z","II-Z","III-Z"]}]},{name:"G111",label:"Abwehr Enigma G-111",description:null,characterGroupSize:5,plugboard:!1,entryRotor:"ETW-QWERTZ",reflectorRotors:["UKW-COM"],reflectorThumbwheel:!0,reflectorRotating:!0,turnoverMechanism:"cog",slots:[{rotors:["I-G111","II-G111","V-G111"]},{rotors:["I-G111","II-G111","V-G111"]},{rotors:["I-G111","II-G111","V-G111"]}]},{name:"G312",label:"Abwehr Enigma G-312",description:"German Seret Service",characterGroupSize:5,plugboard:!1,entryRotor:"ETW-QWERTZ",reflectorRotors:["UKW-G312"],reflectorThumbwheel:!0,reflectorRotating:!0,turnoverMechanism:"cog",slots:[{rotors:["I-G312","II-G312","III-G312"]},{rotors:["I-G312","II-G312","III-G312"]},{rotors:["I-G312","II-G312","III-G312"]}]},{name:"G260",label:"Abwehr Enigma G-260",description:"German Seret Service in Argentina",characterGroupSize:5,plugboard:!1,entryRotor:"ETW-QWERTZ",reflectorRotors:["UKW-COM"],reflectorThumbwheel:!0,reflectorRotating:!0,turnoverMechanism:"cog",slots:[{rotors:["I-G260","II-G260","III-G260"]},{rotors:["I-G260","II-G260","III-G260"]},{rotors:["I-G260","II-G260","III-G260"]}]}],Bt=["name","label","wiring","turnovers"],zt=["ETW-ABCDEF","Alphabet","abcdefghijklmnopqrstuvwxyz","","ETW-QWERTZ","Keyboard","jwulcmnohpqzyxiradkegvbtsf","","I","I","ekmflgdqvzntowyhxuspaibrcj","q","II","II","ajdksiruxblhwtmcqgznpyfvoe","e","III","III","bdfhjlcprtxvznyeiwgakmusqo","v","IV","IV","esovpzjayquirhxlnftgkdcmwb","j","V","V","vzbrgityupsdnhlxawmjqofeck","z","VI","VI","jpgvoumfyqbenhzrdkasxlictw","zm","VII","VII","nzjhgrcxmyswboufaivlpekqdt","zm","VIII","VIII","fkqhtlxocbjspdzramewniuygv","zm","beta","Beta","leyjvcnixwpbqmdrtakzgfuhos","","gamma","Gamma","fsokanuerhmbtiycwlqpzxvgjd","","UKW-A","UKW A","ejmzalyxvbwfcrquontspikhgd","","UKW-B","UKW B","yruhqsldpxngokmiebfzcwvjat","","UKW-C","UKW C","fvpjiaoyedrzxwgctkuqsbnmhl","","UKW-B-thin","UKW B thin","enkqauywjicopblmdxzvfthrgs","","UKW-C-thin","UKW C thin","rdobjntkvehmlfcwzaxgyipsuq","","I-N","I","wtokasuyvrbxjhqcpzefmdinlg","q","II-N","II","gjlpubswemctqvhxaofzdrkyni","e","III-N","III","jwfmhnbpusdytixvzgrqlaoekc","v","IV-N","IV","esovpzjayquirhxlnftgkdcmwb","j","V-N","V","hejxqotzbvfdascilwpgynmurk","z","UKW-N","UKW","mowjypuxndsraibfvlkzgqchet","","I-S","I","veosirzujdqckgwypnxaflthmb","q","II-S","II","uemoatqlshpkcyfwjzbgvxindr","e","III-S","III","tzhxmbsipnurjfdkeqvcwglaoy","v","UKW-S","UKW","ciagsndrbytpzfulvhekoqxwjm","","I-D","I","lpgszmhaeoqkvxrfybutnicjdw","y","II-D","II","slvgbtfxjqohewirzyamkpcndu","e","III-D","III","cjgdpshkturawzxfmynqobvlie","n","UKW-COM","UKW","imetcgfraysqbzxwlhkdvupojn","","ETW-T","ETW","ilxrztkgjyamwvdufcpqeonshb","","I-T","I","kptyuelocvgrfqdanjmbswhzxi","wzekq","II-T","II","uphzlweqmtdjxcaksoigvbyfnr","wzflr","III-T","III","qudlyrfekonvzaxwhmgpjbsict","wzekq","IV-T","IV","ciwtbkxnrespflydagvhquojzm","wzflr","V-T","V","uaxgisnjbverdylfzwtpckohmq","ycfkr","VI-T","VI","xfuzgalvhcnysewqtdmrbkpioj","xeimq","VII-T","VII","bjvftxplnayozikwgdqeruchsm","ycfkr","VIII-T","VIII","ymtpnzhwkodajxeluqvgcbisfr","xeimq","UKW-T","UKW","gekpbtaumocniljdxzyfhwvqsr","","I-KS","I","pezuohxscvfmtbglrinqjwaydk","y","II-KS","II","zouesydkfwpciqxhmvblgnjrat","e","III-KS","III","ehrvxgaobqusimzflynwktpdjc","n","I-KR","I","jgdqoxuscamifrvtpnewkblzyh","n","II-KR","II","ntzpsfbokmwrcjdivlaeyuxhgq","e","III-KR","III","jviubhtcdyakeqzposgxnrmwfl","y","UKW-KR","UKW","qyhognecvpuztfdjaxwmkisrbl","","I-Z","I","lpgszmhaeoqkvxrfybutnicjdw","suvwzabcefgiklopq","II-Z","II","slvgbtfxjqohewirzyamkpcndu","stvyzacdfghkmnq","III-Z","III","cjgdpshkturawzxfmynqobvlie","uwxaefhkmnr","I-G111","I","wlrhbqundkjczsexotmagyfpvi","suvwzabcefgiklopq","II-G111","II","tfjqazwmhlcuixrdygoevbnskp","stvyzacdfghkmnq","V-G111","V","qtpixwvdfrmusljohcanezkybg","swzfhmq","I-G312","I","dmtwsilruyqnkfejcazbpgxohv","suvwzabcefgiklopq","II-G312","II","hqzgpjtmoblncifdyawveusrkx","stvyzacdfghkmnq","III-G312","III","uqntlszfmrehdpxkibvygjcwoa","uwxaefhkmnr","UKW-G312","UKW","rulqmzjsygocetkwdahnbxpvif","","I-G260","I","rcspblkqaumhwytifzvgojnexd","suvwzabcefgiklopq","II-G260","II","wcmibvpjxarosgndlzkeyhufqt","stvyzacdfghkmnq","III-G260","III","fvdhzelsqmaxokyiwpgcbujtnr","uwxaefhkmnr"];let Lt=null,Tt=null;class At extends K{static getMeta(){return It}constructor(){super();const e=At.getModel("M3"),t=At.getRotors(e.slots[0].rotors),i=t.map(e=>e.name),s=t.map(e=>e.label),n=At.getRotors(e.reflectorRotors);this.addSetting({name:"model",type:"enum",value:e.name,elements:Mt.map(e=>e.name),labels:Mt.map(e=>e.label),descriptions:Mt.map(e=>e.description),randomizable:!1}),this.addSetting({name:"reflector",type:"enum",value:n[0].name,elements:n.map(e=>e.name),labels:n.map(e=>e.label),width:4}),this.addSetting({name:"positionReflector",label:"Position",type:"number",value:1,integer:!0,min:1,max:27,describeValue:this.describePositionValue.bind(this),width:4}),this.addSetting({name:"ringReflector",label:"Ring",type:"number",value:1,integer:!0,min:1,max:27,describeValue:this.describePositionValue.bind(this),width:4});for(let e=0;e<At.getMaxSlotCount();e++)this.addSetting({name:`rotor${e+1}`,label:`Rotor ${e+1}`,type:"enum",value:i[0],elements:i,labels:s,randomizable:!1,width:4}),this.addSetting({name:`position${e+1}`,label:"Position",type:"number",value:1,integer:!0,min:1,max:27,describeValue:this.describePositionValue.bind(this),width:4}),this.addSetting({name:`ring${e+1}`,label:"Ring",type:"number",value:1,integer:!0,min:1,max:27,describeValue:this.describePositionValue.bind(this),width:4});this.addSetting({name:"plugboard",type:"text",value:"",caseSensitivity:!1,validateValue:this.validatePlugboardValue.bind(this),filterValue:e=>e.getString().trim().toLowerCase(),randomizeValue:this.randomizePlugboardValue.bind(this)}),this.addSetting({name:"includeForeignChars",type:"boolean",label:"Foreign Chars",value:!1,trueLabel:"Include",falseLabel:"Ignore",randomizable:!1}),this.applyModel(e.name)}settingValueDidChange(e,t){super.settingValueDidChange(e,t),"model"===e.getName()&&this.applyModel(t)}applyModel(e){const t=At.getModel(e),i=At.getMaxSlotCount();for(let e=0;e<i;e++){const i=e<t.slots.length?t.slots[e]:null,s=null!==i,n=this.getSetting(`rotor${e+1}`),r=this.getSetting(`ring${e+1}`),a=this.getSetting(`position${e+1}`);if(n.setVisible(s),r.setVisible(s),a.setVisible(s),s){const e=At.getRotors(i.rotors);n.setElements(e.map(e=>e.name),e.map(e=>e.label),null,!1),!0!==n.validateValue(n.getValue())&&n.setValue(e[0].name)}}const s=At.getRotors(t.reflectorRotors),n=this.getSetting("reflector");n.setElements(s.map(e=>e.name),s.map(e=>e.label),null,!1),!0!==n.validateValue(n.getValue())&&n.setValue(s[0].name),n.setWidth(t.reflectorThumbwheel?4:12),n.setVisible(t.reflectorThumbwheel||s.length>1),this.getSetting("positionReflector").setVisible(t.reflectorThumbwheel),this.getSetting("ringReflector").setVisible(t.reflectorThumbwheel),this.getSetting("plugboard").setVisible(t.plugboard)}performTranslate(e,t){const i=this.getSettingValue("includeForeignChars"),s=At.getModel(this.getSettingValue("model"));let n=0;const r=s.slots,a=[],l=[],o=[];for(n=0;n<r.length;n++){const e=this.getSettingValue(`rotor${n+1}`);a.push(At.getRotor(e)),l.push(this.getSettingValue(`position${n+1}`)-1),o.push(this.getSettingValue(`ring${n+1}`)-1)}const h=At.getRotor(s.entryRotor),c=At.getRotor(this.getSettingValue("reflector"));let d=s.reflectorThumbwheel?this.getSettingValue("positionReflector"):0;const u=s.reflectorThumbwheel?this.getSettingValue("ringReflector"):0;let g=null;if(s.plugboard){const e=this.getSettingValue("plugboard");g=this.wiringFromPlugboardValue(e.toString())}const p=At.rotorMapChar;let m=e.getCodePoints().map((e,t)=>{let m=null;if(e>=65&&e<=90)m=e-65;else{if(!(e>=97&&e<=122))return!!i&&e;m=e-97}if("cog"===s.turnoverMechanism){let e=!0;for(n=r.length-1;e&&n>=0;)!1!==r[n].rotating?(e=At.rotorAtTurnover(a[n],l[n]),l[n]++):e=!1,n--;e&&!0===s.reflectorRotating&&d++}else{let e=!1;for(n=1;!e&&n<r.length;)e=At.rotorAtTurnover(a[n],l[n]),e&&(n!==r.length-1&&l[n]++,!1!==r[n-1].rotating&&l[n-1]++),n++;l[l.length-1]++}for(null!==g&&(m=p(m,g,0,0,!1)),m=p(m,h,0,0,!1),n=a.length-1;n>=0;n--)m=p(m,a[n],l[n],o[n],!1);for(m=p(m,c,d,u,!1),n=0;n<a.length;n++)m=p(m,a[n],l[n],o[n],!0);return m=p(m,h,0,0,!0),null!==g&&(m=p(m,g,0,0,!0)),m+97});if(!i){const e=[];m.forEach(t=>{!1!==t&&((e.length+1)%(s.characterGroupSize+1)===0&&e.push(32),e.push(t))}),m=e}return m}static rotorAtTurnover(e,t){if(void 0===e.turnovers)return!1;const i=String.fromCharCode(97+G.mod(t,26));return-1!==e.turnovers.indexOf(i)}static rotorMapChar(e,t,i,s,n){const r="string"==typeof t?t:t.wiring;return i=G.mod(i-s,26),e=G.mod(e+i,26),e=n?r.indexOf(String.fromCharCode(97+e)):r.charCodeAt(e)-97,e=G.mod(e-i,26)}describePositionValue(e,t){return Et[e-1].toUpperCase()}validatePlugboardValue(e,t){const i=e.getString();return""===i||(null===i.match(/^([a-z]{2}\s)*([a-z]{2})$/)?{key:"enigmaPlugboardInvalidFormat",message:"Invalid plugboard format: pairs of letters to be swapped expected (e.g. 'ab cd ef')"}:!!o.isUnique(i.replace(/\s/g,"").split(""))||{key:"enigmaPlugboardPairsNotUnique",message:"Pairs of letters to be swapped need to be unique"})}wiringFromPlugboardValue(e){const t=Et.split("");return e.split(" ").forEach(e=>{t[e.charCodeAt(0)-97]=e[1],t[e.charCodeAt(1)-97]=e[0]}),t.join("")}isRandomizable(){return!0}randomize(){const e=At.getModel(this.getSettingValue("model"));let t,i,s,n=e.reflectorRotors;for(t=0;t<e.slots.length;t++)n=n.concat(e.slots[t].rotors);for(n=o.unique(n),n=o.shuffle(n),i=n.findIndex(t=>-1!==e.reflectorRotors.indexOf(t)),-1!==i&&(s=n.splice(i,1)[0],this.setSettingValue("reflector",s)),t=0;t<e.slots.length;t++)i=n.findIndex(i=>-1!==e.slots[t].rotors.indexOf(i)),-1!==i&&(s=n.splice(i,1)[0],this.setSettingValue(`rotor${t+1}`,s));return super.randomize(),this}randomizePlugboardValue(e,t){const i=o.shuffle(Et.split(""),e).join("").substr(0,20);return c.chunk(i,2).join(" ")}static getModel(e){return null===Lt&&(Lt={},Mt.forEach(e=>{Lt[e.name]=e})),Lt[e]||null}static getMaxSlotCount(){return Mt.reduce((e,t)=>Math.max(e,t.slots.length),0)}static getRotor(e){if(null===Tt){let e,t,i;for(Tt={},e=0;e<zt.length;e+=Bt.length){for(i={},t=0;t<Bt.length;t++)i[Bt[t]]=zt[e+t];Tt[i.name]=i}}return Tt[e]||null}static getRotors(e){return e.map(e=>At.getRotor(e))}}function Pt(e,t){let[i,s,n,r]=e;i=Dt(i,s,n,r,t[0],7,3614090360),r=Dt(r,i,s,n,t[1],12,3905402710),n=Dt(n,r,i,s,t[2],17,606105819),s=Dt(s,n,r,i,t[3],22,3250441966),i=Dt(i,s,n,r,t[4],7,4118548399),r=Dt(r,i,s,n,t[5],12,1200080426),n=Dt(n,r,i,s,t[6],17,2821735955),s=Dt(s,n,r,i,t[7],22,4249261313),i=Dt(i,s,n,r,t[8],7,1770035416),r=Dt(r,i,s,n,t[9],12,2336552879),n=Dt(n,r,i,s,t[10],17,4294925233),s=Dt(s,n,r,i,t[11],22,2304563134),i=Dt(i,s,n,r,t[12],7,1804603682),r=Dt(r,i,s,n,t[13],12,4254626195),n=Dt(n,r,i,s,t[14],17,2792965006),s=Dt(s,n,r,i,t[15],22,1236535329),i=Ft(i,s,n,r,t[1],5,4129170786),r=Ft(r,i,s,n,t[6],9,3225465664),n=Ft(n,r,i,s,t[11],14,643717713),s=Ft(s,n,r,i,t[0],20,3921069994),i=Ft(i,s,n,r,t[5],5,3593408605),r=Ft(r,i,s,n,t[10],9,38016083),n=Ft(n,r,i,s,t[15],14,3634488961),s=Ft(s,n,r,i,t[4],20,3889429448),i=Ft(i,s,n,r,t[9],5,568446438),r=Ft(r,i,s,n,t[14],9,3275163606),n=Ft(n,r,i,s,t[3],14,4107603335),s=Ft(s,n,r,i,t[8],20,1163531501),i=Ft(i,s,n,r,t[13],5,2850285829),r=Ft(r,i,s,n,t[2],9,4243563512),n=Ft(n,r,i,s,t[7],14,1735328473),s=Ft(s,n,r,i,t[12],20,2368359562),i=Ot(i,s,n,r,t[5],4,4294588738),r=Ot(r,i,s,n,t[8],11,2272392833),n=Ot(n,r,i,s,t[11],16,1839030562),s=Ot(s,n,r,i,t[14],23,4259657740),i=Ot(i,s,n,r,t[1],4,2763975236),r=Ot(r,i,s,n,t[4],11,1272893353),n=Ot(n,r,i,s,t[7],16,4139469664),s=Ot(s,n,r,i,t[10],23,3200236656),i=Ot(i,s,n,r,t[13],4,681279174),r=Ot(r,i,s,n,t[0],11,3936430074),n=Ot(n,r,i,s,t[3],16,3572445317),s=Ot(s,n,r,i,t[6],23,76029189),i=Ot(i,s,n,r,t[9],4,3654602809),r=Ot(r,i,s,n,t[12],11,3873151461),n=Ot(n,r,i,s,t[15],16,530742520),s=Ot(s,n,r,i,t[2],23,3299628645),i=Rt(i,s,n,r,t[0],6,4096336452),r=Rt(r,i,s,n,t[7],10,1126891415),n=Rt(n,r,i,s,t[14],15,2878612391),s=Rt(s,n,r,i,t[5],21,4237533241),i=Rt(i,s,n,r,t[12],6,1700485571),r=Rt(r,i,s,n,t[3],10,2399980690),n=Rt(n,r,i,s,t[10],15,4293915773),s=Rt(s,n,r,i,t[1],21,2240044497),i=Rt(i,s,n,r,t[8],6,1873313359),r=Rt(r,i,s,n,t[15],10,4264355552),n=Rt(n,r,i,s,t[6],15,2734768916),s=Rt(s,n,r,i,t[13],21,1309151649),i=Rt(i,s,n,r,t[4],6,4149444226),r=Rt(r,i,s,n,t[11],10,3174756917),n=Rt(n,r,i,s,t[2],15,718787259),s=Rt(s,n,r,i,t[9],21,3951481745),e[0]=Nt(i,e[0]),e[1]=Nt(s,e[1]),e[2]=Nt(n,e[2]),e[3]=Nt(r,e[3])}function Nt(e,t){return e+t&4294967295}function $t(e,t,i,s,n,r){return t=Nt(Nt(t,e),Nt(s,r)),Nt(t<<n|t>>>32-n,i)}function Dt(e,t,i,s,n,r,a){return $t(t&i|~t&s,e,t,n,r,a)}function Ft(e,t,i,s,n,r,a){return $t(t&s|i&~s,e,t,n,r,a)}function Ot(e,t,i,s,n,r,a){return $t(t^i^s,e,t,n,r,a)}function Rt(e,t,i,s,n,r,a){return $t(i^(t|~s),e,t,n,r,a)}const qt={name:"hash",title:"Hash function",category:"Modern cryptography",type:"encoder"},Ut=[{name:"md5",label:"MD5",blockSize:64,available:!0},{name:"sha1",label:"SHA-1",blockSize:64,browserAlgorithm:"SHA-1",browserExceptions:["ie=11","edge"],nodeAlgorithm:"sha1"},{name:"sha256",label:"SHA-256",blockSize:64,browserAlgorithm:"SHA-256",nodeAlgorithm:"sha256"},{name:"sha384",label:"SHA-384",blockSize:128,browserAlgorithm:"SHA-384",nodeAlgorithm:"sha384"},{name:"sha512",label:"SHA-512",blockSize:128,browserAlgorithm:"SHA-512",browserExceptions:["ie=11"],nodeAlgorithm:"sha512"}];class jt extends K{static getMeta(){return qt}constructor(){super(),this.setEncodeOnly(!0);const e=jt.filterAvailableAlgorithms();this.addSetting({name:"algorithm",type:"enum",value:"sha256",elements:e.map(e=>e.name),labels:e.map(e=>e.label),randomizable:!1,style:"radio"})}performEncode(e){const t=this.getSettingValue("algorithm");return this.createDigest(t,e.getBytes())}createDigest(e,i){const s=Ut.find(t=>t.name===e);if("md5"===e)return new Promise(e=>e(function(e){let t,i=(e=Array.from(e)).length;for(e.push(128);e.length%64!=56;)e.push(0);for(let s=0;s<8;s++)0===s?e.push((31&i)<<3):(t=8*s-3,e.push(t<32?i>>t&255:0));let s=e.length/4,n=new Array(s);for(let t=0;t<s;t++)n[t]=(e[4*t+3]<<24)+(e[4*t+2]<<16)+(e[4*t+1]<<8)+e[4*t];let r=[1732584193,4023233417,2562383102,271733878];for(let e=0;e<s;e+=16)Pt(r,n.slice(e,e+16));let a=new Array(16);for(let e=0,t=0;t<16;e++,t+=4)a[t]=255&r[e],a[t+1]=r[e]>>8&255,a[t+2]=r[e]>>16&255,a[t+3]=r[e]>>24&255;return new Uint8Array(a)}(i)));if(je.isNode())return new Promise((e,n)=>{const r=t.createHash(s.nodeAlgorithm).update(global.Buffer.from(i)).digest();e(new Uint8Array(r))});{const e=window.crypto||window.msCrypto;let t=(e.subtle||e.webkitSubtle).digest(s.browserAlgorithm,i);return void 0!==t.oncomplete&&(t=new Promise((e,i)=>{t.oncomplete=e.bind(this,t.result),t.onerror=i})),t.then(e=>new Uint8Array(e))}}static filterAvailableAlgorithms(){const e=je.isNode();return Ut.filter(t=>!0===t.available||(e||void 0===t.browserAlgorithm?!(!e||void 0===t.nodeAlgorithm):void 0===t.browserExceptions||!je.match.apply(je,t.browserExceptions)))}static getAlgorithmBlockSize(e){const t=Ut.find(t=>t.name===e);return void 0!==t?t.blockSize:null}}const Wt={name:"hmac",title:"HMAC",category:"Modern cryptography",type:"encoder"};class Ht extends K{static getMeta(){return Wt}constructor(){super(),this.setEncodeOnly(!0),this._hashEncoder=new jt;const e=this._hashEncoder.getSetting("algorithm");this.addSettings([{name:"key",type:"bytes",value:new Uint8Array([99,114,121,112,116,105,105])},{name:"algorithm",type:"enum",value:e.getValue(),elements:e.getElements(),labels:e.getElementLabels(),randomizable:!1,style:"radio"}])}async performEncode(e){const t=e.getBytes(),i=this.getSettingValue("algorithm"),s=jt.getAlgorithmBlockSize(i);let n=this.getSettingValue("key");n.length>s&&(n=await this.createDigest(i,n));const r=new Uint8Array(s);r.set(n,0);const a=new Uint8Array(s+t.length);a.set(r,0),a.set(t,s);for(let e=0;e<s;e++)a[e]^=54,r[e]^=92;const l=await this.createDigest(i,a),o=new Uint8Array(s+l.length);return o.set(r,0),o.set(l,s),this.createDigest(i,o)}async createDigest(e,t){null===this._hashEncoder&&(this._hashEncoder=new jt),this._hashEncoder.setSettingValue("algorithm",e);return(await this._hashEncoder.encode(t)).getBytes()}}const Gt={name:"integer",title:"Integer",category:"Encoding",type:"encoder"},Kt=["U8","I8","U16","I16","U32","I32"],Zt=[1,1,2,2,4,4],Xt=["8-bit unsigned integer (U8)","8-bit signed integer (I8)","16-bit unsigned integer (U16)","16-bit signed integer (I16)","32-bit unsigned integer (U32)","32-bit signed integer (I32)"];class Yt extends K{static getMeta(){return Gt}constructor(){super(),this.addSettings([{name:"format",type:"enum",value:"decimal",elements:["binary","octal","decimal","hexadecimal"],labels:["Binary","Octal","Decimal","Hexadecimal"],randomizable:!1,priority:30},{name:"type",type:"enum",value:"U8",elements:Kt,labels:Xt,randomizable:!1,style:"radio",priority:20},{name:"byteOrder",type:"enum",value:"big-endian",elements:["little-endian","big-endian"],labels:["Little-endian","Big-endian"],randomizable:!1,visible:!1,priority:10}])}performEncode(e){const t=this.getSettingValue("type"),i=Kt.indexOf(t),s=Zt[i],n="big-endian"===this.getSettingValue("byteOrder");let r=e.getSize();r%s!==0&&(r+=s-r%s);const a=new Uint8Array(r);a.set(e.getBytes());const l=this.createIntegerTypeArray(r/s,t);let o=0,h=0;for(;h<a.length;)n?o=o<<8|a[h]:o|=a[h]<<h%s*8,++h%s===0&&(l[h/s-1]=o,o=0);const c=this.getSettingValue("format"),d=[];for(h=0;h<l.length;h++)switch(c){case"binary":d.push(l[h].toString(2));break;case"octal":d.push(l[h].toString(8));break;case"decimal":d.push(l[h].toString(10));break;default:d.push(l[h].toString(16))}return d.join(" ")}performDecode(e){const t=this.getSettingValue("type"),i=Kt.indexOf(t),s=Zt[i],n="big-endian"===this.getSettingValue("byteOrder"),r=this.getSettingValue("format"),a=e.getString().split(/\s+/),l=this.createIntegerTypeArray(a.length,t);let o,h,c;for(o=0;o<a.length;o++){switch(c=a[o],""===c&&(c="0"),r){case"binary":h=parseInt(c,2);break;case"octal":h=parseInt(c,8);break;case"decimal":h=parseInt(c,10);break;default:h=parseInt(c,16)}if(isNaN(h))throw new u(`Invalid integer '${c}' at index ${o}`);l[o]=h}const d=new Uint8Array(l.length*s);let g;for(o=0;o<d.length;o++)h=l[parseInt(o/s)],g=n?s-o%s-1:o%s,d[o]=h>>8*g&255;return d}createIntegerTypeArray(e,t){switch(t){case"I8":return new Int8Array(e);case"U8":return new Uint8Array(e);case"I16":return new Int16Array(e);case"U16":return new Uint16Array(e);case"I32":return new Int32Array(e);default:return new Uint32Array(e)}}settingValueDidChange(e,t){if("type"===e.getName()){const e=Kt.indexOf(this.getSettingValue("type"));this.getSetting("byteOrder").setVisible(Zt[e]>1)}}}const Jt={name:"letters-to-numbers",title:"Letters to numbers",category:"Encoding",type:"encoder"},Qt="abcdefghijklmnopqrstuvwxyz",ei="abcdefghilmnopqrstuvz";class ti extends K{static getMeta(){return Jt}constructor(){super(),this.addSettings([{name:"shift",type:"number",label:"Shift",priority:10,value:1,integer:!0,describeValue:this.describeShiftValue.bind(this),randomizeValue:this.randomizeShiftValue.bind(this)},{name:"language",label:"Ciphertext Alphabet",type:"enum",value:"english",elements:["english","italian","other"],labels:["English","Italian","Other"],blackChoiceList:[],width:8,randomizable:!1},{name:"alphabet",type:"text",value:Qt,uniqueChars:!0,minLength:2,caseSensitivity:!1,randomizable:!1}])}fromLettersToNumbers(e,t){let i=new w(e),s=i.toString(),n="";for(let e=0;e<i.getLength();e++){let i=t.indexOf(s[e]);-1!==i&&(n+=i.toString()+" ")}return new w(n).getCodePoints()}fromNumbersToLetters(e,t){let i=e.getString();const s=i.replace(/(\d+)/g,(e,s,n)=>!((0===n||c.isWhitespace(i,n-1))&&(i.length===n+s.length||c.isWhitespace(i,n+s.length)))||s>=t.length?s:t.getCharAt(s));return new w(s)}performTranslate(e,t){const{caseStrategy:i}=this.getSettingValues();let s=this.getSettingValue("alphabet");s=s.toLowerCase();let n=s.toUpperCase(),r=this.getSettingValue("shift");const a=s.getLength(),l=e.getLength();let o,h,c,d=new Array(l),u=0;t||(e=this.fromNumbersToLetters(e,s));for(let i=0;i<l;i++)o=e.getCodePointAt(i),h=s.indexOfCodePoint(o),-1===h&&(h=n.indexOfCodePoint(o)),-1!==h&&(c=G.mod(h+r*(t?1:-1),a),d[u++]=s.getCodePointAt(c));return d=d.slice(0,u),t&&(d=this.fromLettersToNumbers(d,s)),d}settingValueDidChange(e,t){switch(e.getName()){case"alphabet":this.getSetting("shift").setNeedsValueDescriptionUpdate(),t!=Qt&&t!=ei&&this.setSettingValue("language","other");break;case"language":"english"==t?this.setSettingValue("alphabet",Qt):"italian"==t&&this.setSettingValue("alphabet",ei),this.getSetting("shift").setNeedsValueDescriptionUpdate()}}randomizeShiftValue(e,t){const i=this.getSetting("alphabet");return i.isValid()?e.nextInteger(1,i.getValue().getLength()-1):null}describeShiftValue(e,t){if(!this.getSetting("alphabet").isValid())return null;const{alphabet:i,shift:s}=this.getSettingValues();return`${i.getCharAt(0)}→${G.mod(s,i.getLength())}`}}const ii={name:"morse-code",title:"Morse code",category:"Alphabets",type:"encoder"},si="abcdefghijklmnopqrstuvwxyz0123456789.,?'!/()&:;=+-_\"$@",ni=[".-","-...","-.-.","-..",".","..-.","--.","....","..",".---","-.-",".-..","--","-.","---",".--.","--.-",".-.","...","-","..-","...-",".--","-..-","-.--","--..","-----",".----","..---","...--","....-",".....","-....","--...","---..","----.",".-.-.-","--..--","..--..",".----.","-.-.--","-..-.","-.--.","-.--.-",".-...","---...","-.-.-.","-...-",".-.-.","-....-","..--.-",".-..-.","..._.._",".--.-."];class ri extends K{static getMeta(){return ii}constructor(){super(),this.addSettings([{name:"variant",type:"enum",value:"english",elements:["english"],labels:["English"],randomizable:!1},{name:"representation",type:"enum",value:"code",elements:["code","timing"],labels:["Code","Timing"],randomizable:!1},{name:"shortMark",label:"Short",type:"text",width:4,value:".",minLength:1,randomizable:!1,validateValue:this.validateCodeMarkSettingValue.bind(this)},{name:"longerMark",label:"Long",type:"text",width:4,value:"-",minLength:1,randomizable:!1,validateValue:this.validateCodeMarkSettingValue.bind(this)},{name:"spaceMark",label:"Space",type:"text",width:4,value:"/",minLength:1,randomizable:!1,validateValue:this.validateCodeMarkSettingValue.bind(this)},{name:"signalOnMark",label:"Signal On",type:"text",width:6,visible:!1,value:"=",minLength:1,randomizable:!1,validateValue:this.validateTimingMarkSettingValue.bind(this)},{name:"signalOffMark",label:"Signal Off",type:"text",width:6,visible:!1,value:".",minLength:1,randomizable:!1,validateValue:this.validateTimingMarkSettingValue.bind(this)}])}performEncode(e){const t=this.getSettingValue("representation");let i=".",s="-",n="/";"code"===t&&(i=this.getSettingValue("shortMark").getString(),s=this.getSettingValue("longerMark").getString(),n=this.getSettingValue("spaceMark").getString());let r=e.toLowerCase().getChars().map(e=>{let t=ri.encodeCharacter(e,i,s,n);if(null===t)throw new u(`Char '${e}' is not defined in morse code`);return t}).join(" ");if("timing"===t){const e=this.getSettingValue("signalOnMark").getString(),t=this.getSettingValue("signalOffMark").getString();r=r.split("").map(i=>{switch(i){case".":return e;case"-":return e.repeat(3);default:return t}}).join(t)}return r}performDecode(e){const t=this.getSettingValue("representation");let i=e.getString(),s=".",n="-",r="/";if("code"===t&&(s=this.getSettingValue("shortMark").getString(),n=this.getSettingValue("longerMark").getString(),r=this.getSettingValue("spaceMark").getString()),"timing"===t){const e=[this.getSettingValue("signalOnMark").getString(),this.getSettingValue("signalOffMark").getString()];i=ri.translateMarks(i,e,["=","."]),i=i.replace(/===/g,"-").replace(/\.{7}/g," / ").replace(/\.{3}/g," ").replace(/\./g,"").replace(/=/g,".")}return i=i.split(" ").map(e=>{if(""===e)return null;const t=ri.decodeCode(e,s,n,r);if(null===t)throw new u(`Code '${e}' is not defined in morse code`);return t}).filter(e=>null!==e).join(""),i}validateCodeMarkSettingValue(e,t){const i=t.filterValue(e);if(null!==i.match(/\s/))return{key:"morseCodeMarkWhitespaceNotAllowed",message:"Whitespaces are not allowed inside morse code marks"};return void 0===["shortMark","longerMark","spaceMark"].filter(e=>e!==t.getName()).find(e=>i.isEqualTo(this.getSettingValue(e)))||{key:"morseCodeMarkNotUnique",message:"Morse code marks need to be different from each other"}}validateTimingMarkSettingValue(e,t){const i=t.filterValue(e);return void 0===["signalOnMark","signalOffMark"].filter(e=>e!==t.getName()).find(e=>0===i.indexOf(this.getSettingValue(e)))||{key:"morseCodeMarkNotUnique",message:"Timing marks need to be different from each other"}}settingValueDidChange(e,t){switch(e.getName()){case"shortMark":case"longerMark":case"spaceMark":["shortMark","longerMark","spaceMark"].filter(t=>t!==e.getName()).forEach(e=>this.getSetting(e).revalidateValue());break;case"signalOnMark":case"signalOffMark":["signalOnMark","signalOffMark"].filter(t=>t!==e.getName()).forEach(e=>this.getSetting(e).revalidateValue());break;case"representation":this.getSetting("shortMark").setVisible("code"===t),this.getSetting("longerMark").setVisible("code"===t),this.getSetting("spaceMark").setVisible("code"===t),this.getSetting("signalOnMark").setVisible("timing"===t),this.getSetting("signalOffMark").setVisible("timing"===t)}}static encodeCharacter(e,t,i,s){if(c.isWhitespace(e))return s;const n=si.indexOf(e);if(-1===n)return null;const r=ni[n];return ri.translateMarks(r,[".","-"],[t,i])}static decodeCode(e,t,i,s){if(e===s)return" ";const n=ri.translateMarks(e,[t,i],[".","-"]),r=ni.indexOf(n);return-1!==r?si[r]:null}static translateMarks(e,t,i){let s,n,r,a="",l=-1;for(;++l<e.length;)for(r=!1,s=-1;!r&&++s<t.length;)n=t[s],r=e.substr(l,n.length)===n,r&&(a+=i[s],l+=n.length-1);return a}}const ai={name:"nihilist-cipher",title:"Nihilist cipher",category:"Polybius square ciphers",type:"encoder"},li="abcdefghiklmnopqrstuvwxyz";class oi extends K{static getMeta(){return ai}constructor(){super(),this.addSettings([{name:"alphabet",type:"text",value:li,uniqueChars:!0,minLength:0,maxLength:25,caseSensitivity:!1},{name:"key",type:"text",value:"cryptii",whitelistChars:li,minLength:2,caseSensitivity:!1},{name:"separator",type:"text",value:" ",randomizable:!1,blacklistChars:"0123456789",minLength:1,caseSensitivity:!1}]),this._polybiusSquare=new te,this._polybiusSquare.setSettingValues({alphabet:li,rows:"12345",columns:"12345",separator:"",caseSensitivity:!1,includeForeignChars:!1})}async performEncode(e){const t=this.getSettingValue("key"),i=this.getSettingValue("separator"),s=await this._polybiusSquare.encode(e.getString().replace(/j/gi,"i")),n=await this._polybiusSquare.encode(t),r=s.getLength()/2,a=t.getLength(),l=new Array(r);let o,h,c;for(let e=0;e<r;e++)o=parseInt(s.getCharAt(2*e)+s.getCharAt(2*e+1)),h=2*G.mod(e,a),c=parseInt(n.getCharAt(h)+n.getCharAt(h+1)),l[e]=o+c;return w.join(l,i)}async performDecode(e){const t=this.getSettingValue("key"),i=this.getSettingValue("separator"),s=e.getString().split(i),n=s.length,r=t.getLength(),a=await this._polybiusSquare.encode(t);let l,o,h,c,d="";for(let e=0;e<n;e++){if(l=parseInt(s[e]),isNaN(l))throw new u(`Block at index ${e+1} is not a number.`);if(h=2*G.mod(e,r),c=parseInt(a.getCharAt(h)+a.getCharAt(h+1)),o=l-c,!o.toString().match(/^[1-5]{2}$/))throw new u(`Block at index ${e+1} results in invalid Polybius square coordinates '${o}'.`);d+=o.toString()}return this._polybiusSquare.decode(d)}settingValueDidChange(e,t){if("alphabet"===e.getName()){const e=t.extend(li);this._polybiusSquare.setSettingValue("alphabet",e),this.getSetting("key").setWhitelistChars(e)}}}const hi={name:"numeral-system",title:"Numeral system",category:"Transform",type:"encoder"},ci=["binary","octal","decimal","hexadecimal","roman-numerals"],di=["Binary (2)","Octal (8)","Decimal (10)","Hexadecimal (16)","Roman numerals"],ui=[/([01]+)/g,/([0-7]+)/g,/(\d+)/g,/([0-9a-f]+)/gi,/([IVXLCDM]+)/gi],gi=["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"],pi=[1e3,900,500,400,100,90,50,40,10,9,5,4,1];class mi extends K{static getMeta(){return hi}constructor(){super(),this.addSettings([{name:"from",label:"Read",type:"enum",value:"decimal",elements:ci,labels:di,randomizable:!1,style:"radio"},{name:"to",label:"Convert to",type:"enum",value:"hexadecimal",elements:ci,labels:di,randomizable:!1,style:"radio"}])}performTranslate(e,t){const i=e.toString(),s=this.getSettingValue(t?"from":"to"),n=this.getSettingValue(t?"to":"from"),r=ui[ci.indexOf(s)];return i.replace(r,(e,t,r)=>{if(!((0===r||c.isWhitespace(i,r-1))&&(i.length===r+t.length||c.isWhitespace(i,r+t.length))))return t;const a=mi.decodeNumber(s,t);return(null!==a?mi.encodeNumber(n,a):null)||t})}static decodeNumber(e,t){if("undefined"!=typeof BigInt)switch(e){case"binary":return BigInt(`0b${t}`);case"octal":return BigInt(`0o${t}`);case"decimal":return BigInt(t);case"hexadecimal":return BigInt(`0x${t}`)}let i=null;switch(e){case"binary":i=parseInt(t,2);break;case"octal":i=parseInt(t,8);break;case"decimal":i=parseInt(t,10);break;case"hexadecimal":i=parseInt(t,16);break;case"roman-numerals":i=mi.romanNumeralsToDecimal(t)}if(null===i||isNaN(i))return null;if(!mi.isSafeInteger(i))throw new u(`Can't read '${t}' because the current environment does not support arbitrarily large integers.`);return i}static encodeNumber(e,t){switch(e){case"binary":return t.toString(2);case"octal":return t.toString(8);case"decimal":return t.toString(10);case"hexadecimal":return t.toString(16);case"roman-numerals":return mi.decimalToRomanNumerals(t);default:return null}}static isSafeInteger(e){if(void 0===Number.isSafeInteger){const t=Number.MAX_SAFE_INTEGER||9007199254740991;return Number.isInteger(e)&&Math.abs(e)<=t}return Number.isSafeInteger(e)}static decimalToRomanNumerals(e){if(e<=0||e>=4e3)return null;let t,i=Number(e),s="";for(;i>0;)t=pi.findIndex(e=>i>=e),s+=gi[t],i-=pi[t];return s}static romanNumeralsToDecimal(e){e=e.toString().toUpperCase();let t,i=0,s=0,n=!1,r=0;for(;!n&&i<e.length;)t=gi.findIndex(t=>e.substr(i,t.length)===t),-1!==t&&t>=r?(s+=pi[t],i+=gi[t].length,r=t):n=!0;return n?null:s}}const bi=16,fi=13;class yi extends nt{constructor(){super(),this._tape=[],this._rows=8,this._$canvas=null,this._$tapes=null,this._$marks=null,this._$holes=null}setTape(e,t){return this._tape=e,this._rows=t,this.setNeedsUpdate()}render(){const e=super.render();return e.classList.add("viewer-paper-tape"),e}renderContent(){this._$tapes=document.createElementNS("http://www.w3.org/2000/svg","path"),this._$tapes.classList.add("viewer-punched-tape__tape"),this._$marks=document.createElementNS("http://www.w3.org/2000/svg","path"),this._$marks.classList.add("viewer-punched-tape__mark"),this._$holes=document.createElementNS("http://www.w3.org/2000/svg","path"),this._$holes.classList.add("viewer-punched-tape__hole"),this._$canvas=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._$canvas.classList.add("viewer-punched-tape__canvas"),this._$canvas.appendChild(this._$tapes),this._$canvas.appendChild(this._$marks),this._$canvas.appendChild(this._$holes),this.setNeedsUpdate();const e=super.renderContent();return e.appendChild(this._$canvas),e}layout(){return this.setNeedsUpdate(),super.layout()}update(){const e=this._tape,t=this._tape.length;let i=this._rows;const s=Math.floor((i-1)/2);i++;const n=1.5,r=this._$canvas.getBoundingClientRect().width-32,a=Math.floor((r-22)/fi)+1,l=(r-(a-1)*fi)/2,o=Math.ceil(t/a),h=fi*(i-1)+22,c=h+16,d=o*(h+bi)+bi,u=[],g=[];let p,m,b,f,_;for(f=0;f<t;f++){for(p=e[f],m=bi+l+f%a*fi,b=27+Math.floor(f/a)*c,_=0;_<i;_++)_===s?(g.push(`M ${m-n} ${b+_*fi}`),g.push("a 1.5,1.5 0 1,0 3,0"),g.push("a 1.5,1.5 0 1,0 -3,0")):(1&p&&(g.push(`M ${m-3} ${b+_*fi}`),g.push("a 3,3 0 1,0 6,0"),g.push("a 3,3 0 1,0 -6,0")),p>>=1);f%i===0&&i>=5&&(u.push(`M ${m-n},${b-11+h+8}`),u.push("a 1.5,1.5 0 1,0 3,0"),u.push("a 1.5,1.5 0 1,0 -3,0"))}const w=[];let v,S,C;for(y=0;y<o;y++)v=bi,S=bi+y*c,C=y<o-1||t%a===0?r:t%a*fi+2*l,w.push(`M 16,${S+3}`),w.push("a 3,3 0 0 1 3,-3"),w.push(`L ${16+C-3},${S}`),w.push("a 3,3 0 0 1 3,3"),w.push(`L ${16+C},${S+h-3}`),w.push("a 3,3 0 0 1 -3,3"),w.push(`L 19,${S+h}`),w.push("a 3,3 0 0 1 -3,-3"),w.push("Z");this._$canvas.style.height=`${d}px`,this._$tapes.setAttribute("d",w.join(" ")),this._$marks.setAttribute("d",u.join(" ")),this._$holes.setAttribute("d",g.join(" "))}}const _i={name:"punched-tape",title:"Punched tape",category:"View",type:"viewer"};class wi extends at{static getMeta(){return _i}constructor(){super(),this._viewPrototype=yi,this.addSetting({name:"rows",type:"number",value:8,min:3,max:25,randomizable:!1})}async performView(e){const t=this.getSettingValue("rows"),i=e.getBytes(),s=o.resizeBitSizedArray(i,8,t,!0);this.getView().setTape(s,t)}}const vi={name:"punycode",title:"Punycode",category:"Encoding",type:"encoder"},Si={basicRangeStart:0,basicRangeEnd:127,digitMapping:"abcdefghijklmnopqrstuvwxyz0123456789",delimiter:"-",caseSensitivity:!1,initialBias:72,initialN:128,tmin:1,tmax:26,skew:38,damp:700},Ci="xn--";class Vi extends K{static getMeta(){return vi}constructor(){super(),this._bootstringEncoder=new st,this._bootstringEncoder.setSettingValues(Si)}async performEncode(e){const t=(e=e.toLowerCase()).split("."),i=new Array(t.length);for(let e=0;e<t.length;e++)if(-1===this._nonBasicCodePointIndex(t[e].getCodePoints()))i[e]=t[e];else{const s=await this._bootstringEncoder.encode(t[e]);i[e]=Ci+s.getString()}return w.join(i,".")}async performDecode(e){const t=this._nonBasicCodePointIndex(e.getCodePoints());if(-1!==t)throw new u(`Invalid Punycode character at index ${t}`);const i=e.split("."),s=new Array(i.length);for(let e=0;e<i.length;e++)if(0!==i[e].indexOf(Ci))s[e]=i[e];else{const t=i[e].substr(4);s[e]=await this._bootstringEncoder.decode(t)}return w.join(s,".")}_nonBasicCodePointIndex(e){return e.findIndex(e=>e>=128)}}const ki={name:"rail-fence-cipher",title:"Rail fence cipher",category:"Ciphers",type:"encoder"};class xi extends K{static getMeta(){return ki}constructor(){super(),this.addSettings([{name:"key",type:"number",value:2,integer:!0,min:2,randomizeValue:e=>e.nextInteger(2,8)},{name:"offset",type:"number",value:0,integer:!0,min:0,randomizable:!1}])}performEncode(e){const{key:t,offset:i}=this.getSettingValues(),s=e.getLength(),n=2*t-2,r=new Array(t).fill("");let a,l;for(a=0;a<s;a++)l=t-1-Math.abs(n/2-(a+i)%n),r[l]+=e.getCharAt(a);return r.join("")}performDecode(e){const{key:t,offset:i}=this.getSettingValues(),s=e.getLength(),n=2*t-2,r=new Array(s);let a,l,o=-1;for(l=0;l<t;l++)for(a=0;a<s;a++)(l+a+i)%n!==0&&(l-a-i)%n!==0||(r[a]=e.getCodePointAt(++o));return r}}const Ii={name:"rc4",title:"RC4",category:"Modern cryptography",type:"encoder"};class Ei extends K{static getMeta(){return Ii}constructor(){super(),this.addSettings([{name:"key",type:"bytes",value:new Uint8Array([99,114,121,112,116,105,105]),minSize:1,maxSize:32,randomizeSize:8},{name:"drop",type:"number",label:"Drop bytes",value:0,integer:!0,min:0,randomizable:!1}])}performTranslate(e,t){const i=this.getSettingValue("key"),s=this.getSettingValue("drop"),n=i.length,r=e.getBytes(),a=r.length,l=new Uint8Array(a),o=new Uint8Array(256);for(let e=0;e<256;e++)o[e]=e;let h=0;for(let e=0;e<256;e++)h=(h+o[e]+i[e%n])%256,[o[e],o[h]]=[o[h],o[e]];let c,d=0;h=0;for(let e=0;e<s+a;e++)d=(d+1)%256,h=(h+o[d])%256,[o[d],o[h]]=[o[h],o[d]],c=o[(o[d]+o[h])%256],e>=s&&(l[e-s]=r[e-s]^c);return l}}const Mi={name:"replace",title:"Replace",category:"Transform",type:"encoder"};class Bi extends K{static getMeta(){return Mi}constructor(){super(),this.addSettings([{name:"find",type:"text",value:"",randomizable:!1},{name:"replace",type:"text",value:"",randomizable:!1},{name:"caseSensitivity",type:"boolean",value:!1,randomizable:!1}])}performTranslate(e,t){const i=this.getSettingValue("caseSensitivity");let{find:s,replace:n}=this.getSettingValues();t||([s,n]=[n,s]);let r=e;i||(r=r.toLowerCase(),s=s.toLowerCase()),r=r.getCodePoints(),e=e.getCodePoints(),s=s.getCodePoints(),n=n.getCodePoints();let a=0,l=-1,h=[];for(;-1!==(l=o.indexOfSlice(r,s,l+1));)h=h.concat(e.slice(a,l)),h=h.concat(n),a=l+s.length;return h.concat(e.slice(a))}}const zi={name:"reverse",title:"Reverse",category:"Transform",type:"encoder"};class Li extends K{static getMeta(){return zi}constructor(){super(),this.addSetting({name:"type",label:"By",type:"enum",value:"character",elements:["byte","character","line"],labels:["Byte","Character","Line"],randomizable:!1,style:"radio"})}performTranslate(e,t){switch(this.getSettingValue("type")){case"byte":return e.getBytes().reverse();case"character":return w.join(e.getChars().reverse(),"");case"line":return w.join(e.split(/\r?\n/).reverse(),"\n")}}}const Ti={name:"rot13",title:"ROT13",category:"Ciphers",type:"encoder"};class Ai extends K{static getMeta(){return Ti}constructor(){super(),this.addSetting({name:"variant",type:"enum",value:"rot13",elements:["rot5","rot13","rot18","rot47"],labels:["ROT5 (0-9)","ROT13 (A-Z, a-z)","ROT18 (0-9, A-Z, a-z)","ROT47 (!-~)"],randomizable:!1,style:"radio"})}performTranslate(e,t){const i=this.getSettingValue("variant");return e.getCodePoints().map(e=>("rot5"!==i&&"rot18"!==i||(e=this._rotateCodePoint(e,48,57)),"rot13"!==i&&"rot18"!==i||(e=this._rotateCodePoint(e,97,122),e=this._rotateCodePoint(e,65,90)),"rot47"===i&&(e=this._rotateCodePoint(e,33,126)),e))}_rotateCodePoint(e,t,i){if(e>=t&&e<=i){const s=i-t+1;(e+=s/2)>i&&(e-=s)}return e}}const Pi={name:"spelling-alphabet",title:"Spelling alphabet",category:"Alphabets",type:"encoder"},Ni=[{name:"nato",label:"NATO/ICAO phonetic alphabet",characters:"abcdefghijklmnopqrstuvwxxyz0123456789.",words:["Alfa","Bravo","Charlie","Delta","Echo","Foxtrot","Golf","Hotel","India","Juliett","Kilo","Lima","Mike","November","Oscar","Papa","Quebec","Romeo","Sierra","Tango","Uniform","Victor","Whiskey","X-ray","Xray","Yankee","Zulu","Zero","One","Two","Three","Four","Five","Six","Seven","Eight","Nine","Stop"],spaceWord:"(space)"},{name:"dutch",label:"Dutch spelling alphabet",characters:["a","b","c","d","e","f","g","h","ij","ij","i","j","j","k","l","l","m","n","o","p","q","q","r","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"],words:["Anton","Bernhard","Cornelis","Dirk","Eduard","Ferdinand","Gerard","Hendrik","IJmuiden","IJsbrand","Izaak","Johan","Jacob","Karel","Lodewijk","Leo","Maria","Nico","Otto","Pieter","Quirinius","Quinten","Richard","Rudolf","Simon","Theodoor","Utrecht","Victor","Willem","Xantippe","Ypsilon","Zacharias","Nul","Een","Twee","Drie","Vier","Vijf","Zes","Zeven","Acht","Negen"],spaceWord:"(spatiebalk)"},{name:"german",label:"German spelling alphabet",characters:"abcdefghijkklmnopqrsstuvwxxyzzäööüüßß0123456789",words:["Anton","Berta","Cäsar","Dora","Emil","Friedrich","Gustav","Heinrich","Ida","Julius","Kaufmann","Konrad","Ludwig","Martha","Nordpol","Otto","Paula","Quelle","Richard","Samuel","Siegfried","Theodor","Ulrich","Viktor","Wilhelm","Xanthippe","Xaver","Ypsilon","Zacharias","Zürich","Ärger","Ökonom","Österreich","Übermut","Übel","Eszett","Scharfes S","Null","Eins","Zwei","Drei","Vier","Fünf","Sechs","Sieben","Acht","Neun"],spaceWord:"(Leertaste)"},{name:"swedish",label:"Swedish Armed Forces' radio alphabet",characters:"abcdefghijklmnopqrstuvwxyzåäö0123456789",words:["Adam","Bertil","Caesar","David","Erik","Filip","Gustav","Helge","Ivar","Johan","Kalle","Ludvig","Martin","Niklas","Olof","Petter","Qvintus","Rudolf","Sigurd","Tore","Urban","Viktor","Wilhelm","Xerxes","Yngve","Zäta","Åke","Ärlig","Östen","Nolla","Ett","Tvåa","Trea","Fyra","Femma","Sexa","Sju","Åtta","Nia"],spaceWord:"(mellanslag)"},{name:"russian",label:"Russian spelling alphabet (official, excludes Ё)",characters:"абвгдежзийклмнопрстуфхцчшщъыьэюя0123456789.",words:["Анна","Борис","Василий","Григорий","Дмитрий","Елена","Женя","Зинаида","Иван","Иван краткий","Константин","Леонид","Михаил","Николай","Ольга","Павел","Роман","Семён","Татьяна","Ульяна","Фёдор","Харитон","Цапля","Человек","Шура","Щука","Твёрдый знак","Еры","Мягкий знак","Эхо","Юрий","Яков","Ноль","Один","Два","Три","Четыре","Пять","Шесть","Семь","Восемь","Девять","Точка"],spaceWord:"(пробел)"},{name:"russian-unofficial",label:"Russian spelling alphabet (unofficial, includes Ё)",characters:"абвгдеёжзийклмнопрстуфхцчшщъыьэюя0123456789.",words:["Антон","Борис","Василий","Галина","Дмитрий","Елена","Ёлка","Жук","Зоя","Иван","Йот","Киловатт","Леонид","Мария","Николай","Ольга","Павел","Радио","Сергей","Тамара","Ульяна","Фёдор","Харитон","Центр","Человек","Шура","Щука","Твёрдый знак","Игрек","Мягкий знак","Эмма","Юрий","Яков","Ноль","Один","Два","Три","Четыре","Пять","Шесть","Семь","Восемь","Девять","Точка"],spaceWord:"(пробел)"}];class $i extends K{static getMeta(){return Pi}constructor(){super(),this._characterMap={},this._wordMap={},this.addSetting({name:"alphabet",type:"enum",elements:Ni.map(e=>e.name),labels:Ni.map(e=>e.label),randomizable:!1,style:"radio"}),this.buildTranslationMap()}performTranslate(e,t){const i=c.normalizeWhitespaces(e.getString()),s=t?this._characterMap:this._wordMap,n=Object.keys(s).sort((e,t)=>t.length-e.length);let r=0;const a=[];for(;r<i.length;){const e=n.find(e=>i.substr(r,e.length).toLowerCase()===e.toLowerCase());if(void 0!==e)a.push(s[e]),r+=e.length;else{const e=i.substr(r,1);(t||" "!==e)&&a.push(e),r++}}return a.join(t?" ":"")}settingValueDidChange(e,t){if("alphabet"===e.getName())this.buildTranslationMap()}buildTranslationMap(){const e=this.getSettingValue("alphabet"),t=Ni.find(t=>t.name===e);if(void 0===t)throw new Error(`Alphabet with name '${e}' is not defined`);const i="string"==typeof t.characters?t.characters.split(""):t.characters,s=t.words,n={};i.forEach((e,t)=>{void 0===n[e]&&(n[e]=s[t])});const r={};s.forEach((e,t)=>{e=e.toLowerCase(),void 0===r[e]&&(r[e]=i[t])});const a=t.spaceWord||"(space)";return n[" "]=a,r[a]=" ",this._characterMap=n,this._wordMap=r,this}}const Di={name:"stress-deletion",title:"Stress Deletion",category:"Transform",type:"encoder"},Fi={"è":"e","é":"e","à":"a","á":"a","ò":"o","ó":"o","í":"i","ì":"i","ù":"u","ú":"u","Á":"A","À":"A","È":"E","É":"E","Í":"I","Ì":"I","Ò":"O","Ó":"O","Ú":"U","Ù":"U"};class Oi extends K{static getMeta(){return Di}constructor(){super()}performTranslate(e,t){let i=e.getString().replace(/è|é|à|á|ò|ó|í|ì|ù|ú|Á|À|È|É|Í|Ì|Ò|Ó|Ú|Ù/g,function(e){return Fi[e]});return new w(i).getCodePoints()}settingValueDidChange(e,t){}}const Ri={name:"tap-code",title:"Tap code",category:"Polybius square ciphers",type:"encoder"};class qi extends K{static getMeta(){return Ri}constructor(){super(),this.addSettings([{name:"tapMark",label:"Tap",type:"text",width:4,value:".",minLength:1,randomizable:!1},{name:"groupMark",label:"Group",type:"text",width:4,value:" ",minLength:1,randomizable:!1},{name:"letterMark",label:"Letter",type:"text",width:4,value:"  ",minLength:1,randomizable:!1}]),this._polybiusSquare=new te,this._polybiusSquare.setSettingValues({alphabet:"abcdefghijlmnopqrstuvwxyz",rows:"12345",columns:"12345",separator:"",caseSensitivity:!1,includeForeignChars:!1})}async performEncode(e){const t=this.getSettingValue("tapMark").getString(),i=this.getSettingValue("groupMark").getString(),s=this.getSettingValue("letterMark").getString(),n=await this._polybiusSquare.encode(e.getString().replace(/k/gi,"c")),r=n.getLength()/2;let a,l,o="";for(let e=0;e<r;e++)a=parseInt(n.getCharAt(2*e)),l=parseInt(n.getCharAt(2*e+1)),o+=(e>0?s:"")+t.repeat(a)+i+t.repeat(l);return o}performDecode(e){const t=this.getSettingValue("tapMark").getCodePoints(),i=t.length,s=e.getCodePoints();let n="",r=0,a=-1,l=0;for(;-1!==(a=o.indexOfSlice(s,t,a+1));)0===r||a===r+i?l++:(n+=l.toString(),l=1),r=a;return n+=l.toString(),this._polybiusSquare.decode(n)}}const Ui={name:"text",title:"Text",category:"View",type:"viewer"};class ji extends at{static getMeta(){return Ui}constructor(){super(),this._viewPrototype=rt}async performView(e){this.getView().setText(e.getString())}viewTextDidChange(e,t){this.dare(()=>{this.contentDidChange(w.wrap(t))})}}const Wi={name:"trifid-cipher",title:"Trifid cipher",category:"Polybius square ciphers",type:"encoder"},Hi="abcdefghijklmnopqrstuvwxyz+";class Gi extends K{static getMeta(){return Wi}constructor(){super(),this.addSettings([{name:"key",type:"text",value:"",uniqueChars:!0,minLength:0,maxLength:27,caseSensitivity:!1},{name:"groupSize",type:"number",value:5,min:2}])}async performEncode(e){const{key:t,groupSize:i}=this.getSettingValues(),s=w.wrap(t).extend(Hi).getCodePoints(),n=e.toLowerCase().getCodePoints().map(e=>s.indexOf(e)).filter(e=>-1!==e),r=n.length,a=new Array(3*r);let l,o,h,c,d,u;for(l=0;l<r;l++)for(c=Math.floor(l/i),d=l-c*i,u=Math.min(i,r-c*i),h=this.cartesianCoordinatesFromIndex(n[l]),o=0;o<3;o++)a[d+c*i*3+u*o]=h[o];const g=new Array(r);for(l=0;l<r;l++)h=a.slice(3*l,3*(l+1)),d=this.indexFromCartesianCoordinates(h),g[l]=s[d];return g}async performDecode(e){const{key:t,groupSize:i}=this.getSettingValues(),s=w.wrap(t).extend(Hi).getCodePoints(),n=e.toLowerCase().getCodePoints().map(e=>s.indexOf(e)).filter(e=>-1!==e),r=n.length,a=new Array(3*r);let l,o,h;for(l=0;l<r;l++)for(h=this.cartesianCoordinatesFromIndex(n[l]),o=0;o<3;o++)a[3*l+o]=h[o];const c=new Array(r);let d,u,g;for(l=0;l<r;l++){for(d=Math.floor(l/i),u=l-d*i,g=Math.min(i,r-d*i),o=0;o<3;o++)h[o]=a[u+d*i*3+g*o];u=this.indexFromCartesianCoordinates(h),c[l]=s[u]}return c}cartesianCoordinatesFromIndex(e){let t=Math.floor(e/9),i=Math.floor((e-9*t)/3);return[t+1,i+1,e-9*t-3*i+1]}indexFromCartesianCoordinates([e,t,i]){return 9*(e-1)+3*(t-1)+(i-1)}}const Ki={name:"unicode-code-points",title:"Unicode code points",category:"Encoding",type:"encoder"};class Zi extends Z{static getMeta(){return Ki}constructor(){super(),this.setCharacterToBlockMode(),this.addSetting({name:"format",type:"enum",value:"unicode",elements:["unicode","decimal","hexadecimal","binary","octal","ncr-decimal","ncr-hexadecimal"],labels:["Unicode notation","Decimal","Hexadecimal","Binary","Octal","NCR (Decimal)","NCR (Hexadecimal)"],randomizable:!1,style:"radio"})}performCharEncodeToBlock(e,t,i){switch(this.getSettingValue("format")){case"unicode":return"U+"+e.toString(16).toUpperCase();case"decimal":return e.toString(10);case"hexadecimal":return e.toString(16);case"binary":return e.toString(2);case"octal":return e.toString(8);case"ncr-decimal":return`&#${e.toString(10)};`;case"ncr-hexadecimal":return`&#x${e.toString(16)};`}}performBlockDecodeToChar(e,t,i,s){let n,r=0;switch(this.getSettingValue("format")){case"unicode":n=e.match(/^U\+([0-9A-F]+)$/i),null!==n&&(r=parseInt(n[1],16));break;case"decimal":r=parseInt(e,10);break;case"hexadecimal":r=parseInt(e,16);break;case"binary":r=parseInt(e,2);break;case"octal":r=parseInt(e,8);break;case"ncr-decimal":case"ncr-hexadecimal":n=e.match(/^&#x([0-9A-F]+);$/i),null!==n?r=parseInt(n[1],16):(n=e.match(/^&#([0-9]+);$/),null!==n&&(r=parseInt(n[1],10)))}if(!f.validateCodePoint(r))throw new u(`Invalid code point at index ${t}`);return r}}const Xi={name:"url-encoding",title:"URL encoding",category:"Encoding",type:"encoder"},Yi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_.~";class Ji extends K{static getMeta(){return Xi}performEncode(e){try{const t=e.getChars();let i,s="";for(let n=0;n<t.length;n++)i=t[n],s+=-1===Yi.indexOf(i)?this.encodeBytes(e.getCharBytesAt(n)):i;return s}catch(t){if(t instanceof b)return this.encodeBytes(e.getBytes());throw t}}encodeBytes(e){let t="";for(let i=0;i<e.length;i++)t+="%"+("0"+e[i].toString(16)).slice(-2);return t}performDecode(e){const t=e.getString(),i=[];let s,n,r=0;for(;r<t.length;)if(s=t[r],"%"===s){if(n=t.substr(r+1,2),null===n.match(/[0-9a-f]{2}/i))throw new u(`Invalid percent-encoded byte '%${n}' at index ${r}`);i.push(parseInt(n,16)),r+=3}else if("+"===s)i.push(32),r++;else{if(-1===Yi.indexOf(s))throw new u(`Invalid character '${s}' at index ${r}`);i.push(s.charCodeAt(0)),r++}return new Uint8Array(i)}}const Qi={name:"vigenere-cipher",title:"Vigenère cipher",category:"Ciphers",type:"encoder"},es="abcdefghijklmnopqrstuvwxyz",ts="abcdefghilmnopqrstuvz",is=es;class ss extends K{static getMeta(){return Qi}constructor(){super(),this.addSettings([{name:"variant",type:"enum",value:"standard",elements:["standard","beaufort-cipher","variant-beaufort-cipher","trithemius-cipher"],labels:["Standard Vigenère cipher","Beaufort cipher","Variant Beaufort cipher","Trithemius cipher"],randomizable:!1},{name:"key",type:"text",value:"cryptii",whitelistChars:is,minLength:2,caseSensitivity:!1},{name:"keyMode",type:"enum",value:"repeat",elements:["repeat","autokey"],labels:["Repeat","Autokey"],randomizable:!1},{name:"language",type:"enum",value:"english",elements:["english","italian","other"],labels:["English","Italian","Other"],width:6,randomizable:!1},{name:"alphabet",type:"text",value:is,uniqueChars:!0,minLength:2,caseSensitivity:!1,randomizable:!1},{name:"caseStrategy",type:"enum",value:"maintain",elements:["maintain","ignore","strict"],labels:["Maintain case","Ignore case","Strict (A ≠ a)"],width:6,randomizable:!1},{name:"includeForeignChars",type:"boolean",label:"Foreign Chars",width:6,value:!0,randomizable:!1,trueLabel:"Include",falseLabel:"Ignore"}])}performTranslate(e,t){const{variant:i,caseStrategy:s,includeForeignChars:n}=this.getSettingValues();let r,a=this.getSettingValue("alphabet");"strict"!==s&&(a=a.toLowerCase(),r=a.toUpperCase());let{key:l,keyMode:o}=this.getSettingValues();"trithemius-cipher"===i&&(l=a,o="repeat");const h=e.getLength(),c=new Array(h);let d,u,g,p,m,b=0,f=0;for(let y=0;y<h;y++)if(u=e.getCodePointAt(y),d=a.indexOfCodePoint(u),g=!1,-1===d&&"strict"!==s&&(d=r.indexOfCodePoint(u),g=!0),-1!==d){switch(p=l.getCodePointAt(G.mod(f,l.getLength())),m=a.indexOfCodePoint(p),i){case"beaufort-cipher":d=m-d;break;case"variant-beaufort-cipher":d=t?d-m:d+m;break;default:d=t?d+m:d-m}d=G.mod(d,a.getLength()),c[b++]="maintain"===s&&g?r.getCodePointAt(d):a.getCodePointAt(d),"autokey"===o&&(p=t?u:a.getCodePointAt(d),l=w.join([l,w.wrap([p]).toLowerCase()],"")),f++}else n&&(c[b++]=u);return c.slice(0,b)}settingValueDidChange(e,t){switch(e.getName()){case"variant":this.getSetting("key").setVisible("trithemius-cipher"!==t),this.getSetting("keyMode").setVisible("trithemius-cipher"!==t);break;case"alphabet":t!=es&&t!=ts&&this.getSetting("language").setValue("other"),this.getSetting("key").setWhitelistChars(t);break;case"caseStrategy":this.getSetting("alphabet").setCaseSensitivity("strict"===t),this.getSetting("key").setCaseSensitivity("strict"===t);break;case"language":"english"==t?this.getSetting("alphabet").setValue(es):"italian"==t&&(console.log("italian"),this.getSetting("alphabet").setValue(ts))}}}let ns=null;class rs extends r{constructor(){super();[ji,ot,wi,Bi,Li,vt,mi,De,Je,Xe,Oi,ri,$i,At,_t,de,et,Ai,Q,ss,Se,be,xi,te,ae,Pe,oi,qi,Gi,ke,Me,_e,Le,Zi,Ji,Vi,st,Yt,ti,xt,Ke,Ei,jt,Ht].forEach(this.register.bind(this))}register(e){const t=e.getMeta().name;return super.register(t,e)}getMeta(e){return this.getInvokable(e).getMeta()}getLibrary(){return this.getIdentifiers().map(e=>this.getMeta(e))}static getInstance(){return null===ns&&(ns=new rs),ns}}class as extends s{constructor(e){super(),this._title=e,this._$trigger=null,this._visible=!1,this._value=null,this._finishCallback=null,this._cancelCallback=null,this._keyUpHandler=this.keyDidPress.bind(this),this._$outer=null,this._$dialog=null}isVisible(){return this._visible}setVisible(e=!0,t=!1){if(this._visible!==e){this._visible=e;const i=this.getElement();e&&(document.body.appendChild(i),this._$trigger=document.activeElement);const s=this._$dialog.getBoundingClientRect().height;e?this._$dialog.style.height="0px":(this._$dialog.style.height=`${s}px`,this._$outer.style.height=`${s}px`),i.getBoundingClientRect(),i.addEventListener("transitionend",()=>{setTimeout(this.visibilityDidChange.bind(this,e,t),100)},{once:!0}),e?(document.body.classList.add("modal-visible"),i.classList.add("modal--visible"),this._$dialog.style.height=`${s}px`,this._keyUpHandler&&document.addEventListener("keyup",this._keyUpHandler)):(document.body.classList.remove("modal-visible"),i.classList.remove("modal--visible"),this._$dialog.style.height="0px",this._keyUpHandler&&document.removeEventListener("keyup",this._keyUpHandler))}return this}visibilityDidChange(e,t){e?(this._$dialog.removeAttribute("style"),this.getElement().focus()):(setTimeout(()=>{this._$dialog.removeAttribute("style"),this._$outer.removeAttribute("style");const e=this.getElement();null!==e.parentNode&&e.parentNode.removeChild(e)},100),!1===t&&null!==this._finishCallback?this._finishCallback(this._value):!0===t&&null!==this._cancelCallback&&this._cancelCallback(),this._$trigger&&(this._$trigger.focus(),this._$trigger=null),this._finishCallback=null,this._cancelCallback=null)}getValue(){return this._value}setValue(e){return this._value!==e&&(this._value=e,this.valueDidChange(e)),this}valueDidChange(e){}prompt(e=void 0){return void 0!==e&&this.setValue(e),new Promise((e,t)=>{this._finishCallback=e,this._cancelCallback=t,this.open()})}open(){return this.setVisible(!0)}cancel(){return this.setVisible(!1,!0)}finish(e=void 0){return void 0!==e&&this.setValue(e),this.setVisible(!1,!1)}render(){return this._$dialog=this.renderDialog(),this._$outer=s.createElement("div",{className:"modal__outer"},[this._$dialog]),s.createElement("div",{className:"modal",role:"dialog",tabIndex:-1},[s.createElement("div",{className:"modal__backdrop"}),s.createElement("div",{className:"modal__scrollable",role:"document",onClick:e=>{e.target===e.currentTarget&&(e.preventDefault(),this.cancel())}},[this._$outer])])}renderDialog(){return s.createElement("div",{className:"modal__dialog"},[this.renderHeader(),this.renderContent()])}renderHeader(){const e=s.createElement("button",{className:"modal__btn-close",onClick:e=>{e.preventDefault(),this.cancel()}});return e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M15 2.41L13.59 1 8 6.59 2.41 1 1 2.41 6.59 8 1 13.59 2.41 15 8 9.41 13.59 15 15 13.59 9.41 8z"/></svg>',s.createElement("header",{className:"modal__header"},[s.createElement("span",{className:"modal__title"},this._title),e])}renderContent(){}keyDidPress(e){27===e.keyCode&&(e.preventDefault(),this.cancel())}}class ls extends as{constructor(e){super("Library"),this._library=e,this._filteredLibrary=e,this._categories={}}clearFilter(){return this._filteredLibrary=this._library,this.refresh(),this}applyFilter(e){return this._filteredLibrary=this._library.filter(e),this.refresh(),this}render(){const e=super.render();return e.classList.add("modal-library"),e}renderContent(){return s.createElement("div",{className:"modal__content"},[this.renderBricks()])}renderBricks(){const e=[],t=[];return this._filteredLibrary.forEach(i=>{const s=e.indexOf(i.category);-1===s?(e.push(i.category),t.push([i])):t[s].push(i)}),s.createElement("ul",{className:"modal-library__categories"},e.map((e,i)=>s.createElement("li",{className:"modal-library__category"},[s.createElement("span",{className:"modal-library__category-title"},e),s.createElement("ul",{className:"modal-library__bricks"},t[i].map(this.renderBrick.bind(this)))])))}renderBrick(e){return s.createElement("li",{},[s.createElement("button",{className:"modal-library__brick modal-library__brick--"+e.type,onClick:t=>{t.preventDefault(),this.finish(e.name)}},[s.createElement("span",{className:"modal-library__brick-title"},e.title)])])}}const os="pipe__scroll-handle--disabled",hs="application/vnd.cryptii.brick+json";class cs extends s{constructor(){super(),this._$scrollable=null,this._$content=null,this._draggingBrickView=null,this._draggingTargetIndex=null,this._$pipeParts=[],this._pipePartPositions=[],this._pipePartIndex=[],this._scrollMax=0,this._scrollPosition=0,this._scrollHandleIndex=null,this._scrollHandleStartPosition=null,this._scrollHandleStartTime=null}render(){this._$content=s.createElement("div",{className:"pipe__content"}),this._$scrollHandleLeft=s.createElement("div",{className:"pipe__scroll-handle pipe__scroll-handle--left pipe__scroll-handle--disabled",onMouseEnter:this.scrollHandleDidStart.bind(this,0),onDragEnter:this.scrollHandleDidStart.bind(this,0),onMouseLeave:this.scrollHandleDidStop.bind(this),onDragLeave:this.scrollHandleDidStop.bind(this)}),this._$scrollHandleRight=s.createElement("div",{className:"pipe__scroll-handle pipe__scroll-handle--right",onMouseEnter:this.scrollHandleDidStart.bind(this,1),onDragEnter:this.scrollHandleDidStart.bind(this,1),onMouseLeave:this.scrollHandleDidStop.bind(this),onDragLeave:this.scrollHandleDidStop.bind(this)});let e=document.querySelector(".pipe");return null===e&&(e=s.createElement("div"),e.classList.add("pipe")),e.ondrop=this.dragDidDrop.bind(this),e.ondragenter=this.dragDidEnterPipe.bind(this),e.ondragover=this.dragDidOverPipe.bind(this),this._$scrollable=e.querySelector(".pipe__scrollable"),null===this._$scrollable&&(this._$scrollable=s.createElement("div",{className:"pipe__scrollable"})),this._$scrollable.appendChild(this._$content),this._$scrollable.appendChild(this._$scrollHandleLeft),this._$scrollable.appendChild(this._$scrollHandleRight),e.appendChild(this._$scrollable),e.addEventListener("wheel",this.mouseDidWheel.bind(this)),e}appendSubviewElement(e){return e instanceof k?(this.update(),this):super.appendSubviewElement(e)}removeSubviewElement(e){return super.removeSubviewElement(e),e instanceof k&&this.update(),this}update(){const e=this.getModel().getBricks(),t=e.map(e=>e.getView());this.getElement();const i=this._$content;let s;t.forEach(e=>{const t=e.getElement();t.parentNode&&t.parentNode.removeChild(t)}),i.innerHTML="",this._$pipeParts=[],this._pipePartIndex=[];let n=[];for(let r=0;r<e.length;r++)if(e[r].isHidden()){if(n.push(e[r]),r+1===e.length||!e[r+1].isHidden()){const e=r-n.length+1;s=this._createPipePart(e),this._$pipeParts.push(s),this._pipePartIndex.push(e),i.appendChild(s),i.appendChild(this._createCollapsedPart(n)),n=[]}}else s=this._createPipePart(r),this._$pipeParts.push(s),this._pipePartIndex.push(r),i.appendChild(s),i.appendChild(this._createBrickPart(t[r]));return s=this._createPipePart(t.length),this._$pipeParts.push(s),this._pipePartIndex.push(t.length),i.appendChild(s),this.layout(),this}_createPipePart(e){return s.createElement("button",{className:"pipe__part-pipe",onClick:t=>{this.getModel().viewAddButtonDidClick(this,e),t.preventDefault()}},[s.createElement("div",{className:"pipe__btn-add"},"Add encoder or viewer"),s.createElement("div",{className:"pipe__drop-handle"})])}_createBrickPart(e){const t=e.getModel()instanceof K?"encoder":"viewer";return s.createElement("div",{className:`pipe__part-brick pipe__part-brick--${t}`,draggable:!0,onMouseDown:this.brickDragWillStart.bind(this,e),onDragStart:this.brickDragDidStart.bind(this,e),onDragEnd:this.brickDragDidEnd.bind(this,e)},e.getElement())}_createCollapsedPart(e){return s.createElement("button",{className:"pipe__part-collapsed",onClick:t=>{this.getModel().viewHiddenBrickGroupDidClick(this,e),t.preventDefault()}},e.map(()=>s.createElement("div",{className:"pipe__part-collapsed-fold"})))}isBrickDragEvent(e){const t=e.dataTransfer.types;return void 0!==t.contains?t.contains(hs):-1!==t.indexOf(hs)}isFieldMouseEvent(e){const t=e.target.nodeName.toLowerCase();return-1!==["textarea","input"].indexOf(t)}brickDragWillStart(e,t){if(this.isFieldMouseEvent(t)||!e.getModel().isValid()){const t=e.getElement().parentNode;t&&(t.draggable=!1,setTimeout(()=>{t.draggable=!0},500))}}brickDragDidStart(e,t){if(this.isFieldMouseEvent(t)||!e.getModel().isValid())return;this._draggingBrickView=e;const i=JSON.stringify(e.getModel().serialize());t.dataTransfer.setData(hs,i),t.dataTransfer.setData("application/json",i),t.dataTransfer.effectAllowed="copyMove"}brickDragDidEnd(e,t){this._draggingBrickView=null,this.setDraggingPipePartIndex(null)}dragDidEnterPipe(e){this.isBrickDragEvent(e)&&e.preventDefault()}dragDidOverPipe(e){if(this.isBrickDragEvent(e)){e.preventDefault();const t=e.pageX+this._scrollPosition,i=e.pageY;let s=null,n=0;this._pipePartPositions.forEach((e,r)=>{const a=Math.sqrt(Math.pow(t-e.x,2)+Math.pow(i-e.y,2));(null===s||a<s)&&(s=a,n=r)}),this.setDraggingPipePartIndex(n)}}dragDidDrop(e){if(this.isBrickDragEvent(e)){e.preventDefault();const t="copy"===e.dataTransfer.effectAllowed,i=this._pipePartIndex[this._draggingTargetIndex];if(this.setDraggingPipePartIndex(null),null!==this._draggingBrickView){const e=this._draggingBrickView.getModel();this.getModel().viewBrickDidDrop(this,i,e,t)}else{const s=JSON.parse(e.dataTransfer.getData(hs));this.getModel().viewBrickDidDrop(this,i,s,t)}}}setDraggingPipePartIndex(e){this._draggingTargetIndex!==e&&(null!==this._draggingTargetIndex&&this._$pipeParts[this._draggingTargetIndex].classList.remove("pipe__part-pipe--dragging"),this._draggingTargetIndex=e,null!==e?(this._$pipeParts[this._draggingTargetIndex].classList.add("pipe__part-pipe--dragging"),this.getElement().classList.add("pipe--dragging")):this.getElement().classList.remove("pipe--dragging"))}mouseDidWheel(e){const t=e.deltaX,i=e.deltaY;Math.abs(t)<=Math.abs(i)||(e.preventDefault(),this.scrollTo(this._scrollPosition+t))}scrollHandleDidStart(e){this._scrollHandleIndex=e,this._scrollHandleStartPosition=this._scrollPosition,this._scrollHandleStartTime=(new Date).getTime(),window.requestAnimationFrame(this.scrollHandleDidScroll.bind(this))}scrollHandleDidScroll(){if(null===this._scrollHandleIndex)return;const e=0===this._scrollHandleIndex?-1:1,t=((new Date).getTime()-this._scrollHandleStartTime)/1e3,i=e*Math.pow(t,2)*1e3;this.scrollTo(this._scrollHandleStartPosition+i),window.requestAnimationFrame(this.scrollHandleDidScroll.bind(this))}scrollHandleDidStop(){this._scrollHandleIndex=null,this._scrollHandleStartPosition=null,this._scrollHandleStartTime=null}layout(){super.layout(),this._scrollMax=this._$content.offsetWidth-this._$scrollable.offsetWidth,this.scrollTo(this._scrollPosition),0===this._scrollPosition?this._$scrollHandleLeft.classList.add(os):this._$scrollHandleLeft.classList.remove(os),this._scrollPosition===this._scrollMax?this._$scrollHandleRight.classList.add(os):this._$scrollHandleRight.classList.remove(os);const e=window.scrollY;this._pipePartPositions=this._$pipeParts.map(t=>{const i=t.getBoundingClientRect();return{x:i.left+.5*i.width+this._scrollPosition,y:i.top+.5*i.height+e}})}scrollTo(e=0){return e=parseInt(e),e=Math.max(Math.min(e,this._scrollMax),0),this._scrollPosition!==e&&(0===e?(this._$scrollHandleLeft.classList.add(os),this.scrollHandleDidStop()):0===this._scrollPosition&&this._$scrollHandleLeft.classList.remove(os),e===this._scrollMax?(this._$scrollHandleRight.classList.add(os),this.scrollHandleDidStop()):this._scrollPosition===this._scrollMax&&this._$scrollHandleRight.classList.remove(os),this._$content.style.transform=e>0?`translate(${-e}px, 0)`:"",this._scrollPosition=e),this}}class ds extends E{constructor(){super(),this._viewPrototype=cs,this._brickFactory=null,this._service=null,this._id=null,this._url=null,this._title=null,this._description=null,this._bricks=[],this._brickState=[],this._bucketContent=[w.empty()],this._bucketListeners=[[]],this._selectedBucket=0,this._libraryModalView=null}getId(){return this._id}setId(e){return this._id=e,this}getUrl(){return this._url}setUrl(e){return this._url=e,this}getTitle(){return this._title}setTitle(e){return this._title=e,this}getDescription(){return this._description}setDescription(e){return this._description=e,this}getBrickFactory(){return this._brickFactory}setBrickFactory(e){return this._brickFactory=e,this}getService(){return this._service}setService(e){return this._service=e,this}getLibraryModalView(){if(null===this._libraryModalView){const e=this.getBrickFactory().getLibrary();this._libraryModalView=new ls(e)}return this._libraryModalView}getLength(){return this._bricks.length}getBricks(){return this._bricks.slice()}getBrick(e){if(e<0||e>this._bricks.length)throw new Error("Brick index is out of bounds.");return this._bricks[e]}containsBrick(e){return-1!==this._bricks.indexOf(e)}addBrick(e){return this.spliceBricks(-1,0,[e]),this}addBricks(e){return this.spliceBricks(-1,0,e),this}duplicateBrick(e,t=null){if(!this.containsBrick(e))throw new Error("Brick is not part of the pipe.");return null===t&&(t=this._bricks.indexOf(e)),this.spliceBricks(t,0,[e.copy()]),this}moveBrick(e,t){const i=this._bricks.indexOf(e);if(-1===i)throw new Error("Brick is not part of the pipe.");return t>i&&t--,this.spliceBricks(i,1),this.spliceBricks(t,0,[e]),this}removeBrick(e){let t=e;if(e instanceof W&&(t=this._bricks.indexOf(e),-1===t))throw new Error("Brick is not part of the pipe and thus can't be removed.");return this.spliceBricks(t,1),this}removeBricks(e){return e.map(e=>{let t=e;if(e instanceof W&&(t=this._bricks.indexOf(e),-1===t))throw new Error("Brick is not part of the pipe and thus can't be removed.");return t}).sort((e,t)=>t-e).forEach(e=>this.spliceBricks(e,1)),this}replaceBrick(e,t){const i=this._bricks.indexOf(e);if(-1===i)throw new Error("Can't replace a brick not being part of the pipe.");return this.spliceBricks(i,1,[t]),this}spliceBricks(e,t,i=[]){e=e>=0?e:Math.max(this._bricks.length+e+1,0),this._bucketListeners.map(e=>(e.forEach(e=>e.reject("Pipe bricks have been changed.")),[])),i=i.map(e=>e instanceof W?e:W.extract(e,this.getBrickFactory()));const s=this._bricks.splice.apply(this._bricks,[e,t].concat(i));this._brickState.splice.apply(this._brickState,[e,t].concat(i.map(()=>({settingsVersion:1,busy:!1}))));let n=0,r=0;if(i.forEach(e=>{e.setPipe(this),this.hasView()&&this.getView().addSubview(e.getView()),e instanceof K&&n++,I.trigger("pipeAddBrick",{pipe:this,brick:e})}),s.forEach(e=>{this.hasView()&&this.getView().removeSubview(e.getView()),e.setPipe(null),e instanceof K&&r++,I.trigger("pipeRemoveBrick",{pipe:this,brick:e})}),n>0||r>0){let t=this._bricks.reduce((t,i,s)=>t+(i instanceof K&&s<=e?1:0),0);0===t&&(t=1);const i=new Array(n).fill().map(()=>w.empty()),s=this._bucketContent.splice.apply(this._bucketContent,[t,r].concat(i));if(this._bucketListeners.splice.apply(this._bucketListeners,[t,r].concat(i.map(e=>[]))),this._selectedBucket<=t-1)this._propagateContent(t-1,!0);else if(this._selectedBucket===t&&1===r&&1===n)this._bucketContent[this._selectedBucket]=s[0],this._propagateContent(this._selectedBucket,!1);else if(this._selectedBucket<=t-1+r)this._selectedBucket=t-1,this._propagateContent(this._selectedBucket,!0);else{const e=n-r;this._selectedBucket+=e,this._propagateContent(t+n,!1)}}else i.forEach(e=>this._triggerViewerView(e));return this.hasView()&&this.getView().layout(),s}getBucketLength(){return this._bucketContent.length}getContent(e=0,t=!0){if(e>=this._bucketContent.length)throw new Error(`Bucket index ${e} is out of bounds.`);return t&&this.isBusy()?new Promise((t,i)=>{this._bucketListeners[e].push({resolve:t,reject:i})}):this._bucketContent[e]}setContent(e,t=0,i=null){return e=w.wrap(e),this.getContent(t,!1).isEqualTo(e)||(this._bucketContent[t]=e,(null===i||i instanceof at)&&(this._selectedBucket=t),this._propagateContent(t,i)),this}_propagateContent(e,t=null){const{lowerEncoder:i,upperEncoder:s,viewers:n}=this.getBricksAttachedToBucket(e);return n.filter(e=>e!==t).forEach(this._triggerViewerView.bind(this)),null!==i&&!0!==t&&i!==t&&this._triggerEncoderTranslation(i,!1),null!==s&&!1!==t&&s!==t&&this._triggerEncoderTranslation(s,!0),this}async _triggerViewerView(e){if(this._getBrickState(e,"busy"))return this;this._setBrickState(e,"busy",!0);const t=this.getBucketIndexForBrick(e),i=this.getContent(t,!1),s=this._getBrickState(e,"settingsVersion");let n;try{await e.view(i)}catch(e){n=e}if(!this.containsBrick(e))return;this._setBrickState(e,"busy",!1);const r=this._getBrickState(e,"settingsVersion"),a=this.getBucketIndexForBrick(e);if(this.getContent(a,!1).isEqualTo(i)&&s===r||this._triggerViewerView(e),this.brickDidFinish(e,n),n&&!(n instanceof u))throw n}async _triggerEncoderTranslation(e,t){if(this._getBrickState(e,"busy"))return this;this._setBrickState(e,"busy",!0);const i=this.getBucketIndexForBrick(e),s=this.getContent(i+(t?0:1),!1),n=this._getBrickState(e,"settingsVersion");let r,a;try{r=await e.translate(s,t)}catch(e){a=e}if(!this.containsBrick(e))return;this._setBrickState(e,"busy",!1);const l=this._getBrickState(e,"settingsVersion"),o=this.getBucketIndexForBrick(e),h=o+(t?0:1),c=this.getContent(h,!1),d=o+(t?1:0);if(t&&this._selectedBucket>=d||!t&&this._selectedBucket<=d)this._triggerEncoderTranslation(e,!t);else if(a||this.setContent(r,d,e),c.isEqualTo(s)&&n===l||this._triggerEncoderTranslation(e,t),this.brickDidFinish(e,a),a&&!(a instanceof u))throw a}_getBrickState(e,t){const i=this._bricks.indexOf(e);if(-1===i)throw new Error("Brick is not part of the pipe and thus has no state.");return this._brickState[i][t]}_setBrickState(e,t,i){const s=this._bricks.indexOf(e);if(-1===s)throw new Error("Brick is not part of the pipe and thus has no state.");return this._brickState[s][t]=i,this}isBusy(){return this._bricks.reduce((e,t)=>e||this._getBrickState(t,"busy"),!1)}getBucketIndexForBrick(e){let t=!1,i=0,s=-1;for(;!t&&++s<this._bricks.length;)this._bricks[s]===e?t=!0:this._bricks[s]instanceof K&&i++;if(!t)throw new Error("Can't find bucket for brick. Brick is not part of Pipe.");return i}getBricksAttachedToBucket(e){let t=null,i=null;const s=[];let n,r=0,a=-1;for(;++a<this._bricks.length&&r<=e;)n=this._bricks[a],n instanceof K?(r===e-1?t=n:r===e&&(i=n),r++):r===e&&s.push(n);return{lowerEncoder:t,upperEncoder:i,viewers:s}}viewerContentDidChange(e,t){if(!this.containsBrick(e))return;const i=this.getBucketIndexForBrick(e);this.setContent(t,i,e)}brickVisibilityDidChange(e,t){this.updateView()}brickSettingDidChange(e){if(this.containsBrick(e))if(this._setBrickState(e,"settingsVersion",this._getBrickState(e,"settingsVersion")+1),e instanceof K){const t=this.getBucketIndexForBrick(e),i=this._selectedBucket<=t;this._triggerEncoderTranslation(e,i)}else this._triggerViewerView(e)}encoderDidReverse(e,t){if(3===this._bricks.length&&"viewer"===this._bricks[0].getMeta().type&&"encoder"===this._bricks[1].getMeta().type&&"viewer"===this._bricks[2].getMeta().type){const e=this.getContent(1,!1),t=this.spliceBricks(0,3);t.reverse(),this.setContent(e,0),this.spliceBricks(0,0,t)}else this.brickSettingDidChange(e)}brickDidFinish(e,t){this.isBusy()||this._bucketListeners.map((e,i)=>(e.forEach(e=>null!==t?e.resolve(this.getContent(i,!1)):e.reject(t)),[]))}async brickReplaceButtonDidClick(e){const t=this.getLibraryModalView();if(t.applyFilter(t=>t.type===e.getMeta().type),t.isVisible())return;let i=e.getMeta().name;try{i=await t.prompt(i)}catch(e){return}if(i!==e.getMeta().name){const t=this.getBrickFactory().create(i);e instanceof K&&t instanceof K&&t.setReverse(e.isReverse()),this.replaceBrick(e,t)}}async viewAddButtonDidClick(e,t){I.trigger("pipeAddButtonClick",{pipe:this,index:t});const i=this.getLibraryModalView();let s;i.clearFilter();try{s=await i.prompt()}catch(e){return}const n=this.getBrickFactory().create(s);this.spliceBricks(t,0,[n])}viewBrickDidDrop(e,t,i,s=!1){i instanceof W?s?this.duplicateBrick(i,t):this.moveBrick(i,t):this.spliceBricks(t,0,[i]),I.trigger("pipeBrickDrop",{pipe:this,index:t,brick:i,copy:s})}viewHiddenBrickGroupDidClick(e,t){t.forEach(e=>e.setHidden(!1)),I.trigger("pipeHiddenBrickGroupClick",{pipe:this,bricks:t})}didCreateView(e){this._bricks.forEach(t=>e.addSubview(t.getView()))}async store(){return(await this.getService().storePipe(this)).url}serialize(){const e={};null!==this._id&&(e.id=this._id),null!==this._url&&(e.url=this._url),null!==this._title&&(e.title=this._title),null!==this._description&&(e.description=this._description),e.items=this._bricks.map(e=>e.serialize());const t=this._selectedBucket,i=this._bucketContent[t];if(!i.isEmpty()||t>0){e.content={},i.needsTextEncoding()?(e.content.data=m.base64StringFromBytes(i.getBytes()),e.content.encoding="base64"):e.content.data=i.getString();const{lowerEncoder:s}=this.getBricksAttachedToBucket(t);null!==s&&(e.content.index=this._bricks.indexOf(s)+1)}return e}static extract(e,t){if(!Array.isArray(e.items)||0===e.items.length)throw new Error("Pipe property 'items' is expected to be of type 'array' and must not be empty");const i=new ds;if(i.setBrickFactory(t),i.addBricks(e.items),void 0!==e.id&&null!==e.id){if("number"!=typeof e.id)throw new Error("Optional pipe property 'id' is expected to be of type 'number'");i.setId(e.id)}if(void 0!==e.url&&null!==e.url){if("string"!=typeof e.url)throw new Error("Optional pipe property 'url' is expected to be of type 'string'");i.setUrl(e.url)}if(void 0!==e.title&&null!==e.title){if("string"!=typeof e.title)throw new Error("Optional pipe property 'title' is expected to be of type 'string'");i.setTitle(e.title)}if(void 0!==e.description&&null!==e.description){if("string"!=typeof e.description)throw new Error("Optional pipe property 'description' is expected to be of type 'string'");i.setDescription(e.description)}let s="",n=0;if(void 0!==e.content&&null!==e.content){if("object"!=typeof e.content)throw new Error("Optional pipe property 'content' is expected to be of type 'object'");if(void 0===e.content.data||"string"!=typeof e.content.data)throw new Error("Pipe property 'content.data' is expected to be of type 'string'");if(void 0!==e.content.encoding&&"string"!=typeof e.content.encoding)throw new Error("Optional pipe property 'content.encoding' is expected to be of type 'string'");if(void 0!==e.content.index&&"number"!=typeof e.content.index)throw new Error("Optional pipe property 'content.index' is expected to be of type 'number'");const t=e.content.encoding||"text";switch(t){case"text":s=e.content.data;break;case"base64":s=m.bytesFromBase64String(e.content.data);break;default:throw new Error(`Optional pipe property 'content.encoding' is set to an unsupported encoding '${t}'; Supported values: text, base64`)}const r=e.content.index||0;if(r===i.getLength())n=i.getBucketLength()-1;else{if(!(r>=0&&r<i.getLength()))throw new Error("Optional pipe property 'content.index' is expected to be a number ranging from 0 to "+(i.getBucketLength()-1));n=i.getBucketIndexForBrick(i.getBrick(r))}}return i.setContent(s,n),i}}class us{constructor(e){this._rootEndpoint=`${e}/v1`}async createSession(){const e=await window.fetch(`${this._rootEndpoint}/session`);if(!e.ok)throw new Error("Unable to create a session");return e.json()}async storePipe(e){const t=await this.createSession(),i=await window.fetch(`${this._rootEndpoint}/pipes`,{method:"POST",headers:{"Content-type":"application/json; charset=utf-8",Authorization:`Bearer ${t.token}`},body:JSON.stringify(e.serialize())});if(!i.ok)throw new Error("Unable to store this pipe");const s=await i.json();if(void 0!==s.error)throw new Error("Unable to store this pipe: "+s.error.message);return s}}const gs={version:"4.0.8+master.fbb86f6",scope:"/",serviceEndpoint:"https://cryptii.com/api",serviceWorkerUrl:null};let ps=null;class ms extends E{constructor(e={}){super(),this._viewPrototype=n,this._pipe=null,this._config=Object.assign(gs,e),this._service=new us(this._config.serviceEndpoint),ps=this}run(e=null){je.placeBrowserAttribute(),null!==e?this._pipe=ds.extract(e,rs.getInstance()):(this._pipe=new ds,this._pipe.setBrickFactory(rs.getInstance())),this._pipe.setService(this._service);const t=this.getView();return t.layout(),setTimeout(t.layout.bind(t),100),"undefined"!=typeof navigator&&"serviceWorker"in navigator&&(this._config.serviceWorkerUrl?navigator.serviceWorker.register(this._config.serviceWorkerUrl,{scope:this._config.scope}):navigator.serviceWorker.getRegistrations().then(e=>e.forEach(e=>e.unregister()))),je.isBrowser()&&document.addEventListener("keydown",e=>{e.ctrlKey&&"i"===e.key&&(e.preventDefault(),alert(this.debug()))}),this}debug(){return JSON.stringify({version:this._config.version,env:je.identify(),pipe:this.getPipe().serialize()})}getPipe(){return this._pipe}didCreateView(e){e.addSubview(this._pipe.getView())}static getInstance(){return ps}}if(je.isBrowser()&&null!==document.querySelector("script[data-cryptii-init]")){const e=()=>{const e=document.querySelector("script[data-cryptii-pipe]"),t=null!==e?JSON.parse(e.innerHTML):null,i=document.querySelector("script[data-cryptii-config]"),s=null!==i?JSON.parse(i.innerHTML):{};new ms(s).run(t)};"loading"!==document.readyState?e():window.addEventListener("DOMContentLoaded",e)}e.App=ms,e.ArrayUtil=o,e.Brick=W,e.BrickFactory=rs,e.ByteEncoder=m,e.ByteEncodingError=g,e.Chain=w,e.Encoder=K,e.EnvUtil=je,e.EventManager=I,e.Factory=r,e.Field=M,e.FieldFactory=U,e.Form=j,e.GenericError=d,e.InvalidInputError=u,e.LibraryModalView=ls,e.MathUtil=G,e.ModalView=as,e.Pipe=ds,e.Random=l,e.StringUtil=c,e.TextEncoder=f,e.TextEncodingError=b,e.View=s,e.Viewable=E,e.Viewer=at,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=cryptii.js.map
